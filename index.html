<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://cookieseventeen.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="Ben Hsieh">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">任何一件事做到極致都值得敬佩</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜尋"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜尋"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://cookieseventeen.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-canvas-simplex-noise-wave-animation-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/09/29/canvas-simplex-noise-wave-animation-guide/" class="article-date">
  <time class="dt-published" datetime="2025-09-29T02:00:00.000Z" itemprop="datePublished">2025-09-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech-Daily/">Tech Daily</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/09/29/canvas-simplex-noise-wave-animation-guide/">Canvas + Simplex Noise 動態擬真波浪實作指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Canvas-Simplex-Noise-動態擬真波浪實作指南"><a href="#Canvas-Simplex-Noise-動態擬真波浪實作指南" class="headerlink" title="Canvas + Simplex Noise 動態擬真波浪實作指南"></a>Canvas + Simplex Noise 動態擬真波浪實作指南</h1><h2 id="📋-核心懶人包"><a href="#📋-核心懶人包" class="headerlink" title="📋 核心懶人包"></a>📋 核心懶人包</h2><ol>
<li><strong>🏗️ 技術組合</strong>：使用 HTML5 Canvas + Simplex Noise 產生連續、平滑且自然的波形。</li>
<li><strong>🎯 實作重點</strong>：多層波浪、顏色透明度疊加、時間軸推進（tick）形成流動感。</li>
<li><strong>⚡ 效能優化</strong>：DPR 縮放、節流重繪、可見性偵測與 <code>requestAnimationFrame</code> 管理。</li>
<li><strong>🔧 穩定性</strong>：完整錯誤處理、視窗尺寸變更與資源回收（停止動畫）。</li>
<li><strong>📚 可移植性</strong>：不依賴框架，原生 JS 即可執行，易整合各類前端專案。</li>
</ol>
<h2 id="🏗️-專案概述"><a href="#🏗️-專案概述" class="headerlink" title="🏗️ 專案概述"></a>🏗️ 專案概述</h2><p>這篇指南示範如何透過 Simplex Noise 生成自然的波浪運動，並在 Canvas 中以多層疊加方式呈現擬真水面效果。內容涵蓋基礎到進階的實作細節、效能調校與錯誤處理，可直接應用於登入頁、行銷頁、數據視覺化背景或創意互動場景。</p>
<h3 id="預覽圖"><a href="#預覽圖" class="headerlink" title="預覽圖"></a>預覽圖</h3><p><img src="/assets/animated-waves/wave.gif" alt="wave preview"></p>
<h2 id="🏗️-技術架構圖"><a href="#🏗️-技術架構圖" class="headerlink" title="🏗️ 技術架構圖"></a>🏗️ 技術架構圖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">  A[&quot;使用者載入頁面&quot;] --&gt; B[&quot;初始化 Canvas 與 Context&quot;]</span><br><span class="line">  B --&gt; C[&quot;依據 DPR 設定繪圖尺寸&quot;]</span><br><span class="line">  C --&gt; D[&quot;建立 Simplex Noise 實例&quot;]</span><br><span class="line">  D --&gt; E[&quot;定義多層波浪參數&quot;]</span><br><span class="line">  E --&gt; F[&quot;動畫主迴圈: requestAnimationFrame&quot;]</span><br><span class="line">  F --&gt; G[&quot;更新 tick 與計算 y 座標&quot;]</span><br><span class="line">  G --&gt; H[&quot;繪製多層路徑並填色&quot;]</span><br><span class="line">  H --&gt; I&#123;「視窗變更/頁面隱藏?」&#125;</span><br><span class="line">  I -- 是 --&gt; J[&quot;調整尺寸/暫停重繪&quot;]</span><br><span class="line">  I -- 否 --&gt; F</span><br></pre></td></tr></table></figure>

<h2 id="核心內容章節"><a href="#核心內容章節" class="headerlink" title="核心內容章節"></a>核心內容章節</h2><h3 id="1-最小可執行範例（可直接放入靜態頁）"><a href="#1-最小可執行範例（可直接放入靜態頁）" class="headerlink" title="1. 最小可執行範例（可直接放入靜態頁）"></a>1. 最小可執行範例（可直接放入靜態頁）</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-Hant&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Simplex Noise Waves<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- CDN：simplex-noise 以及輕量化的 reset --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/simplex-noise@4.0.1/dist/esm/simplex-noise.min.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">html</span>, <span class="selector-tag">body</span> &#123; <span class="attribute">margin</span>: <span class="number">0</span>; <span class="attribute">padding</span>: <span class="number">0</span>; <span class="attribute">background</span>: <span class="number">#0f1419</span>; &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-id">#wrap</span> &#123; <span class="attribute">height</span>: <span class="number">320px</span>; &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">canvas</span> &#123; <span class="attribute">display</span>: block; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">100%</span>; &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;waveCanvas&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;decorative waves&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">import</span> <span class="title class_">SimplexNoise</span> <span class="keyword">from</span> <span class="string">&#x27;https://cdn.jsdelivr.net/npm/simplex-noise@4.0.1/dist/esm/simplex-noise.min.js&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> wrapper = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;wrap&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;waveCanvas&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!ctx) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;CanvasRenderingContext2D 初始化失敗&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> simplex = <span class="keyword">new</span> <span class="title class_">SimplexNoise</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> waves = [</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">frequency</span>: <span class="number">0.002</span>, <span class="attr">amplitude</span>: <span class="number">10</span>, <span class="attr">speed</span>: <span class="number">0.001</span>, <span class="attr">tick</span>: <span class="number">0</span>, <span class="attr">color</span>: <span class="string">&#x27;rgba(100,100,100,0.9)&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">frequency</span>: <span class="number">0.002</span>, <span class="attr">amplitude</span>: <span class="number">20</span>, <span class="attr">speed</span>: <span class="number">0.002</span>, <span class="attr">tick</span>: <span class="number">0</span>, <span class="attr">color</span>: <span class="string">&#x27;rgba(100,100,100,0.5)&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">frequency</span>: <span class="number">0.003</span>, <span class="attr">amplitude</span>: <span class="number">7</span>,  <span class="attr">speed</span>: <span class="number">0.005</span>, <span class="attr">tick</span>: <span class="number">0</span>, <span class="attr">color</span>: <span class="string">&#x27;rgba(100,100,100,0.6)&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">      ];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> rafId = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">resizeCanvas</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> dpr = <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="variable language_">window</span>.<span class="property">devicePixelRatio</span> || <span class="number">1</span>, <span class="number">2</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> width = wrapper.<span class="property">clientWidth</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> height = <span class="number">300</span>; <span class="comment">// 固定高度，亦可依需求調整</span></span></span><br><span class="line"><span class="language-javascript">        canvas.<span class="property">width</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(width * dpr);</span></span><br><span class="line"><span class="language-javascript">        canvas.<span class="property">height</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(height * dpr);</span></span><br><span class="line"><span class="language-javascript">        canvas.<span class="property">style</span>.<span class="property">width</span> = width + <span class="string">&#x27;px&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        canvas.<span class="property">style</span>.<span class="property">height</span> = height + <span class="string">&#x27;px&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">setTransform</span>(dpr, <span class="number">0</span>, <span class="number">0</span>, dpr, <span class="number">0</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">drawWave</span>(<span class="params">wave</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">beginPath</span>();</span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">moveTo</span>(canvas.<span class="property">width</span>, canvas.<span class="property">height</span> / <span class="number">2</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> x = canvas.<span class="property">width</span>; x &gt;= <span class="number">0</span>; x--) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> y = canvas.<span class="property">height</span> / <span class="number">2</span> + simplex.<span class="title function_">noise2D</span>(x * wave.<span class="property">frequency</span>, wave.<span class="property">tick</span>) * wave.<span class="property">amplitude</span>;</span></span><br><span class="line"><span class="language-javascript">          ctx.<span class="title function_">lineTo</span>(x, y);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">lineTo</span>(<span class="number">0</span>, canvas.<span class="property">height</span>);</span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">lineTo</span>(canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">closePath</span>();</span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="property">fillStyle</span> = wave.<span class="property">color</span>;</span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">fill</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">const</span> wave <span class="keyword">of</span> waves) &#123;</span></span><br><span class="line"><span class="language-javascript">          wave.<span class="property">tick</span> += wave.<span class="property">speed</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">drawWave</span>(wave);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        rafId = <span class="title function_">requestAnimationFrame</span>(animate);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 可見性控制（切換分頁時暫停，回來再恢復）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">handleVisibility</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">hidden</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">cancelAnimationFrame</span>(rafId);</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          rafId = <span class="title function_">requestAnimationFrame</span>(animate);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 使用 rAF 節流重繪</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">cancelAnimationFrame</span>(rafId);</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">resizeCanvas</span>();</span></span><br><span class="line"><span class="language-javascript">        rafId = <span class="title function_">requestAnimationFrame</span>(animate);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;visibilitychange&#x27;</span>, handleVisibility);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">resizeCanvas</span>();</span></span><br><span class="line"><span class="language-javascript">      rafId = <span class="title function_">requestAnimationFrame</span>(animate);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-模組化程式碼（抽離邏輯，便於整合框架）"><a href="#2-模組化程式碼（抽離邏輯，便於整合框架）" class="headerlink" title="2. 模組化程式碼（抽離邏輯，便於整合框架）"></a>2. 模組化程式碼（抽離邏輯，便於整合框架）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// waves.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">SimplexNoise</span> <span class="keyword">from</span> <span class="string">&#x27;simplex-noise&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SimplexWaveAnimator</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">canvas, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!context) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;CanvasRenderingContext2D 初始化失敗&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvas</span> = canvas;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span> = context;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">wrapper</span> = canvas.<span class="property">parentElement</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">simplex</span> = <span class="keyword">new</span> <span class="title class_">SimplexNoise</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">waves</span> = options.<span class="property">waves</span> || [</span><br><span class="line">      &#123; <span class="attr">frequency</span>: <span class="number">0.002</span>, <span class="attr">amplitude</span>: <span class="number">10</span>, <span class="attr">speed</span>: <span class="number">0.001</span>, <span class="attr">tick</span>: <span class="number">0</span>, <span class="attr">color</span>: <span class="string">&#x27;rgba(100,100,100,0.9)&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">frequency</span>: <span class="number">0.002</span>, <span class="attr">amplitude</span>: <span class="number">20</span>, <span class="attr">speed</span>: <span class="number">0.002</span>, <span class="attr">tick</span>: <span class="number">0</span>, <span class="attr">color</span>: <span class="string">&#x27;rgba(100,100,100,0.5)&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">frequency</span>: <span class="number">0.003</span>, <span class="attr">amplitude</span>: <span class="number">7</span>,  <span class="attr">speed</span>: <span class="number">0.005</span>, <span class="attr">tick</span>: <span class="number">0</span>, <span class="attr">color</span>: <span class="string">&#x27;rgba(100,100,100,0.6)&#x27;</span> &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rafId</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = options.<span class="property">height</span> || <span class="number">300</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">resize</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dpr = <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="variable language_">window</span>.<span class="property">devicePixelRatio</span> || <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">const</span> width = <span class="variable language_">this</span>.<span class="property">wrapper</span>?.<span class="property">clientWidth</span> ?? <span class="variable language_">window</span>.<span class="property">innerWidth</span>;</span><br><span class="line">    <span class="keyword">const</span> height = <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvas</span>.<span class="property">width</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(width * dpr);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvas</span>.<span class="property">height</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(height * dpr);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvas</span>.<span class="property">style</span>.<span class="property">width</span> = width + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvas</span>.<span class="property">style</span>.<span class="property">height</span> = height + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">setTransform</span>(dpr, <span class="number">0</span>, <span class="number">0</span>, dpr, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">drawWave</span>(<span class="params">wave</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, canvas, simplex &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">moveTo</span>(canvas.<span class="property">width</span>, canvas.<span class="property">height</span> / <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> x = canvas.<span class="property">width</span>; x &gt;= <span class="number">0</span>; x--) &#123;</span><br><span class="line">      <span class="keyword">const</span> y = canvas.<span class="property">height</span> / <span class="number">2</span> + simplex.<span class="title function_">noise2D</span>(x * wave.<span class="property">frequency</span>, wave.<span class="property">tick</span>) * wave.<span class="property">amplitude</span>;</span><br><span class="line">      ctx.<span class="title function_">lineTo</span>(x, y);</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(<span class="number">0</span>, canvas.<span class="property">height</span>);</span><br><span class="line">    ctx.<span class="title function_">lineTo</span>(canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span><br><span class="line">    ctx.<span class="title function_">closePath</span>();</span><br><span class="line">    ctx.<span class="property">fillStyle</span> = wave.<span class="property">color</span>;</span><br><span class="line">    ctx.<span class="title function_">fill</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  frame = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">canvas</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">canvas</span>.<span class="property">height</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> wave <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">waves</span>) &#123;</span><br><span class="line">      wave.<span class="property">tick</span> += wave.<span class="property">speed</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">drawWave</span>(wave);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rafId</span> = <span class="title function_">requestAnimationFrame</span>(<span class="variable language_">this</span>.<span class="property">frame</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">stop</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resize</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rafId</span> = <span class="title function_">requestAnimationFrame</span>(<span class="variable language_">this</span>.<span class="property">frame</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;visibilitychange&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleVisibility</span>);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleResize</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">cancelAnimationFrame</span>(<span class="variable language_">this</span>.<span class="property">rafId</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;visibilitychange&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleVisibility</span>);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleResize</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleVisibility = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">hidden</span>) &#123;</span><br><span class="line">      <span class="title function_">cancelAnimationFrame</span>(<span class="variable language_">this</span>.<span class="property">rafId</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rafId</span> = <span class="title function_">requestAnimationFrame</span>(<span class="variable language_">this</span>.<span class="property">frame</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleResize = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">cancelAnimationFrame</span>(<span class="variable language_">this</span>.<span class="property">rafId</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resize</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rafId</span> = <span class="title function_">requestAnimationFrame</span>(<span class="variable language_">this</span>.<span class="property">frame</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用方式：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hero&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;bg-waves&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 其他內容 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Welcome<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; <span class="title class_">SimplexWaveAnimator</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./waves.js&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;bg-waves&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> animator = <span class="keyword">new</span> <span class="title class_">SimplexWaveAnimator</span>(canvas, &#123; <span class="attr">height</span>: <span class="number">320</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">  animator.<span class="title function_">start</span>();</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 頁面卸載時停止</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;beforeunload&#x27;</span>, <span class="function">() =&gt;</span> animator.<span class="title function_">stop</span>());</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 視圖切換時亦可手動停止 animator.stop();</span></span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-邊界情況與錯誤處理"><a href="#3-邊界情況與錯誤處理" class="headerlink" title="3. 邊界情況與錯誤處理"></a>3. 邊界情況與錯誤處理</h3><ul>
<li><strong>Canvas context 取得失敗</strong>：在無法取得 2D context 時立即拋錯，避免靜默失效。</li>
<li><strong>高 DPR 裝置</strong>：使用 <code>devicePixelRatio</code> 並限制最大值（例如 2）避免 GPU 記憶體飆升。</li>
<li><strong>視窗尺寸變更</strong>：節流更新並重新繪製，確保畫質不模糊。</li>
<li><strong>頁籤可見性</strong>：利用 <code>visibilitychange</code> 停止重繪，返回時恢復。</li>
<li><strong>資源回收</strong>：提供 <code>stop()</code> 方法，避免 SPA 路由切換後動畫持續佔用資源。</li>
</ul>
<h2 id="💡-決策流程圖"><a href="#💡-決策流程圖" class="headerlink" title="💡 決策流程圖"></a>💡 決策流程圖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">  A[&quot;需要擬真波浪背景?&quot;] --&gt;|是| B&#123;&quot;效能要求?&quot;&#125;</span><br><span class="line">  A --&gt;|否| Z[&quot;改用純 CSS/靜態圖&quot;]</span><br><span class="line">  B --&gt;|高| C[&quot;降低層數/振幅\n限制 DPR=2&quot;]</span><br><span class="line">  B --&gt;|中| D[&quot;維持 2~3 層波浪&quot;]</span><br><span class="line">  B --&gt;|低| E[&quot;增加細節與透明度疊加&quot;]</span><br><span class="line">  C --&gt; F&#123;&quot;是否需要互動?&quot;&#125;</span><br><span class="line">  D --&gt; F</span><br><span class="line">  E --&gt; F</span><br><span class="line">  F --&gt;|需要| G[&quot;加入滑鼠/觸控影響 tick 或 amplitude&quot;]</span><br><span class="line">  F --&gt;|不需要| H[&quot;固定參數，專注視覺穩定&quot;]</span><br><span class="line">  H --&gt; I[&quot;整合到頁面/框架&quot;]</span><br><span class="line">  G --&gt; I</span><br></pre></td></tr></table></figure>

<h2 id="🎯-核心洞察總結"><a href="#🎯-核心洞察總結" class="headerlink" title="🎯 核心洞察總結"></a>🎯 核心洞察總結</h2><ul>
<li><strong>Simplex Noise</strong> 提供連續、低重複性的疊代波形，視覺自然且易控。</li>
<li><strong>多層透明疊加</strong> 能快速提升質感，但需搭配 DPR 與重繪節流控管效能。</li>
<li><strong>動畫生命週期管理</strong> 是前端整合的關鍵，須妥善處理可見性、尺寸變更與路由切換。</li>
</ul>
<h2 id="🚀-進階應用策略"><a href="#🚀-進階應用策略" class="headerlink" title="🚀 進階應用策略"></a>🚀 進階應用策略</h2><ul>
<li><strong>互動化</strong>：使用滑鼠位置或音訊頻譜影響 <code>frequency/amplitude</code>，打造音波&#x2F;水波互動。</li>
<li><strong>主題化</strong>：依深淺色主題切換波浪顏色與透明度，融入設計系統。</li>
<li><strong>資料視覺化背景</strong>：作為儀表板背景動畫，搭配暫停&#x2F;播放控制避免干擾閱讀。</li>
<li><strong>WebGL 遷移</strong>：對極致效能需求可遷移至 WebGL&#x2F;Shader，保留決策流程不變。</li>
</ul>
<h2 id="📞-技術支援與參考資源"><a href="#📞-技術支援與參考資源" class="headerlink" title="📞 技術支援與參考資源"></a>📞 技術支援與參考資源</h2><h3 id="🛠️-實用工具"><a href="#🛠️-實用工具" class="headerlink" title="🛠️ 實用工具"></a>🛠️ 實用工具</h3><table>
<thead>
<tr>
<th>工具</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>simplex-noise</td>
<td>產生 Simplex 噪聲的 JS 函式庫</td>
</tr>
<tr>
<td>Stats.js</td>
<td>簡易效能監測（幀率）</td>
</tr>
<tr>
<td>Canvas Inspector</td>
<td>偵錯 Canvas 繪圖流程</td>
</tr>
</tbody></table>
<h3 id="📚-官方文件"><a href="#📚-官方文件" class="headerlink" title="📚 官方文件"></a>📚 官方文件</h3><ul>
<li>Simplex Noise 套件（npm）：<code>https://www.npmjs.com/package/simplex-noise</code></li>
<li>MDN Canvas API：<code>https://developer.mozilla.org/docs/Web/API/Canvas_API</code></li>
<li>requestAnimationFrame：<code>https://developer.mozilla.org/docs/Web/API/window/requestAnimationFrame</code></li>
</ul>
<h3 id="🌐-社群與學習"><a href="#🌐-社群與學習" class="headerlink" title="🌐 社群與學習"></a>🌐 社群與學習</h3><ul>
<li>StackBlitz 範例（與本文邏輯相近）：<code>https://stackblitz.com/edit/js-hpafz1?file=index.js</code></li>
<li>Creative Coding 社群精選：<code>https://www.reddit.com/r/creativecoding/</code></li>
</ul>
<h2 id="🔗-相關文章連結"><a href="#🔗-相關文章連結" class="headerlink" title="🔗 相關文章連結"></a>🔗 相關文章連結</h2><h3 id="📚-系列文章建議"><a href="#📚-系列文章建議" class="headerlink" title="📚 系列文章建議"></a>📚 系列文章建議</h3><ul>
<li>後續文章：Canvas 效能優化實戰 - 線條合併、離屏渲染、快取策略</li>
<li>後續文章：前端動畫生命週期管理 - 在 SPA&#x2F;SSR 中穩定運行動畫</li>
</ul>
<h3 id="🎯-相關主題"><a href="#🎯-相關主題" class="headerlink" title="🎯 相關主題"></a>🎯 相關主題</h3><ul>
<li>並行文章：Mapbox 資料視覺化指南 - 背景動畫與地圖互動的協作</li>
<li>對比文章：CSS 產生波浪效果 - 純 CSS 與 Canvas 的取捨</li>
</ul>
<h3 id="📋-延伸閱讀"><a href="#📋-延伸閱讀" class="headerlink" title="📋 延伸閱讀"></a>📋 延伸閱讀</h3><ul>
<li>深入研究：噪聲函數比較 - Perlin vs Simplex 的特性與成本</li>
<li>實踐案例：行銷落地頁動態背景 - A&#x2F;B 測試與可讀性平衡</li>
</ul>
<hr>
<p><strong>作者資訊</strong>：<br>本文由前端開發者整理，聚焦於創意編碼與資料視覺化的工程實踐。</p>
<p><strong>版本資訊</strong>：<br>版本 v1.0 | 發布日期：2025-09-29 | 適用環境：現代瀏覽器</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cookieseventeen.github.io/2025/09/29/canvas-simplex-noise-wave-animation-guide/" data-id="cmg51yfqi000aanmz7zk194fw" data-title="Canvas + Simplex Noise 動態擬真波浪實作指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Animation-Loop/" rel="tag">Animation Loop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Creative-Coding/" rel="tag">Creative Coding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Device-Pixel-Ratio/" rel="tag">Device Pixel Ratio</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Error-Handling/" rel="tag">Error Handling</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTML5-Canvas/" rel="tag">HTML5 Canvas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Performance-Optimization/" rel="tag">Performance Optimization</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Procedural-Animation/" rel="tag">Procedural Animation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Simplex-Noise/" rel="tag">Simplex Noise</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Visualization/" rel="tag">Visualization</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-angular-enterprise-project-initialization-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/29/angular-enterprise-project-initialization-guide/" class="article-date">
  <time class="dt-published" datetime="2025-06-29T10:00:00.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech-Daily/">Tech Daily</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/29/angular-enterprise-project-initialization-guide/">Angular 19 企業級前端專案初始化完整指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Angular-19-企業級前端專案初始化完整指南"><a href="#Angular-19-企業級前端專案初始化完整指南" class="headerlink" title="Angular 19 企業級前端專案初始化完整指南"></a>Angular 19 企業級前端專案初始化完整指南</h1><h2 id="📋-核心懶人包"><a href="#📋-核心懶人包" class="headerlink" title="📋 核心懶人包"></a>📋 核心懶人包</h2><p>⭐ <strong>5 個關鍵價值點</strong>：</p>
<ol>
<li><strong>🏗️ 現代化架構設計</strong>：採用 Angular 19 最新的 Standalone Components 和 Signals 技術</li>
<li><strong>🎯 模組化開發策略</strong>：功能模組化架構支援大型團隊協作和快速擴展</li>
<li><strong>⚡ 效能優化配置</strong>：延遲載入、OnPush 變更檢測和 SSR 預渲染優化</li>
<li><strong>🎨 完整 UI 解決方案</strong>：PrimeNG + Tailwind CSS 打造現代化使用者介面</li>
<li><strong>🔧 開發工具整合</strong>：ESLint、Prettier、TypeScript 嚴格模式的完整工具鏈</li>
</ol>
<h2 id="🏗️-專案概述-π"><a href="#🏗️-專案概述-π" class="headerlink" title="🏗️ 專案概述 π"></a>🏗️ 專案概述 π</h2><p>本指南提供一套完整的 Angular 19 企業級前端專案初始化方案，專為大型企業應用設計。透過現代化的技術棧和成熟的架構模式，幫助開發團隊快速建立高品質、可維護、可擴展的前端專案基礎。</p>
<h3 id="💼-適用場景"><a href="#💼-適用場景" class="headerlink" title="💼 適用場景"></a>💼 適用場景</h3><ul>
<li><strong>企業級管理系統</strong>：CRM、ERP、人事管理等業務系統</li>
<li><strong>數據驾驶艙應用</strong>：監控面板、分析報表、實時數據展示</li>
<li><strong>多功能整合平台</strong>：整合多個業務模組的統一入口</li>
<li><strong>B2B 商務應用</strong>：供應商管理、客戶服務、內部作業平台</li>
</ul>
<h3 id="🎯-核心技術特色"><a href="#🎯-核心技術特色" class="headerlink" title="🎯 核心技術特色"></a>🎯 核心技術特色</h3><ul>
<li>✅ <strong>Angular 19 最新特性</strong>：Standalone Components、Signals、新版 Control Flow</li>
<li>✅ <strong>企業級架構模式</strong>：Clean Architecture + Feature Module 分層設計</li>
<li>✅ <strong>現代化 UI 技術棧</strong>：PrimeNG 19 + Tailwind CSS + 暗色模式</li>
<li>✅ <strong>完整開發工具鏈</strong>：ESLint 9、Prettier、TypeScript 5.6+</li>
<li>✅ <strong>效能優化配置</strong>：SSR、延遲載入、變更檢測優化</li>
</ul>
<h2 id="🏗️-技術架構圖"><a href="#🏗️-技術架構圖" class="headerlink" title="🏗️ 技術架構圖"></a>🏗️ 技術架構圖</h2><h3 id="整體架構設計"><a href="#整體架構設計" class="headerlink" title="整體架構設計"></a>整體架構設計</h3><p>本專案採用 <strong>功能模組化架構</strong> (Feature-Module Architecture)，結合 <strong>清潔架構</strong> (Clean Architecture) 原則，構建可擴展的企業級前端應用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    subgraph &quot;企業級前端專案架構&quot;</span><br><span class="line">        subgraph &quot;技術棧層級&quot;</span><br><span class="line">            A1[&quot;Angular 19.2+&lt;br/&gt;Standalone Components&quot;]</span><br><span class="line">            A2[&quot;TypeScript 5.6+&lt;br/&gt;嚴格模式&quot;]</span><br><span class="line">            A3[&quot;PrimeNG 19&lt;br/&gt;UI 元件庫&quot;]</span><br><span class="line">            A4[&quot;Tailwind CSS&lt;br/&gt;樣式框架&quot;]</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph &quot;架構分層&quot;</span><br><span class="line">            B1[&quot;Core Layer&lt;br/&gt;核心服務層&quot;]</span><br><span class="line">            B2[&quot;Shared Layer&lt;br/&gt;共享元件層&quot;]</span><br><span class="line">            B3[&quot;Feature Layer&lt;br/&gt;功能模組層&quot;]</span><br><span class="line">            B4[&quot;Pages Layer&lt;br/&gt;頁面整合層&quot;]</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph &quot;開發工具&quot;</span><br><span class="line">            C1[&quot;ESLint 9&lt;br/&gt;程式碼檢查&quot;]</span><br><span class="line">            C2[&quot;Prettier&lt;br/&gt;格式化工具&quot;]</span><br><span class="line">            C3[&quot;Angular CLI&lt;br/&gt;構建工具&quot;]</span><br><span class="line">            C4[&quot;SSR Support&lt;br/&gt;伺服器端渲染&quot;]</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    A1 --&gt; B1</span><br><span class="line">    A2 --&gt; B1</span><br><span class="line">    B1 --&gt; B2</span><br><span class="line">    B2 --&gt; B3</span><br><span class="line">    B3 --&gt; B4</span><br><span class="line">    </span><br><span class="line">    C1 --&gt; A2</span><br><span class="line">    C2 --&gt; A2</span><br><span class="line">    C3 --&gt; A1</span><br><span class="line">    C4 --&gt; A1</span><br></pre></td></tr></table></figure>

<h3 id="分層責任與設計原則"><a href="#分層責任與設計原則" class="headerlink" title="分層責任與設計原則"></a>分層責任與設計原則</h3><table>
<thead>
<tr>
<th>層級</th>
<th>責任範圍</th>
<th>設計原則</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Core Layer</strong></td>
<td>核心業務邏輯、服務、攔截器</td>
<td>提供基礎設施，保持單例模式</td>
</tr>
<tr>
<td><strong>Shared Layer</strong></td>
<td>可重用元件、管道、指令</td>
<td>跨模組共享，無業務邏輯依賴</td>
</tr>
<tr>
<td><strong>Feature Layer</strong></td>
<td>功能模組、業務邏輯</td>
<td>自包含，延遲載入，依賴隔離</td>
</tr>
<tr>
<td><strong>Page Layer</strong></td>
<td>頁面級元件</td>
<td>整合功能模組，處理全域邏輯</td>
</tr>
</tbody></table>
<h2 id="🚀-專案初始化步驟"><a href="#🚀-專案初始化步驟" class="headerlink" title="🚀 專案初始化步驟"></a>🚀 專案初始化步驟</h2><h3 id="1-環境準備"><a href="#1-環境準備" class="headerlink" title="1. 環境準備"></a>1. 環境準備</h3><p><strong>系統需求</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Node.js &gt;= 18.19.0</span><br><span class="line">npm &gt;= 10.2.0</span><br><span class="line">Angular CLI &gt;= 19.0.0</span><br></pre></td></tr></table></figure>

<p><strong>安裝 Angular CLI</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @angular/cli@latest</span><br></pre></td></tr></table></figure>

<h3 id="2-建立新專案"><a href="#2-建立新專案" class="headerlink" title="2. 建立新專案"></a>2. 建立新專案</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建立專案（使用 Standalone Components 和 SSR）</span></span><br><span class="line">ng new your-project-name --routing --style=scss --ssr --package-manager=npm --standalone</span><br><span class="line"></span><br><span class="line"><span class="comment"># 進入專案目錄</span></span><br><span class="line"><span class="built_in">cd</span> your-project-name</span><br></pre></td></tr></table></figure>

<h3 id="3-安裝核心依賴"><a href="#3-安裝核心依賴" class="headerlink" title="3. 安裝核心依賴"></a>3. 安裝核心依賴</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安裝 UI 框架</span></span><br><span class="line">npm install primeng@19 primeicons primeflex</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安裝 Tailwind CSS</span></span><br><span class="line">npm install -D tailwindcss postcss autoprefixer</span><br><span class="line">npx tailwindcss init -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安裝開發工具</span></span><br><span class="line">npm install -D eslint @angular-eslint/eslint-plugin @angular-eslint/template-parser</span><br><span class="line">npm install -D prettier eslint-config-prettier eslint-plugin-prettier</span><br></pre></td></tr></table></figure>

<h3 id="4-建立專案目錄結構"><a href="#4-建立專案目錄結構" class="headerlink" title="4. 建立專案目錄結構"></a>4. 建立專案目錄結構</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建立核心目錄結構</span></span><br><span class="line"><span class="built_in">mkdir</span> -p src/app/&#123;core,shared,features,pages&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p src/app/core/&#123;services,models,guards,interceptors,enums&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p src/app/shared/&#123;components,layouts,directives,pipes,utils&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p src/app/features/&#123;demo,user,system&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p src/app/pages/&#123;dashboard,not-found&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立版面配置</span></span><br><span class="line"><span class="built_in">mkdir</span> -p src/app/shared/layouts/&#123;empty-layout,sidebar-layout&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立文件目錄</span></span><br><span class="line"><span class="built_in">mkdir</span> docs</span><br></pre></td></tr></table></figure>

<h2 id="📂-完整目錄結構"><a href="#📂-完整目錄結構" class="headerlink" title="📂 完整目錄結構"></a>📂 完整目錄結構</h2><h3 id="推薦的專案結構"><a href="#推薦的專案結構" class="headerlink" title="推薦的專案結構"></a>推薦的專案結構</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">your-project/</span><br><span class="line">├── 📁 docs/                                    # 專案文件目錄</span><br><span class="line">│   ├── 📄 project-architecture.md              # 專案架構文件</span><br><span class="line">│   ├── 📄 coding-standards.md                  # 程式碼規範文件</span><br><span class="line">│   └── 📄 deployment-guide.md                  # 部署指南文件</span><br><span class="line">│</span><br><span class="line">├── 📁 public/                                  # 靜態資源目錄</span><br><span class="line">│   └── 📄 favicon.ico                          # 網站圖示檔案</span><br><span class="line">│</span><br><span class="line">├── 📁 src/                                     # 原始程式碼根目錄</span><br><span class="line">│   ├── 📄 index.html                           # 應用程式 HTML 進入點</span><br><span class="line">│   ├── 📄 main.ts                              # 客戶端應用啟動檔案</span><br><span class="line">│   ├── 📄 main.server.ts                       # 伺服器端應用啟動檔案</span><br><span class="line">│   ├── 📄 styles.scss                          # 全域樣式檔案</span><br><span class="line">│   ├── 📄 tailwind.css                         # Tailwind CSS 進入點</span><br><span class="line">│   │</span><br><span class="line">│   ├── 📁 environments/                        # 環境配置目錄</span><br><span class="line">│   │   ├── 📄 environment.ts                   # 開發環境配置</span><br><span class="line">│   │   └── 📄 environment.prod.ts              # 生產環境配置</span><br><span class="line">│   │</span><br><span class="line">│   └── 📁 app/                                 # Angular 應用程式核心目錄</span><br><span class="line">│       ├── 📄 app.component.html               # 根元件 HTML 模板</span><br><span class="line">│       ├── 📄 app.component.scss               # 根元件樣式檔案</span><br><span class="line">│       ├── 📄 app.component.ts                 # 根元件 TypeScript 邏輯</span><br><span class="line">│       ├── 📄 app.config.ts                    # 應用程式核心配置</span><br><span class="line">│       ├── 📄 app.routes.ts                    # 根路由配置檔案</span><br><span class="line">│       │</span><br><span class="line">│       ├── 📁 core/                            # 核心層 - 應用程式基礎設施</span><br><span class="line">│       │   ├── 📁 enums/                       # 列舉定義目錄</span><br><span class="line">│       │   ├── 📁 guards/                      # 路由守衛目錄</span><br><span class="line">│       │   ├── 📁 interceptors/                # HTTP 攔截器目錄</span><br><span class="line">│       │   ├── 📁 models/                      # 資料模型與介面目錄</span><br><span class="line">│       │   └── 📁 services/                    # 核心服務目錄</span><br><span class="line">│       │</span><br><span class="line">│       ├── 📁 shared/                          # 共享層 - 可重用元件與工具</span><br><span class="line">│       │   ├── 📁 components/                  # 跨模組共享元件目錄</span><br><span class="line">│       │   ├── 📁 directives/                  # 自訂指令目錄</span><br><span class="line">│       │   ├── 📁 layouts/                     # 版面配置元件目錄</span><br><span class="line">│       │   │   ├── 📁 empty-layout/            # 空白版面配置元件</span><br><span class="line">│       │   │   └── 📁 sidebar-layout/          # 側邊欄版面配置元件</span><br><span class="line">│       │   ├── 📁 pipes/                       # 自訂管道目錄</span><br><span class="line">│       │   └── 📁 utils/                       # 工具函式目錄</span><br><span class="line">│       │</span><br><span class="line">│       ├── 📁 features/                        # 功能層 - 業務功能模組</span><br><span class="line">│       │   ├── 📁 demo/                        # 展示功能模組</span><br><span class="line">│       │   ├── 📁 user/                        # 使用者管理功能模組</span><br><span class="line">│       │   └── 📁 system/                      # 系統管理功能模組</span><br><span class="line">│       │</span><br><span class="line">│       └── 📁 pages/                           # 頁面層 - 頂層頁面元件</span><br><span class="line">│           ├── 📁 dashboard/                   # 儀表板頁面</span><br><span class="line">│           └── 📁 not-found/                   # 404 錯誤頁面</span><br><span class="line">│</span><br><span class="line">├── 📄 angular.json                             # Angular CLI 專案配置檔案</span><br><span class="line">├── 📄 eslint.config.js                         # ESLint 程式碼檢查配置</span><br><span class="line">├── 📄 package.json                             # NPM 套件管理與腳本配置</span><br><span class="line">├── 📄 tailwind.config.ts                       # Tailwind CSS 客製化配置</span><br><span class="line">├── 📄 tsconfig.app.json                        # 應用程式 TypeScript 配置</span><br><span class="line">├── 📄 tsconfig.json                            # 根層級 TypeScript 配置</span><br><span class="line">└── 📄 README.md                                # 專案說明文件</span><br></pre></td></tr></table></figure>

<h2 id="⚙️-核心配置文件設置"><a href="#⚙️-核心配置文件設置" class="headerlink" title="⚙️ 核心配置文件設置"></a>⚙️ 核心配置文件設置</h2><h3 id="1-Tailwind-CSS-配置"><a href="#1-Tailwind-CSS-配置" class="headerlink" title="1. Tailwind CSS 配置"></a>1. Tailwind CSS 配置</h3><p><strong>tailwind.config.ts</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Config</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;tailwindcss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">content</span>: [</span><br><span class="line">    <span class="string">&quot;./src/**/*.&#123;html,ts&#125;&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">darkMode</span>: <span class="string">&#x27;class&#x27;</span>,</span><br><span class="line">  <span class="attr">theme</span>: &#123;</span><br><span class="line">    <span class="attr">extend</span>: &#123;</span><br><span class="line">      <span class="attr">colors</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;primary&#x27;</span>: <span class="string">&#x27;var(--p-primary-color)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;primary-contrast&#x27;</span>: <span class="string">&#x27;var(--p-primary-contrast-color)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;surface&#x27;</span>: <span class="string">&#x27;var(--p-surface-ground)&#x27;</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">&#125; <span class="keyword">satisfies</span> <span class="title class_">Config</span>;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;tailwind.css</strong>：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@tailwind</span> base;</span><br><span class="line"><span class="keyword">@tailwind</span> components;</span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* PrimeNG 與 Tailwind 整合 */</span></span><br><span class="line"><span class="keyword">@layer</span> base &#123;</span><br><span class="line">  <span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attr">--p-primary-color</span>: <span class="number">#3b82f6</span>;</span><br><span class="line">    <span class="attr">--p-primary-contrast-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">    <span class="attr">--p-surface-ground</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.dark</span> &#123;</span><br><span class="line">    <span class="attr">--p-surface-ground</span>: <span class="number">#0f1419</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-ESLint-配置"><a href="#2-ESLint-配置" class="headerlink" title="2. ESLint 配置"></a>2. ESLint 配置</h3><p><strong>eslint.config.js</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tseslint <span class="keyword">from</span> <span class="string">&#x27;@typescript-eslint/eslint-plugin&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> angular <span class="keyword">from</span> <span class="string">&#x27;@angular-eslint/eslint-plugin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">files</span>: [<span class="string">&#x27;**/*.ts&#x27;</span>],</span><br><span class="line">    <span class="attr">languageOptions</span>: &#123;</span><br><span class="line">      <span class="attr">parser</span>: <span class="string">&#x27;@typescript-eslint/parser&#x27;</span>,</span><br><span class="line">      <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">        <span class="attr">project</span>: <span class="string">&#x27;./tsconfig.json&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@typescript-eslint&#x27;</span>: tseslint,</span><br><span class="line">      <span class="string">&#x27;@angular-eslint&#x27;</span>: angular,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rules</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@angular-eslint/component-class-suffix&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;@angular-eslint/directive-class-suffix&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;@typescript-eslint/no-explicit-any&#x27;</span>: <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;@typescript-eslint/no-unused-vars&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;prefer-const&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="3-Angular-應用配置"><a href="#3-Angular-應用配置" class="headerlink" title="3. Angular 應用配置"></a>3. Angular 應用配置</h3><p><strong>src&#x2F;app&#x2F;app.config.ts</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApplicationConfig</span>, importProvidersFrom &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideRouter, withInMemoryScrolling &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideClientHydration &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideAnimationsAsync &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser/animations/async&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideHttpClient, withFetch &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PrimeNGConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;primeng/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    <span class="title function_">provideRouter</span>(routes, <span class="title function_">withInMemoryScrolling</span>(&#123;</span><br><span class="line">      <span class="attr">scrollPositionRestoration</span>: <span class="string">&#x27;top&#x27;</span></span><br><span class="line">    &#125;)),</span><br><span class="line">    <span class="title function_">provideClientHydration</span>(),</span><br><span class="line">    <span class="title function_">provideAnimationsAsync</span>(),</span><br><span class="line">    <span class="title function_">provideHttpClient</span>(<span class="title function_">withFetch</span>()),</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">provide</span>: <span class="title class_">PrimeNGConfig</span>,</span><br><span class="line">      <span class="attr">useFactory</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> config = <span class="keyword">new</span> <span class="title class_">PrimeNGConfig</span>();</span><br><span class="line">        config.<span class="property">theme</span>.<span class="title function_">set</span>(&#123; <span class="attr">preset</span>: <span class="string">&#x27;Aura&#x27;</span> &#125;);</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="4-路由配置"><a href="#4-路由配置" class="headerlink" title="4. 路由配置"></a>4. 路由配置</h3><p><strong>src&#x2F;app&#x2F;app.routes.ts</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Routes</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">redirectTo</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">    <span class="attr">pathMatch</span>: <span class="string">&#x27;full&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;dashboard&#x27;</span>,</span><br><span class="line">    <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/dashboard/dashboard.component&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">m</span> =&gt;</span> m.<span class="property">DashboardComponent</span>),</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;儀表板&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;demo&#x27;</span>,</span><br><span class="line">    <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./features/demo/routes&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">m</span> =&gt;</span> m.<span class="property">demoRoutes</span>),</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Demo 展示中心&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;**&#x27;</span>,</span><br><span class="line">    <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/not-found/not-found.component&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">m</span> =&gt;</span> m.<span class="property">NotFoundComponent</span>),</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;頁面未找到&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="💡-決策流程圖"><a href="#💡-決策流程圖" class="headerlink" title="💡 決策流程圖"></a>💡 決策流程圖</h2><h3 id="專案初始化決策指南"><a href="#專案初始化決策指南" class="headerlink" title="專案初始化決策指南"></a>專案初始化決策指南</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[&quot;開始新專案&quot;] --&gt; B&#123;&quot;專案類型選擇&quot;&#125;</span><br><span class="line">    </span><br><span class="line">    B --&gt;|企業級大型應用| C[&quot;選擇 Angular 19&lt;br/&gt;Standalone Components&quot;]</span><br><span class="line">    B --&gt;|中小型專案| D[&quot;考慮其他輕量框架&quot;]</span><br><span class="line">    </span><br><span class="line">    C --&gt; E&#123;&quot;UI 設計需求&quot;&#125;</span><br><span class="line">    E --&gt;|豐富的企業級 UI| F[&quot;採用 PrimeNG + Tailwind&quot;]</span><br><span class="line">    E --&gt;|客製化設計| G[&quot;僅使用 Tailwind CSS&quot;]</span><br><span class="line">    </span><br><span class="line">    F --&gt; H[&quot;建立功能模組架構&quot;]</span><br><span class="line">    G --&gt; H</span><br><span class="line">    </span><br><span class="line">    H --&gt; I&#123;&quot;團隊規模&quot;&#125;</span><br><span class="line">    I --&gt;|大型團隊| J[&quot;嚴格分層架構&lt;br/&gt;Core/Shared/Feature/Pages&quot;]</span><br><span class="line">    I --&gt;|小型團隊| K[&quot;簡化版分層架構&quot;]</span><br><span class="line">    </span><br><span class="line">    J --&gt; L[&quot;配置開發工具鏈&quot;]</span><br><span class="line">    K --&gt; L</span><br><span class="line">    </span><br><span class="line">    L --&gt; M[&quot;ESLint + Prettier + TypeScript&quot;]</span><br><span class="line">    M --&gt; N&#123;&quot;性能需求&quot;&#125;</span><br><span class="line">    </span><br><span class="line">    N --&gt;|需要 SEO| O[&quot;啟用 SSR 配置&quot;]</span><br><span class="line">    N --&gt;|SPA 即可| P[&quot;客戶端渲染&quot;]</span><br><span class="line">    </span><br><span class="line">    O --&gt; Q[&quot;專案初始化完成&quot;]</span><br><span class="line">    P --&gt; Q</span><br><span class="line">    </span><br><span class="line">    Q --&gt; R[&quot;開始功能開發&quot;]</span><br></pre></td></tr></table></figure>

<h3 id="技術選型決策要點"><a href="#技術選型決策要點" class="headerlink" title="技術選型決策要點"></a>技術選型決策要點</h3><table>
<thead>
<tr>
<th>決策點</th>
<th>選擇標準</th>
<th>推薦方案</th>
</tr>
</thead>
<tbody><tr>
<td><strong>前端框架</strong></td>
<td>企業級、大型專案、長期維護</td>
<td>Angular 19 + Standalone Components</td>
</tr>
<tr>
<td><strong>UI 框架</strong></td>
<td>豐富元件、一致性設計、快速開發</td>
<td>PrimeNG + Tailwind CSS</td>
</tr>
<tr>
<td><strong>狀態管理</strong></td>
<td>中小型專案、簡單狀態</td>
<td>Angular Signals</td>
</tr>
<tr>
<td><strong>狀態管理</strong></td>
<td>複雜狀態、大型應用</td>
<td>NgRx Store</td>
</tr>
<tr>
<td><strong>樣式策略</strong></td>
<td>快速開發、響應式設計</td>
<td>Tailwind CSS + SCSS</td>
</tr>
<tr>
<td><strong>代碼品質</strong></td>
<td>團隊協作、一致性</td>
<td>ESLint + Prettier + TypeScript</td>
</tr>
</tbody></table>
<h2 id="🎯-核心洞察總結"><a href="#🎯-核心洞察總結" class="headerlink" title="🎯 核心洞察總結"></a>🎯 核心洞察總結</h2><h3 id="🏗️-架構設計洞察"><a href="#🏗️-架構設計洞察" class="headerlink" title="🏗️ 架構設計洞察"></a>🏗️ 架構設計洞察</h3><ol>
<li><p><strong>分層架構的價值</strong></p>
<ul>
<li><strong>職責清晰</strong>：每層都有明確的責任範圍，避免代碼混亂</li>
<li><strong>依賴隔離</strong>：功能模組間相互獨立，便於並行開發</li>
<li><strong>易於測試</strong>：清晰的分層便於單元測試和整合測試</li>
</ul>
</li>
<li><p><strong>Standalone Components 優勢</strong></p>
<ul>
<li><strong>減少複雜度</strong>：無需管理 NgModule 的繁瑣依賴關係</li>
<li><strong>Tree-shaking 友好</strong>：更好的打包優化，減少最終包大小</li>
<li><strong>組件自包含</strong>：每個組件明確聲明自己的依賴</li>
</ul>
</li>
<li><p><strong>功能模組化策略</strong></p>
<ul>
<li><strong>延遲載入</strong>：首屏載入速度提升 40-60%</li>
<li><strong>開發效率</strong>：不同功能模組可並行開發，提升團隊協作效率</li>
<li><strong>維護性</strong>：功能邊界清晰，bug 定位和修復更容易</li>
</ul>
</li>
</ol>
<h3 id="⚡-效能優化策略"><a href="#⚡-效能優化策略" class="headerlink" title="⚡ 效能優化策略"></a>⚡ 效能優化策略</h3><ol>
<li><p><strong>載入性能優化</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 延遲載入實現</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;feature&#x27;</span>,</span><br><span class="line">    <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./feature.component&#x27;</span>),</span><br><span class="line">    <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./feature/routes&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>變更檢測優化</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">changeDetection</span>: <span class="title class_">ChangeDetectionStrategy</span>.<span class="property">OnPush</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">OptimizedComponent</span> &#123;</span><br><span class="line">  <span class="comment">// 使用 Signals 優化響應式更新</span></span><br><span class="line">  data = signal&lt;<span class="title class_">DataType</span>[]&gt;([]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Signals 狀態管理</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取代傳統的 Subject + Observable 模式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">DataService</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> _data = signal&lt;<span class="title class_">Data</span>[]&gt;([]);</span><br><span class="line">  data = <span class="variable language_">this</span>.<span class="property">_data</span>.<span class="title function_">asReadonly</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">updateData</span>(<span class="params"><span class="attr">newData</span>: <span class="title class_">Data</span>[]</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_data</span>.<span class="title function_">set</span>(newData);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="🔧-開發體驗優化"><a href="#🔧-開發體驗優化" class="headerlink" title="🔧 開發體驗優化"></a>🔧 開發體驗優化</h3><ol>
<li><p><strong>類型安全保證</strong></p>
<ul>
<li>TypeScript 嚴格模式確保編譯時錯誤檢查</li>
<li>介面定義明確的 API 契約</li>
<li>泛型使用提升代碼復用性</li>
</ul>
</li>
<li><p><strong>代碼品質控制</strong></p>
<ul>
<li>ESLint 自動檢查代碼規範問題</li>
<li>Prettier 統一代碼格式</li>
<li>Git hooks 確保提交品質</li>
</ul>
</li>
</ol>
<h2 id="🚀-進階應用策略"><a href="#🚀-進階應用策略" class="headerlink" title="🚀 進階應用策略"></a>🚀 進階應用策略</h2><h3 id="1-微前端架構擴展"><a href="#1-微前端架構擴展" class="headerlink" title="1. 微前端架構擴展"></a>1. 微前端架構擴展</h3><p>當專案需要擴展為微前端架構時，本初始化方案提供良好的基礎：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Module Federation 配置範例</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ModuleFederationPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;@module-federation/webpack&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;shell&#x27;</span>,</span><br><span class="line">      <span class="attr">remotes</span>: &#123;</span><br><span class="line">        <span class="attr">userModule</span>: <span class="string">&#x27;userModule@http://localhost:4201/remoteEntry.js&#x27;</span>,</span><br><span class="line">        <span class="attr">systemModule</span>: <span class="string">&#x27;systemModule@http://localhost:4202/remoteEntry.js&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-國際化支援策略"><a href="#2-國際化支援策略" class="headerlink" title="2. 國際化支援策略"></a>2. 國際化支援策略</h3><p><strong>安裝 Angular i18n</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng add @angular/localize</span><br></pre></td></tr></table></figure>

<p><strong>多語言配置</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 app.config.ts 中配置</span></span><br><span class="line"><span class="keyword">import</span> &#123; provideAnimationsAsync &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser/animations/async&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; registerLocaleData &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> localeZhTw <span class="keyword">from</span> <span class="string">&#x27;@angular/common/locales/zh-Hant-TW&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">registerLocaleData</span>(localeZhTw);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    &#123; <span class="attr">provide</span>: <span class="variable constant_">LOCALE_ID</span>, <span class="attr">useValue</span>: <span class="string">&#x27;zh-TW&#x27;</span> &#125;,</span><br><span class="line">    <span class="comment">// 其他配置...</span></span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-PWA-功能集成"><a href="#3-PWA-功能集成" class="headerlink" title="3. PWA 功能集成"></a>3. PWA 功能集成</h3><p><strong>安裝 PWA 支援</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng add @angular/pwa</span><br></pre></td></tr></table></figure>

<p><strong>Service Worker 自訂</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 app.config.ts 中</span></span><br><span class="line"><span class="keyword">import</span> &#123; isDevMode &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServiceWorker &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/service-worker&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    <span class="title function_">provideServiceWorker</span>(<span class="string">&#x27;ngsw-worker.js&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">enabled</span>: !<span class="title function_">isDevMode</span>(),</span><br><span class="line">      <span class="attr">registrationStrategy</span>: <span class="string">&#x27;registerWhenStable:30000&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="4-測試策略完善"><a href="#4-測試策略完善" class="headerlink" title="4. 測試策略完善"></a>4. 測試策略完善</h3><p><strong>單元測試配置</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 功能模組測試範例</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;FeatureComponent&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">component</span>: <span class="title class_">FeatureComponent</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">fixture</span>: <span class="title class_">ComponentFixture</span>&lt;<span class="title class_">FeatureComponent</span>&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">TestBed</span>.<span class="title function_">configureTestingModule</span>(&#123;</span><br><span class="line">      <span class="attr">imports</span>: [<span class="title class_">FeatureComponent</span>], <span class="comment">// Standalone Component 測試</span></span><br><span class="line">    &#125;).<span class="title function_">compileComponents</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should create&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(component).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>E2E 測試整合</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安裝 Cypress 進行 E2E 測試</span></span><br><span class="line">npm install --save-dev cypress @cypress/schematic</span><br><span class="line">ng add @cypress/schematic</span><br></pre></td></tr></table></figure>

<h3 id="5-CI-CD-管道設置"><a href="#5-CI-CD-管道設置" class="headerlink" title="5. CI&#x2F;CD 管道設置"></a>5. CI&#x2F;CD 管道設置</h3><p><strong>GitHub Actions 範例</strong>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">CI/CD</span> <span class="string">Pipeline</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">main</span>, <span class="string">develop</span> ]</span><br><span class="line">  <span class="attr">pull_request:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">main</span> ]</span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/setup-node@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&#x27;18&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">lint</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">test:ci</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br></pre></td></tr></table></figure>

<h2 id="📞-技術支援與參考資源"><a href="#📞-技術支援與參考資源" class="headerlink" title="📞 技術支援與參考資源"></a>📞 技術支援與參考資源</h2><h3 id="🛠️-實用工具推薦"><a href="#🛠️-實用工具推薦" class="headerlink" title="🛠️ 實用工具推薦"></a>🛠️ 實用工具推薦</h3><table>
<thead>
<tr>
<th>工具分類</th>
<th>推薦工具</th>
<th>用途說明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>開發工具</strong></td>
<td>Visual Studio Code + Angular Language Service</td>
<td>最佳的 Angular 開發體驗</td>
</tr>
<tr>
<td><strong>調試工具</strong></td>
<td>Angular DevTools</td>
<td>組件檢查、效能分析</td>
</tr>
<tr>
<td><strong>API 開發</strong></td>
<td>JSON Server, MockAPI</td>
<td>快速建立模擬 API</td>
</tr>
<tr>
<td><strong>圖示資源</strong></td>
<td>PrimeIcons, Heroicons</td>
<td>豐富的圖示庫</td>
</tr>
<tr>
<td><strong>狀態管理</strong></td>
<td>NgRx DevTools</td>
<td>複雜狀態調試</td>
</tr>
</tbody></table>
<h3 id="📚-官方文件資源"><a href="#📚-官方文件資源" class="headerlink" title="📚 官方文件資源"></a>📚 官方文件資源</h3><ul>
<li><strong>Angular 官方文件</strong>：<a target="_blank" rel="noopener" href="https://angular.io/docs">https://angular.io/docs</a></li>
<li><strong>PrimeNG 元件庫</strong>：<a target="_blank" rel="noopener" href="https://primeng.org/">https://primeng.org/</a></li>
<li><strong>Tailwind CSS 文件</strong>：<a target="_blank" rel="noopener" href="https://tailwindcss.com/docs">https://tailwindcss.com/docs</a></li>
<li><strong>TypeScript 手冊</strong>：<a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/">https://www.typescriptlang.org/docs/</a></li>
</ul>
<h3 id="🌐-社群資源"><a href="#🌐-社群資源" class="headerlink" title="🌐 社群資源"></a>🌐 社群資源</h3><ul>
<li><strong>Angular 台灣社群</strong>：<a target="_blank" rel="noopener" href="https://www.facebook.com/groups/angular.tw">https://www.facebook.com/groups/angular.tw</a></li>
<li><strong>Angular Blog</strong>：<a target="_blank" rel="noopener" href="https://blog.angular.io/">https://blog.angular.io/</a></li>
<li><strong>NgConf 影片資源</strong>：<a target="_blank" rel="noopener" href="https://www.youtube.com/c/ngconf">https://www.youtube.com/c/ngconf</a></li>
</ul>
<h3 id="📖-延伸閱讀建議"><a href="#📖-延伸閱讀建議" class="headerlink" title="📖 延伸閱讀建議"></a>📖 延伸閱讀建議</h3><ol>
<li><strong>《Angular 企業級應用開發》</strong> - 深入學習企業級開發模式</li>
<li><strong>《Clean Architecture》</strong> - Robert C. Martin 的架構設計思想</li>
<li><strong>《Refactoring》</strong> - Martin Fowler 的重構技巧</li>
<li><strong>《You Don’t Know JS》</strong> - 深入理解 JavaScript 核心概念</li>
</ol>
<h3 id="🔧-問題排除指南"><a href="#🔧-問題排除指南" class="headerlink" title="🔧 問題排除指南"></a>🔧 問題排除指南</h3><p><strong>常見初始化問題</strong>：</p>
<ol>
<li><p><strong>Node.js 版本不相容</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 nvm 管理 Node.js 版本</span></span><br><span class="line">nvm install 18.19.0</span><br><span class="line">nvm use 18.19.0</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>套件安裝失敗</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除 npm 快取</span></span><br><span class="line">npm cache clean --force</span><br><span class="line"><span class="built_in">rm</span> -rf node_modules package-lock.json</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ESLint 配置衝突</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新安裝 ESLint 相關套件</span></span><br><span class="line">npm uninstall eslint @angular-eslint/*</span><br><span class="line">npm install -D eslint@latest @angular-eslint/eslint-plugin@latest</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="🔗-相關文章連結"><a href="#🔗-相關文章連結" class="headerlink" title="🔗 相關文章連結"></a>🔗 相關文章連結</h2><p>由於這是專案初始化指南，建議後續閱讀以下主題的深入文章：</p>
<h3 id="📚-系列文章建議"><a href="#📚-系列文章建議" class="headerlink" title="📚 系列文章建議"></a>📚 系列文章建議</h3><ul>
<li><strong>後續文章</strong>：Angular 19 功能模組開發實戰指南 - 基於本架構的功能開發實作</li>
<li><strong>後續文章</strong>：PrimeNG + Tailwind CSS 設計系統建立指南 - UI 設計系統的完整實作</li>
</ul>
<h3 id="🎯-相關主題"><a href="#🎯-相關主題" class="headerlink" title="🎯 相關主題"></a>🎯 相關主題</h3><ul>
<li><strong>並行文章</strong>：Vue 3 企業級專案架構指南 - 不同框架的架構對比</li>
<li><strong>對比文章</strong>：React 18 現代化開發架構 - 主流前端框架比較分析</li>
</ul>
<h3 id="📋-延伸閱讀"><a href="#📋-延伸閱讀" class="headerlink" title="📋 延伸閱讀"></a>📋 延伸閱讀</h3><ul>
<li><strong>深入研究</strong>：Angular 效能優化進階技巧 - 更深入的效能調優策略</li>
<li><strong>實踐案例</strong>：企業級前端專案 CI&#x2F;CD 實戰 - 完整的部署管道建立</li>
</ul>
<hr>
<p><strong>作者資訊</strong>：<br><em>本文由前端架構專家撰寫，基於多年企業級 Angular 專案開發經驗整理而成。</em></p>
<p><strong>版本資訊</strong>：<br><em>版本 v1.0 | 發布日期：2025年6月29日 | 基於 Angular 19.2.2</em> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cookieseventeen.github.io/2025/06/29/angular-enterprise-project-initialization-guide/" data-id="cmg51yfqc0000anmz87ja7q47" data-title="Angular 19 企業級前端專案初始化完整指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-19/" rel="tag">Angular 19</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Clean-Architecture/" rel="tag">Clean Architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Enterprise-Architecture/" rel="tag">Enterprise Architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Feature-Modules/" rel="tag">Feature Modules</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Frontend-Initialization/" rel="tag">Frontend Initialization</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PrimeNG/" rel="tag">PrimeNG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Project-Architecture/" rel="tag">Project Architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Project-Setup/" rel="tag">Project Setup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSR/" rel="tag">SSR</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Signals/" rel="tag">Signals</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Standalone-Components/" rel="tag">Standalone Components</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tailwind-CSS/" rel="tag">Tailwind CSS</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-angular-ssr-transloco-troubleshooting-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/29/angular-ssr-transloco-troubleshooting-guide/" class="article-date">
  <time class="dt-published" datetime="2025-06-29T09:00:00.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech-Daily/">Tech Daily</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/29/angular-ssr-transloco-troubleshooting-guide/">Angular SSR + Transloco 故障排除與除錯完整指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="📋-核心懶人包"><a href="#📋-核心懶人包" class="headerlink" title="📋 核心懶人包"></a>📋 核心懶人包</h2><ol>
<li><strong>NullInjectorError 根因</strong>：90% 由配置合併失敗或 Token 缺失造成，重點檢查 server config</li>
<li><strong>SSR Loader 除錯</strong>：透過 console log 追蹤載入流程，確認初始化和檔案讀取狀態</li>
<li><strong>路徑問題診斷</strong>：專案名稱不一致是最常見陷阱，必須檢查建置輸出目錄</li>
<li><strong>環境差異處理</strong>：開發和生產環境的不同配置需求和解決方案</li>
<li><strong>系統性除錯法</strong>：分層檢查從配置→建置→運行，快速定位問題根源</li>
</ol>
<h2 id="🏗️-專案概述"><a href="#🏗️-專案概述" class="headerlink" title="🏗️ 專案概述"></a>🏗️ 專案概述</h2><p>本指南專注於 Angular SSR + Transloco 的故障排除，提供系統性的除錯方法和解決方案：</p>
<ul>
<li>🔍 <strong>錯誤分析</strong>：常見錯誤的根本原因分析和快速診斷</li>
<li>🛠️ <strong>除錯技巧</strong>：有效的除錯工具和方法論</li>
<li>⚡ <strong>快速修復</strong>：常見問題的立即解決方案</li>
<li>🚀 <strong>預防措施</strong>：避免常見陷阱的最佳實踐</li>
<li>📊 <strong>監控策略</strong>：生產環境的錯誤監控和處理</li>
</ul>
<h2 id="🏗️-故障排除流程架構"><a href="#🏗️-故障排除流程架構" class="headerlink" title="🏗️ 故障排除流程架構"></a>🏗️ 故障排除流程架構</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[發現 SSR + Transloco 問題] --&gt; B&#123;錯誤類型判斷&#125;</span><br><span class="line">    </span><br><span class="line">    B --&gt;|NullInjectorError| C[Token 注入問題]</span><br><span class="line">    B --&gt;|HTTP 404| D[檔案載入問題]</span><br><span class="line">    B --&gt;|翻譯內容錯誤| E[語系檔案問題]</span><br><span class="line">    B --&gt;|SSR 啟動失敗| F[配置問題]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1[檢查 server config 合併]</span><br><span class="line">    C --&gt; C2[驗證 TRANSLOCO_LOADER token]</span><br><span class="line">    </span><br><span class="line">    D --&gt; D1[檢查專案名稱一致性]</span><br><span class="line">    D --&gt; D2[驗證 assets 配置]</span><br><span class="line">    </span><br><span class="line">    E --&gt; E1[檢查 JSON 格式]</span><br><span class="line">    E --&gt; E2[驗證語系檔案路徑]</span><br><span class="line">    </span><br><span class="line">    F --&gt; F1[檢查 main.server.ts]</span><br><span class="line">    F --&gt; F2[驗證配置合併]</span><br><span class="line">    </span><br><span class="line">    C1 --&gt; G[修復並測試]</span><br><span class="line">    C2 --&gt; G</span><br><span class="line">    D1 --&gt; G</span><br><span class="line">    D2 --&gt; G</span><br><span class="line">    E1 --&gt; G</span><br><span class="line">    E2 --&gt; G</span><br><span class="line">    F1 --&gt; G</span><br><span class="line">    F2 --&gt; G</span><br><span class="line">    </span><br><span class="line">    G --&gt; H&#123;問題解決?&#125;</span><br><span class="line">    H --&gt;|否| I[深度除錯]</span><br><span class="line">    H --&gt;|是| J[部署驗證]</span><br><span class="line">    </span><br><span class="line">    I --&gt; K[啟用詳細日誌]</span><br><span class="line">    K --&gt; L[分析錯誤堆疊]</span><br><span class="line">    L --&gt; M[查閱文檔]</span><br><span class="line">    M --&gt; G</span><br><span class="line">    </span><br><span class="line">    J --&gt; N[完成修復 ✅]</span><br></pre></td></tr></table></figure>

<h1 id="Angular-SSR-Transloco-國際化問題診斷與完整解決方案"><a href="#Angular-SSR-Transloco-國際化問題診斷與完整解決方案" class="headerlink" title="Angular SSR + Transloco 國際化問題診斷與完整解決方案"></a>Angular SSR + Transloco 國際化問題診斷與完整解決方案</h1><h2 id="📖-問題背景與初始症狀"><a href="#📖-問題背景與初始症狀" class="headerlink" title="📖 問題背景與初始症狀"></a>📖 <strong>問題背景與初始症狀</strong></h2><p>在實施 Angular 前端專案的 SSR (Server-Side Rendering) 和國際化功能時，遇到了一個看似簡單但實際複雜的問題：</p>
<h3 id="初始症狀"><a href="#初始症狀" class="headerlink" title="初始症狀"></a><strong>初始症狀</strong></h3><ol>
<li>SSR 環境中存在 TypeScript 錯誤</li>
<li>無法看到 SSR Transloco 的 log 輸出</li>
<li>不確定語系檔案是否在 SSR 階段正確載入</li>
</ol>
<h3 id="技術環境"><a href="#技術環境" class="headerlink" title="技術環境"></a><strong>技術環境</strong></h3><ul>
<li>Angular 19.2.14</li>
<li>Transloco (@jsverse&#x2F;transloco)</li>
<li>SSR + 預渲染 (Prerendered 5 static routes)</li>
<li>Node.js v23.10.0</li>
<li>TypeScript</li>
</ul>
<h2 id="🔍-診斷過程：從表象到根因"><a href="#🔍-診斷過程：從表象到根因" class="headerlink" title="🔍 診斷過程：從表象到根因"></a>🔍 <strong>診斷過程：從表象到根因</strong></h2><h3 id="第一階段：表面問題修復"><a href="#第一階段：表面問題修復" class="headerlink" title="第一階段：表面問題修復"></a><strong>第一階段：表面問題修復</strong></h3><p><strong>誤判</strong>：以為只是簡單的 TypeScript 類型標註問題</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 原始問題代碼</span></span><br><span class="line"><span class="title function_">getTranslation</span>(<span class="params"><span class="attr">lang</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 缺少返回類型標註</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 修正後</span></span><br><span class="line"><span class="title function_">getTranslation</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">Translation</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// 添加了明確的返回類型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>結果</strong>：TypeScript 錯誤解決，但核心問題依然存在。</p>
<h3 id="第二階段：Log-輸出問題"><a href="#第二階段：Log-輸出問題" class="headerlink" title="第二階段：Log 輸出問題"></a><strong>第二階段：Log 輸出問題</strong></h3><p><strong>發現</strong>：無法看到任何 SSR Transloco 的 log 輸出</p>
<p><strong>初步嘗試</strong>：</p>
<ul>
<li>檢查 console.log 是否被禁用</li>
<li>檢查 Transloco 的 prodMode 設置</li>
<li>添加更多 log 語句</li>
</ul>
<p><strong>部分原因</strong>：</p>
<ol>
<li>生產環境 <code>console.log</code> 被重寫為空函數</li>
<li>Transloco 的 <code>prodMode: !isDevMode()</code> 禁用了內部 log</li>
</ol>
<h3 id="第三階段：深入配置問題"><a href="#第三階段：深入配置問題" class="headerlink" title="第三階段：深入配置問題"></a><strong>第三階段：深入配置問題</strong></h3><p><strong>🔍 關鍵診斷思路：補足缺失的 Injection Token</strong></p>
<p>當時我們採用的正確修復方向是：<strong>識別並補足缺失的 injection token</strong></p>
<h4 id="A-錯誤訊息分析"><a href="#A-錯誤訊息分析" class="headerlink" title="A. 錯誤訊息分析"></a><strong>A. 錯誤訊息分析</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ERROR Error [NullInjectorError]: R3InjectorError(Standalone[_ComponentDemoComponent])[_TranslocoService -&gt; _TranslocoService -&gt; InjectionToken TRANSLOCO_TRANSPILER -&gt; InjectionToken TRANSLOCO_TRANSPILER]:</span><br><span class="line">  NullInjectorError: No provider <span class="keyword">for</span> InjectionToken TRANSLOCO_TRANSPILER!</span><br><span class="line">    at NullInjector.get (.../chunk-PXXRCHXC.js:13045:21)</span><br><span class="line">    at R3Injector.get (.../chunk-PXXRCHXC.js:13396:27)</span><br></pre></td></tr></table></figure>

<h4 id="B-問題定位思路"><a href="#B-問題定位思路" class="headerlink" title="B. 問題定位思路"></a><strong>B. 問題定位思路</strong></h4><ol>
<li><strong>識別缺失的 Token</strong>：<code>TRANSLOCO_TRANSPILER</code> 在 SSR 環境中找不到</li>
<li><strong>分析依賴鏈</strong>：<code>TranslocoService</code> → <code>TRANSLOCO_TRANSPILER</code> token 缺失</li>
<li><strong>檢查配置來源</strong>：<code>main.server.ts</code> 使用了哪個配置檔案？</li>
<li><strong>追蹤 Provider 註冊</strong>：server config 中是否有 Transloco 相關的完整 provider？</li>
</ol>
<h4 id="C-修復策略確定"><a href="#C-修復策略確定" class="headerlink" title="C. 修復策略確定"></a><strong>C. 修復策略確定</strong></h4><p>✅ <strong>補足策略</strong>：</p>
<ul>
<li>確保 <code>main.server.ts</code> 使用正確的 server config</li>
<li>在 <code>app.config.server.ts</code> 中提供完整的 Transloco providers</li>
<li>檢查是否需要額外的 <code>TRANSLOCO_TRANSPILER</code> 和 <code>TRANSLOCO_LOADER</code> 配置</li>
<li>避免瀏覽器端和服務器端 provider 衝突</li>
</ul>
<p><strong>關鍵發現</strong>：<code>main.server.ts</code> 配置錯誤</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 錯誤配置</span></span><br><span class="line"><span class="keyword">import</span> &#123; config &#125; <span class="keyword">from</span> <span class="string">&#x27;./app/app.config&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> server = <span class="title function_">createExpressServer</span>(config); <span class="comment">// 使用錯誤的配置</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正確配置</span></span><br><span class="line"><span class="keyword">import</span> &#123; config &#125; <span class="keyword">from</span> <span class="string">&#x27;./app/app.config.server&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> server = <span class="title function_">createExpressServer</span>(config); <span class="comment">// 使用正確的 server 配置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>根本原因</strong>：沒有使用 <code>app.config.server.ts</code> 導致 <code>TRANSLOCO_TRANSPILER</code> 等 Transloco 相關 tokens 未被註冊！</p>
<h2 id="🌀-實際解決過程：迷惘與試錯的完整歷程"><a href="#🌀-實際解決過程：迷惘與試錯的完整歷程" class="headerlink" title="🌀 實際解決過程：迷惘與試錯的完整歷程"></a>🌀 <strong>實際解決過程：迷惘與試錯的完整歷程</strong></h2><p><strong>這是最重要的部分 - 展示真實的解決思路演進，包括所有的錯誤判斷和陷阱！</strong></p>
<h3 id="階段-1：初始-Token-問題解決-✅"><a href="#階段-1：初始-Token-問題解決-✅" class="headerlink" title="階段 1：初始 Token 問題解決 ✅"></a><strong>階段 1：初始 Token 問題解決</strong> ✅</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: No provider <span class="keyword">for</span> InjectionToken TRANSLOCO_TRANSPILER!</span><br></pre></td></tr></table></figure>

<p><strong>行動</strong>：補足 server config，確保 <code>main.server.ts</code> 使用 <code>app.config.server.ts</code><br><strong>結果</strong>：Token 錯誤消失，以為問題解決了</p>
<h3 id="階段-2：發現新問題-😕"><a href="#階段-2：發現新問題-😕" class="headerlink" title="階段 2：發現新問題 😕"></a><strong>階段 2：發現新問題</strong> 😕</h3><p><strong>新症狀</strong>：頁面可以渲染，但是：</p>
<ul>
<li>沒有看到任何 SSR log 輸出</li>
<li>不確定語系檔案是否真的在 SSR 階段載入</li>
<li>懷疑 SSR Transloco 根本沒有工作</li>
</ul>
<p><strong>初步判斷</strong>：可能需要專用的 SSR Loader</p>
<h3 id="階段-3：陷入-Loader-配置迷宮-🌀"><a href="#階段-3：陷入-Loader-配置迷宮-🌀" class="headerlink" title="階段 3：陷入 Loader 配置迷宮 🌀"></a><strong>階段 3：陷入 Loader 配置迷宮</strong> 🌀</h3><p><strong>我們卡在這裡很久！反覆嘗試不同的 Loader 配置方式：</strong></p>
<h4 id="嘗試-A：基本-SSR-Loader"><a href="#嘗試-A：基本-SSR-Loader" class="headerlink" title="嘗試 A：基本 SSR Loader"></a><strong>嘗試 A：基本 SSR Loader</strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 創建了 TranslocoSSRLoader，實現文件系統讀取</span></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TranslocoSSRLoader</span> <span class="keyword">implements</span> <span class="title class_">TranslocoLoader</span> &#123;</span><br><span class="line">    <span class="title function_">getTranslation</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">Translation</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// 基本文件讀取邏輯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>結果</strong>：還是沒有 log 輸出</p>
<h4 id="嘗試-B：調整路徑策略"><a href="#嘗試-B：調整路徑策略" class="headerlink" title="嘗試 B：調整路徑策略"></a><strong>嘗試 B：調整路徑策略</strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以為是路徑問題，嘗試多種路徑配置</span></span><br><span class="line"><span class="keyword">const</span> paths = [</span><br><span class="line">    <span class="string">&#x27;./assets/i18n/$&#123;lang&#125;.json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;./dist/assets/i18n/$&#123;lang&#125;.json&#x27;</span>,</span><br><span class="line">    <span class="comment">// ... 各種路徑組合</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p><strong>結果</strong>：還是沒有 log 輸出</p>
<h4 id="嘗試-C：修改-Provider-配置"><a href="#嘗試-C：修改-Provider-配置" class="headerlink" title="嘗試 C：修改 Provider 配置"></a><strong>嘗試 C：修改 Provider 配置</strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 嘗試不同的 provider 註冊方式</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">provide</span>: <span class="variable constant_">TRANSLOCO_LOADER</span>,</span><br><span class="line">    <span class="attr">useClass</span>: <span class="title class_">TranslocoSSRLoader</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// vs</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">provide</span>: <span class="variable constant_">TRANSLOCO_LOADER</span>,</span><br><span class="line">    <span class="attr">useFactory</span>: <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">TranslocoSSRLoader</span>(),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>結果</strong>：還是沒有 log 輸出！</p>
<h3 id="階段-4：盲目測試階段-🤷‍♂️"><a href="#階段-4：盲目測試階段-🤷‍♂️" class="headerlink" title="階段 4：盲目測試階段 🤷‍♂️"></a><strong>階段 4：盲目測試階段</strong> 🤷‍♂️</h3><p><strong>這時我們變得很盲目，不斷嘗試各種配置：</strong></p>
<ul>
<li>調整 Loader 實現細節</li>
<li>修改文件路徑策略</li>
<li>嘗試不同的 log 輸出方式</li>
<li>檢查 TypeScript 配置</li>
<li>懷疑 ES modules 問題</li>
</ul>
<p><strong>核心困惑</strong>：為什麼創建了 SSR Loader 但完全沒有任何 log 輸出？</p>
<h3 id="階段-5：環境設定檢討-🔍"><a href="#階段-5：環境設定檢討-🔍" class="headerlink" title="階段 5：環境設定檢討 🔍"></a><strong>階段 5：環境設定檢討</strong> 🔍</h3><p><strong>開始懷疑是環境設定問題：</strong></p>
<h4 id="懷疑-A：console-log-被禁用"><a href="#懷疑-A：console-log-被禁用" class="headerlink" title="懷疑 A：console.log 被禁用"></a><strong>懷疑 A：console.log 被禁用</strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 檢查生產環境配置</span></span><br><span class="line"><span class="keyword">if</span> (environment.<span class="property">production</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="property">log</span> = <span class="function">() =&gt;</span> &#123;&#125;; <span class="comment">// 被禁用了？</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="懷疑-B：Transloco-prodMode"><a href="#懷疑-B：Transloco-prodMode" class="headerlink" title="懷疑 B：Transloco prodMode"></a><strong>懷疑 B：Transloco prodMode</strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 檢查 Transloco 配置</span></span><br><span class="line"><span class="title function_">provideTransloco</span>(&#123;</span><br><span class="line">    <span class="attr">config</span>: &#123;</span><br><span class="line">        <span class="attr">prodMode</span>: !<span class="title function_">isDevMode</span>(), <span class="comment">// 這個禁用了 log？</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="懷疑-C：建置環境問題"><a href="#懷疑-C：建置環境問題" class="headerlink" title="懷疑 C：建置環境問題"></a><strong>懷疑 C：建置環境問題</strong></h4><ul>
<li>檢查 dist 目錄結構</li>
<li>確認語系檔案是否正確複製</li>
<li>懷疑是 SSR 建置配置問題</li>
</ul>
<p><strong>結果</strong>：這些都不是根本原因！</p>
<h3 id="階段-6：關鍵突破時刻-💡"><a href="#階段-6：關鍵突破時刻-💡" class="headerlink" title="階段 6：關鍵突破時刻 💡"></a><strong>階段 6：關鍵突破時刻</strong> 💡</h3><p><strong>最終發現真相：SSR Loader 根本沒有被載入！</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 檢查實際運行時的 log</span></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;🚀 TranslocoSSRLoader 被初始化！&#x27;</span>); <span class="comment">// 這個 log 從來沒出現過！</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>關鍵洞察</strong>：如果 constructor 的 log 都沒出現，說明 SSR Loader 根本沒有被註冊或載入！</p>
<p><strong>深入檢查</strong>：</p>
<ol>
<li>檢查 <code>main.server.ts</code> 實際使用的配置</li>
<li>驗證 server config 是否真的被使用</li>
<li>確認 <code>mergeApplicationConfig</code> 是否正確合併</li>
</ol>
<p><strong>最終發現</strong>：雖然我們修改了 <code>app.config.server.ts</code>，但 <code>main.server.ts</code> 可能還是沒有正確使用這個配置！</p>
<h2 id="🎯-真正的問題根源"><a href="#🎯-真正的問題根源" class="headerlink" title="🎯 真正的問題根源"></a>🎯 <strong>真正的問題根源</strong></h2><p>經過深入分析，發現了三個層次的問題：</p>
<h3 id="1-配置層次問題"><a href="#1-配置層次問題" class="headerlink" title="1. 配置層次問題"></a><strong>1. 配置層次問題</strong></h3><ul>
<li><code>main.server.ts</code> 沒有使用正確的 server 配置</li>
<li>SSR 專用的 Transloco Loader 沒有被正確註冊</li>
</ul>
<h3 id="2-實現層次問題"><a href="#2-實現層次問題" class="headerlink" title="2. 實現層次問題"></a><strong>2. 實現層次問題</strong></h3><ul>
<li>缺少專用的 SSR Loader 實現</li>
<li>路徑解析機制不完善</li>
<li>ES modules 環境下的 <code>__dirname</code> 問題</li>
</ul>
<h3 id="3-調試層次問題"><a href="#3-調試層次問題" class="headerlink" title="3. 調試層次問題"></a><strong>3. 調試層次問題</strong></h3><ul>
<li>Log 輸出被多重禁用</li>
<li>缺少詳細的載入過程追蹤</li>
</ul>
<h3 id="4-Injection-Token-問題-🚨"><a href="#4-Injection-Token-問題-🚨" class="headerlink" title="4. Injection Token 問題 🚨"></a><strong>4. Injection Token 問題</strong> 🚨</h3><p><strong>這是最初的根本錯誤！</strong></p>
<ul>
<li>SSR 環境中找不到 <code>TRANSLOCO_TRANSPILER</code> injection token</li>
<li>Server config 中缺少正確的 provider 配置</li>
<li>Transloco 服務依賴的 transpiler 未在 SSR 環境中註冊</li>
<li>依賴注入解析失敗</li>
</ul>
<p><strong>實際錯誤訊息</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ERROR Error [NullInjectorError]: R3InjectorError(Standalone[_ComponentDemoComponent])[_TranslocoService -&gt; _TranslocoService -&gt; InjectionToken TRANSLOCO_TRANSPILER -&gt; InjectionToken TRANSLOCO_TRANSPILER]:</span><br><span class="line">  NullInjectorError: No provider <span class="keyword">for</span> InjectionToken TRANSLOCO_TRANSPILER!</span><br><span class="line">    at NullInjector.get (/Users/user/projects/example-project/.angular/cache/19.2.15/example_project_frontend/vite/deps_ssr/chunk-PXXRCHXC.js:13045:21)</span><br><span class="line">    at R3Injector.get (/Users/user/projects/example-project/.angular/cache/19.2.15/example_project_frontend/vite/deps_ssr/chunk-PXXRCHXC.js:13396:27)</span><br></pre></td></tr></table></figure>

<h3 id="5-資源配置問題-⚠️"><a href="#5-資源配置問題-⚠️" class="headerlink" title="5. 資源配置問題 ⚠️"></a><strong>5. 資源配置問題</strong> ⚠️</h3><p><strong>這是一個常被忽略但關鍵的問題！</strong></p>
<ul>
<li><code>angular.json</code> 中 assets 配置缺失或錯誤</li>
<li>語系檔案路徑結構不正確</li>
<li>建置後資源無法正確複製到目標位置</li>
</ul>
<h2 id="🔧-完整解決方案"><a href="#🔧-完整解決方案" class="headerlink" title="🔧 完整解決方案"></a>🔧 <strong>完整解決方案</strong></h2><h3 id="步驟-0：確保基礎資源配置正確-⚠️"><a href="#步驟-0：確保基礎資源配置正確-⚠️" class="headerlink" title="步驟 0：確保基礎資源配置正確 ⚠️"></a><strong>步驟 0：確保基礎資源配置正確</strong> ⚠️</h3><p><strong>這是最容易被忽略但必須正確的基礎配置！</strong></p>
<h4 id="A-檔案結構"><a href="#A-檔案結構" class="headerlink" title="A. 檔案結構"></a><strong>A. 檔案結構</strong></h4><p>確保語系檔案正確放置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">├── assets/</span><br><span class="line">│   └── i18n/</span><br><span class="line">│       ├── en.json</span><br><span class="line">│       └── zh-tw.json</span><br><span class="line">└── app/</span><br><span class="line">    └── ...</span><br></pre></td></tr></table></figure>

<h4 id="B-angular-json-配置"><a href="#B-angular-json-配置" class="headerlink" title="B. angular.json 配置"></a><strong>B. angular.json 配置</strong></h4><p><strong>關鍵配置</strong>：確保 <code>assets</code> 正確設定，否則語系檔案不會被複製到建置輸出！</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;projects&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;your-project&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;architect&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;assets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;public&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/assets&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/assets&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;assets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;public&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/assets&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/assets&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>重要說明</strong>：</p>
<ul>
<li><code>&quot;input&quot;: &quot;src/assets&quot;</code> - 指定源目錄</li>
<li><code>&quot;output&quot;: &quot;/assets&quot;</code> - 指定輸出路徑</li>
<li>這確保 <code>src/assets/i18n/*.json</code> 會被複製到 <code>dist/your-project/browser/assets/i18n/*.json</code></li>
</ul>
<h4 id="C-語系檔案範例"><a href="#C-語系檔案範例" class="headerlink" title="C. 語系檔案範例"></a><strong>C. 語系檔案範例</strong></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/assets/i18n/zh-tw.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;demo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Demo 展示中心&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;buttons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;primary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;主要動作&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;secondary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;次要動作&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/assets/i18n/en.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;demo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Demo Center&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;buttons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;primary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Primary Action&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;secondary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Secondary Action&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="步驟-1：解決-Injection-Token-問題-🚨"><a href="#步驟-1：解決-Injection-Token-問題-🚨" class="headerlink" title="步驟 1：解決 Injection Token 問題 🚨"></a><strong>步驟 1：解決 Injection Token 問題</strong> 🚨</h3><p><strong>最關鍵的第一步：修正 main.server.ts 和 Server Config</strong></p>
<h4 id="A-修正-main-server-ts"><a href="#A-修正-main-server-ts" class="headerlink" title="A. 修正 main.server.ts"></a><strong>A. 修正 main.server.ts</strong></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.server.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; bootstrapApplication &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/app/app.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; config &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/app/app.config.server&#x27;</span>; <span class="comment">// ✅ 關鍵：使用 server 配置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">bootstrapApplication</span>(<span class="title class_">AppComponent</span>, config);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>❌ 錯誤範例</strong> (會導致 injection token 錯誤)：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 直接使用瀏覽器端配置，會找不到 SSR Loader</span></span><br><span class="line"><span class="keyword">import</span> &#123; config &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/app/app.config&#x27;</span>; <span class="comment">// 錯誤！</span></span><br></pre></td></tr></table></figure>

<h4 id="B-正確配置-Server-Config"><a href="#B-正確配置-Server-Config" class="headerlink" title="B. 正確配置 Server Config"></a><strong>B. 正確配置 Server Config</strong></h4><p><strong>關鍵理解</strong>：<code>TRANSLOCO_TRANSPILER</code> 錯誤的根本原因是 SSR 環境缺少完整的 Transloco providers。瀏覽器端的 <code>provideTransloco()</code> 會自動提供包括 <code>TRANSLOCO_TRANSPILER</code> 在內的所有必要 tokens，但 SSR 環境需要正確合併這些配置。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/app.config.server.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApplicationConfig</span>, mergeApplicationConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRendering &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-server&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRouting &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/ssr&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">TRANSLOCO_LOADER</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; appConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.config&#x27;</span>; <span class="comment">// ✅ 關鍵：合併包含 provideTransloco() 的配置</span></span><br><span class="line"><span class="keyword">import</span> &#123; serverRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes.server&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslocoSSRLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./core/services/transloco-ssr.loader&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">serverConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="title function_">provideServerRendering</span>(),</span><br><span class="line">        <span class="title function_">provideServerRouting</span>(serverRoutes),</span><br><span class="line">        <span class="comment">// ✅ 為 SSR 環境提供專用的 loader（會覆蓋瀏覽器端的 loader）</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">provide</span>: <span class="variable constant_">TRANSLOCO_LOADER</span>,</span><br><span class="line">            <span class="attr">useClass</span>: <span class="title class_">TranslocoSSRLoader</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 關鍵：合併配置確保所有 Transloco providers（包括 TRANSLOCO_TRANSPILER）都被包含</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> config = <span class="title function_">mergeApplicationConfig</span>(appConfig, serverConfig);</span><br></pre></td></tr></table></figure>

<p><strong>❌ 常見錯誤範例</strong>：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 缺少 TRANSLOCO_LOADER provider</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">serverConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="title function_">provideServerRendering</span>(),</span><br><span class="line">        <span class="comment">// 缺少 TRANSLOCO_LOADER provider！</span></span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 使用錯誤的 loader</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">provide</span>: <span class="variable constant_">TRANSLOCO_LOADER</span>,</span><br><span class="line">    <span class="attr">useClass</span>: <span class="title class_">TranslocoBrowserLoader</span>, <span class="comment">// 錯誤！SSR 不能使用 HTTP loader</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="步驟-2：創建專用的-SSR-Transloco-Loader"><a href="#步驟-2：創建專用的-SSR-Transloco-Loader" class="headerlink" title="步驟 2：創建專用的 SSR Transloco Loader"></a><strong>步驟 2：創建專用的 SSR Transloco Loader</strong></h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/core/services/transloco-ssr.loader.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Translation</span>, <span class="title class_">TranslocoLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>(&#123; <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TranslocoSSRLoader</span> <span class="keyword">implements</span> <span class="title class_">TranslocoLoader</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 雙重輸出確保 log 可見</span></span><br><span class="line">        process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">&#x27;🚀 [SSR Transloco] TranslocoSSRLoader 被初始化！\n&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;🚀 [SSR Transloco] 伺服器端 Transloco Loader 已就緒&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getTranslation</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">Translation</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// 多路徑嘗試機制</span></span><br><span class="line">        <span class="keyword">const</span> possiblePaths = [</span><br><span class="line">            path.<span class="title function_">join</span>(</span><br><span class="line">                process.<span class="title function_">cwd</span>(),</span><br><span class="line">                <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;example_project_frontend&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;browser&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;assets&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;i18n&#x27;</span>,</span><br><span class="line">                <span class="string">`<span class="subst">$&#123;lang&#125;</span>.json`</span></span><br><span class="line">            ),</span><br><span class="line">            path.<span class="title function_">join</span>(process.<span class="title function_">cwd</span>(), <span class="string">&#x27;browser&#x27;</span>, <span class="string">&#x27;assets&#x27;</span>, <span class="string">&#x27;i18n&#x27;</span>, <span class="string">`<span class="subst">$&#123;lang&#125;</span>.json`</span>),</span><br><span class="line">            path.<span class="title function_">join</span>(process.<span class="title function_">cwd</span>(), <span class="string">&#x27;assets&#x27;</span>, <span class="string">&#x27;i18n&#x27;</span>, <span class="string">`<span class="subst">$&#123;lang&#125;</span>.json`</span>),</span><br><span class="line">            <span class="string">`./assets/i18n/<span class="subst">$&#123;lang&#125;</span>.json`</span>,</span><br><span class="line">            <span class="string">`./browser/assets/i18n/<span class="subst">$&#123;lang&#125;</span>.json`</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 詳細的載入過程追蹤</span></span><br><span class="line">        process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] 🚀 嘗試載入語系檔: <span class="subst">$&#123;lang&#125;</span>\n`</span>);</span><br><span class="line">        process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] 📂 工作目錄: <span class="subst">$&#123;process.cwd()&#125;</span>\n`</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> tryPath = <span class="title function_">async</span> (<span class="attr">pathIndex</span>: <span class="built_in">number</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">Translation</span>&gt; =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (pathIndex &gt;= possiblePaths.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`無法在任何路徑中找到語系檔: <span class="subst">$&#123;lang&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> filePath = possiblePaths[pathIndex];</span><br><span class="line">            process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] 📁 嘗試路徑 <span class="subst">$&#123;pathIndex + <span class="number">1</span>&#125;</span>: <span class="subst">$&#123;filePath&#125;</span>\n`</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="title class_">Translation</span>&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                fs.<span class="title function_">readFile</span>(filePath, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params"><span class="attr">err</span>: <span class="built_in">any</span>, <span class="attr">data</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (pathIndex &lt; possiblePaths.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">                            process.<span class="property">stdout</span>.<span class="title function_">write</span>(</span><br><span class="line">                                <span class="string">`[SSR Transloco] ⚠️ 路徑 <span class="subst">$&#123;pathIndex + <span class="number">1</span>&#125;</span> 失敗，嘗試下一個\n`</span></span><br><span class="line">                            );</span><br><span class="line">                            <span class="title function_">tryPath</span>(pathIndex + <span class="number">1</span>)</span><br><span class="line">                                .<span class="title function_">then</span>(resolve)</span><br><span class="line">                                .<span class="title function_">catch</span>(reject);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        process.<span class="property">stderr</span>.<span class="title function_">write</span>(</span><br><span class="line">                            <span class="string">`[SSR Transloco] ❌ 讀取語系檔失敗: <span class="subst">$&#123;lang&#125;</span> - <span class="subst">$&#123;err.message&#125;</span>\n`</span></span><br><span class="line">                        );</span><br><span class="line">                        <span class="keyword">return</span> <span class="title function_">reject</span>(err);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> translation = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data) <span class="keyword">as</span> <span class="title class_">Translation</span>;</span><br><span class="line">                        process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] ✅ 成功載入語系檔: <span class="subst">$&#123;lang&#125;</span>\n`</span>);</span><br><span class="line">                        <span class="title function_">resolve</span>(translation);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (parseErr) &#123;</span><br><span class="line">                        process.<span class="property">stderr</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] ❌ JSON 解析失敗: <span class="subst">$&#123;lang&#125;</span>\n`</span>);</span><br><span class="line">                        <span class="title function_">reject</span>(parseErr);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">tryPath</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="步驟-3：瀏覽器端-Loader-配置"><a href="#步驟-3：瀏覽器端-Loader-配置" class="headerlink" title="步驟 3：瀏覽器端 Loader 配置"></a><strong>步驟 3：瀏覽器端 Loader 配置</strong></h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/core/services/transloco.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; inject, <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Translation</span>, <span class="title class_">TranslocoLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; catchError, tap &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>(&#123; <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TranslocoBrowserLoader</span> <span class="keyword">implements</span> <span class="title class_">TranslocoLoader</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> http = <span class="title function_">inject</span>(<span class="title class_">HttpClient</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;🌐 [Browser Transloco] TranslocoBrowserLoader 被初始化！&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getTranslation</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="title class_">Observable</span>&lt;<span class="title class_">Translation</span>&gt; &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[Browser Transloco] 🌐 HTTP載入語系檔: <span class="subst">$&#123;lang&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="property">get</span>&lt;<span class="title class_">Translation</span>&gt;(<span class="string">`/assets/i18n/<span class="subst">$&#123;lang&#125;</span>.json`</span>).<span class="title function_">pipe</span>(</span><br><span class="line">            <span class="title function_">tap</span>(<span class="function">(<span class="params"><span class="attr">translation</span>: <span class="title class_">Translation</span></span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[Browser Transloco] ✅ HTTP載入成功: <span class="subst">$&#123;lang&#125;</span>`</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[Browser Transloco] 載入的 keys:`</span>, <span class="title class_">Object</span>.<span class="title function_">keys</span>(translation));</span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="title function_">catchError</span>(<span class="function">(<span class="params"><span class="attr">err</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[Browser Transloco] ❌ HTTP載入失敗: <span class="subst">$&#123;lang&#125;</span>`</span>, err);</span><br><span class="line">                <span class="keyword">throw</span> err;</span><br><span class="line">            &#125;)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="步驟-4：基礎應用配置"><a href="#步驟-4：基礎應用配置" class="headerlink" title="步驟 4：基礎應用配置"></a><strong>步驟 4：基礎應用配置</strong></h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/app.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApplicationConfig</span>, isDevMode &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideHttpClient, withFetch &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideTransloco, <span class="variable constant_">TRANSLOCO_LOADER</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslocoBrowserLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./core/services/transloco.config&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="title function_">provideHttpClient</span>(<span class="title function_">withFetch</span>()),</span><br><span class="line">        <span class="title function_">provideTransloco</span>(&#123;</span><br><span class="line">            <span class="attr">config</span>: &#123;</span><br><span class="line">                <span class="attr">availableLangs</span>: [<span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh-tw&#x27;</span>],</span><br><span class="line">                <span class="attr">defaultLang</span>: <span class="string">&#x27;zh-tw&#x27;</span>,</span><br><span class="line">                <span class="comment">// 開發模式下啟用 debug，生產模式下關閉</span></span><br><span class="line">                <span class="attr">prodMode</span>: !<span class="title function_">isDevMode</span>(),</span><br><span class="line">                <span class="attr">fallbackLang</span>: <span class="string">&#x27;en&#x27;</span>,</span><br><span class="line">                <span class="attr">reRenderOnLangChange</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">loader</span>: <span class="title class_">TranslocoBrowserLoader</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 瀏覽器環境使用 HTTP loader</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">provide</span>: <span class="variable constant_">TRANSLOCO_LOADER</span>,</span><br><span class="line">            <span class="attr">useClass</span>: <span class="title class_">TranslocoBrowserLoader</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="📊-測試結果與驗證"><a href="#📊-測試結果與驗證" class="headerlink" title="📊 測試結果與驗證"></a>📊 <strong>測試結果與驗證</strong></h2><h3 id="建置階段-Log-輸出"><a href="#建置階段-Log-輸出" class="headerlink" title="建置階段 Log 輸出"></a><strong>建置階段 Log 輸出</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">🚀 [SSR Transloco] TranslocoSSRLoader 被初始化！</span><br><span class="line">🚀 [SSR Transloco] 伺服器端 Transloco Loader 已就緒</span><br><span class="line">[SSR Transloco] 🚀 嘗試載入語系檔: zh-tw</span><br><span class="line">[SSR Transloco] 📂 工作目錄: /path/to/project</span><br><span class="line">[SSR Transloco] 📁 嘗試路徑 1-5: [多路徑嘗試機制正常運作]</span><br></pre></td></tr></table></figure>

<h3 id="頁面翻譯驗證"><a href="#頁面翻譯驗證" class="headerlink" title="頁面翻譯驗證"></a><strong>頁面翻譯驗證</strong></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo 展示中心<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>按鈕元件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>主要動作<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>次要動作<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="🔑-關鍵配置要點"><a href="#🔑-關鍵配置要點" class="headerlink" title="🔑 關鍵配置要點"></a>🔑 <strong>關鍵配置要點</strong></h2><h3 id="1-雙-Loader-策略"><a href="#1-雙-Loader-策略" class="headerlink" title="1. 雙 Loader 策略"></a><strong>1. 雙 Loader 策略</strong></h3><ul>
<li><strong>瀏覽器端</strong>：使用 HTTP 請求載入語系檔</li>
<li><strong>SSR 端</strong>：使用文件系統直接讀取</li>
</ul>
<h3 id="2-路徑解析策略"><a href="#2-路徑解析策略" class="headerlink" title="2. 路徑解析策略"></a><strong>2. 路徑解析策略</strong></h3><ul>
<li>實現多路徑嘗試機制</li>
<li>考慮建置後的檔案結構</li>
<li>處理 ES modules 環境限制</li>
</ul>
<h3 id="3-Log-輸出策略"><a href="#3-Log-輸出策略" class="headerlink" title="3. Log 輸出策略"></a><strong>3. Log 輸出策略</strong></h3><ul>
<li>使用 <code>process.stdout.write</code> 避免被禁用</li>
<li>雙重輸出確保可見性</li>
<li>詳細的過程追蹤</li>
</ul>
<h3 id="4-錯誤處理策略"><a href="#4-錯誤處理策略" class="headerlink" title="4. 錯誤處理策略"></a><strong>4. 錯誤處理策略</strong></h3><ul>
<li>Graceful fallback 機制</li>
<li>詳細的錯誤訊息</li>
<li>路徑失敗時的自動重試</li>
</ul>
<h2 id="💡-最佳實踐總結"><a href="#💡-最佳實踐總結" class="headerlink" title="💡 最佳實踐總結"></a>💡 <strong>最佳實踐總結</strong></h2><h3 id="配置檢查清單"><a href="#配置檢查清單" class="headerlink" title="配置檢查清單"></a><strong>配置檢查清單</strong></h3><h4 id="🏗️-基礎配置-最重要"><a href="#🏗️-基礎配置-最重要" class="headerlink" title="🏗️ 基礎配置 (最重要)"></a><strong>🏗️ 基礎配置 (最重要)</strong></h4><ul>
<li>✅ <strong>檔案結構</strong>：<code>src/assets/i18n/*.json</code> 正確放置</li>
<li>✅ <strong>angular.json</strong>：assets 配置正確設定 (<code>src/assets</code> → <code>/assets</code>)</li>
<li>✅ <strong>語系檔案</strong>：JSON 格式正確，無語法錯誤</li>
</ul>
<h4 id="🚨-Injection-Token-配置"><a href="#🚨-Injection-Token-配置" class="headerlink" title="🚨 Injection Token 配置"></a><strong>🚨 Injection Token 配置</strong></h4><ul>
<li>✅ <strong>main.server.ts</strong>：使用正確的 server config (<code>app.config.server.ts</code>)</li>
<li>✅ <strong>Server config</strong>：正確合併包含 <code>provideTransloco()</code> 的配置，確保 <code>TRANSLOCO_TRANSPILER</code> 等 tokens 被提供</li>
<li>✅ <strong>配置合併</strong>：使用 <code>mergeApplicationConfig(appConfig, serverConfig)</code> 確保完整的 provider 鏈</li>
<li>✅ <strong>SSR Loader</strong>：覆蓋瀏覽器端的 <code>TRANSLOCO_LOADER</code> 以支援文件系統讀取</li>
</ul>
<h4 id="🔧-SSR-配置"><a href="#🔧-SSR-配置" class="headerlink" title="🔧 SSR 配置"></a><strong>🔧 SSR 配置</strong></h4><ul>
<li>✅ 實現雙 Loader 策略 (SSR + Browser)</li>
<li>✅ 添加詳細的 log 追蹤</li>
<li>✅ 實現多路徑嘗試機制</li>
<li>✅ 正確的文件系統讀取邏輯</li>
</ul>
<h4 id="🌐-運行時驗證"><a href="#🌐-運行時驗證" class="headerlink" title="🌐 運行時驗證"></a><strong>🌐 運行時驗證</strong></h4><ul>
<li>✅ 建置後檔案存在：<code>dist/project/browser/assets/i18n/*.json</code></li>
<li>✅ SSR log 正常輸出</li>
<li>✅ 頁面翻譯內容正確顯示</li>
</ul>
<h3 id="調試技巧"><a href="#調試技巧" class="headerlink" title="調試技巧"></a><strong>調試技巧</strong></h3><h4 id="🚨-Injection-Token-問題診斷"><a href="#🚨-Injection-Token-問題診斷" class="headerlink" title="🚨 Injection Token 問題診斷"></a><strong>🚨 Injection Token 問題診斷</strong></h4><ol>
<li><strong>錯誤訊息關鍵字</strong>：留意 <code>No provider for InjectionToken TRANSLOCO_TRANSPILER</code> 和 <code>NullInjectorError</code></li>
<li><strong>配置檔案檢查</strong>：確認 <code>main.server.ts</code> 使用的是哪個配置檔案</li>
<li><strong>Provider 追蹤</strong>：檢查 server config 中是否有相應的 token provider</li>
<li><strong>環境差異分析</strong>：比較瀏覽器端和 SSR 端的 provider 配置差異</li>
</ol>
<h4 id="🌀-避免陷入-Loader-配置迷宮"><a href="#🌀-避免陷入-Loader-配置迷宮" class="headerlink" title="🌀 避免陷入 Loader 配置迷宮"></a><strong>🌀 避免陷入 Loader 配置迷宮</strong></h4><p><strong>關鍵檢查順序</strong> - 按這個順序進行，可以避免浪費時間：</p>
<ol>
<li><strong>最簡驗證</strong>：先在 SSR Loader constructor 中加入 <code>console.log</code>，確認是否被載入 <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;🚀 SSR Loader 被初始化了嗎？&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>配置追蹤</strong>：確認 <code>main.server.ts</code> → <code>app.config.server.ts</code> → <code>mergeApplicationConfig</code> 的完整鏈路</li>
<li><strong>Provider 驗證</strong>：確認 server config 中的 provider 是否正確註冊</li>
<li><strong>只有確認 Loader 被載入後，才開始調試實現細節</strong></li>
</ol>
<h4 id="🔧-實現問題調試"><a href="#🔧-實現問題調試" class="headerlink" title="🔧 實現問題調試"></a><strong>🔧 實現問題調試</strong></h4><ol>
<li><strong>使用雙重 log 輸出</strong>：<code>process.stdout.write</code> + <code>console.log</code></li>
<li><strong>路徑追蹤</strong>：記錄每個嘗試的路徑</li>
<li><strong>階段性驗證</strong>：分別驗證建置階段和運行階段</li>
<li><strong>錯誤分類</strong>：區分配置錯誤、路徑錯誤、文件錯誤</li>
</ol>
<h3 id="常見陷阱"><a href="#常見陷阱" class="headerlink" title="常見陷阱"></a><strong>常見陷阱</strong></h3><h4 id="🌀-最大的陷阱：Loader-配置迷宮"><a href="#🌀-最大的陷阱：Loader-配置迷宮" class="headerlink" title="🌀 最大的陷阱：Loader 配置迷宮"></a><strong>🌀 最大的陷阱：Loader 配置迷宮</strong></h4><p><strong>這是我們卡最久的地方！</strong> 其他開發者也很容易陷入這個陷阱：</p>
<ol>
<li><strong>假性解決陷阱</strong>：解決了 Token 問題後，以為萬事大吉，沒意識到 SSR Loader 根本沒載入</li>
<li><strong>過度工程陷阱</strong>：不斷優化 Loader 實現細節，但忽略了根本的配置問題</li>
<li><strong>路徑強迫症陷阱</strong>：執著於調整文件路徑，嘗試各種組合，但問題不在路徑</li>
<li><strong>Provider 配置陷阱</strong>：嘗試各種 provider 註冊方式，但 main.server.ts 配置才是關鍵</li>
<li><strong>環境設定轉移陷阱</strong>：把問題歸咎於環境設定，但實際是配置架構問題</li>
</ol>
<h4 id="🚨-核心配置陷阱"><a href="#🚨-核心配置陷阱" class="headerlink" title="🚨 核心配置陷阱"></a><strong>🚨 核心配置陷阱</strong></h4><ol>
<li><strong>🚨 Injection Token 陷阱</strong>：<code>main.server.ts</code> 使用錯誤的配置，導致 <code>TRANSLOCO_TRANSPILER</code> token 找不到</li>
<li><strong>🚨 資源配置陷阱</strong>：<code>angular.json</code> 中缺少 assets 配置，導致語系檔案不會被複製到建置輸出</li>
<li><strong>🚨 配置載入陷阱</strong>：修改了 <code>app.config.server.ts</code> 但 <code>main.server.ts</code> 沒有正確使用</li>
<li><strong>Provider 衝突陷阱</strong>：在 server config 中重複定義瀏覽器 loader</li>
</ol>
<h4 id="🔧-技術實現陷阱"><a href="#🔧-技術實現陷阱" class="headerlink" title="🔧 技術實現陷阱"></a><strong>🔧 技術實現陷阱</strong></h4><ol start="5">
<li><strong>路徑陷阱</strong>：ES modules 下 <code>__dirname</code> 不可用</li>
<li><strong>Log 陷阱</strong>：生產環境 console.log 被禁用</li>
<li><strong>時序陷阱</strong>：預渲染階段 assets 尚未複製</li>
<li><strong>檔案結構陷阱</strong>：語系檔案放錯位置 (如放在 <code>src/app/assets</code> 而非 <code>src/assets</code>)</li>
</ol>
<h4 id="⚠️-診斷陷阱"><a href="#⚠️-診斷陷阱" class="headerlink" title="⚠️ 診斷陷阱"></a><strong>⚠️ 診斷陷阱</strong></h4><ol start="9">
<li><strong>盲目測試陷阱</strong>：不斷嘗試各種配置組合，但沒有系統性驗證</li>
<li><strong>症狀轉移陷阱</strong>：把精力花在次要問題上，忽略了根本的配置架構問題</li>
</ol>
<h2 id="🚀-結論"><a href="#🚀-結論" class="headerlink" title="🚀 結論"></a>🚀 <strong>結論</strong></h2><p>這個問題的解決關鍵在於：</p>
<ol>
<li><strong>🚨 Injection Token 問題</strong>：確保 <code>main.server.ts</code> 使用正確的 server config 和 TRANSLOCO_TRANSPILER provider</li>
<li><strong>🏗️ 基礎資源配置</strong>：確保 <code>angular.json</code> assets 正確設定和檔案結構正確</li>
<li><strong>正確的配置架構</strong>：使用專門的 server config，避免 provider 衝突</li>
<li><strong>合適的實現策略</strong>：雙 Loader + 多路徑嘗試</li>
<li><strong>完善的調試機制</strong>：詳細 log + 錯誤處理</li>
<li><strong>深入的問題分析</strong>：從表象到根因的系統性診斷</li>
</ol>
<p>通過這次問題解決，我們建立了一個完整的 Angular SSR + Transloco 國際化解決方案，可以穩定運行在生產環境中，並具備完善的調試和錯誤處理能力。</p>
<p><strong>最重要的教訓</strong>：</p>
<h3 id="🎯-解決策略教訓"><a href="#🎯-解決策略教訓" class="headerlink" title="🎯 解決策略教訓"></a><strong>🎯 解決策略教訓</strong></h3><ol>
<li><strong>🚨 正確的修復方向：補足缺失的 Injection Token</strong> - 當我們看到 <code>No provider for InjectionToken TRANSLOCO_TRANSPILER</code> 錯誤時，應該立即檢查相關的 provider 配置</li>
<li><strong>根本原因識別</strong> - 所有的症狀都源自於 <code>main.server.ts</code> 配置錯誤，導致 <code>TRANSLOCO_TRANSPILER</code> token 在 SSR 環境中找不到</li>
<li><strong>表面錯誤只是症狀</strong> - TypeScript 錯誤、Log 問題、路徑問題都是深層配置問題的表現</li>
<li><strong>系統性診斷是關鍵</strong> - 從依賴注入 → 配置架構 → 實現細節的分層解決方式</li>
<li><strong>補足策略的有效性</strong> - 關鍵是使用 <code>mergeApplicationConfig()</code> 合併配置，確保所有 Transloco providers 都被正確包含在 SSR 環境中</li>
</ol>
<h3 id="🌀-試錯過程教訓"><a href="#🌀-試錯過程教訓" class="headerlink" title="🌀 試錯過程教訓"></a><strong>🌀 試錯過程教訓</strong></h3><ol start="6">
<li><strong>避免 Loader 配置迷宮</strong> - 不要一開始就深入 Loader 實現細節，先確認 Loader 是否真的被載入</li>
<li><strong>先驗證後優化</strong> - 在優化 Loader 之前，先用最簡單的 log 驗證 constructor 是否被呼叫</li>
</ol>
<hr>
<p><strong>作者</strong>：技術團隊<br><strong>版本</strong>：v2.0<br><strong>最後更新</strong>：2025-07-01<br><strong>文件狀態</strong>：✅ 故障排除完整指南<br>8. <strong>配置架構優於實現細節</strong> - 90% 的問題出在配置架構上，只有 10% 是實現細節問題<br>9. <strong>假性解決的危險</strong> - 解決一個錯誤後，要全面驗證功能是否真正工作，不要急於慶祝<br>10. <strong>系統性排除勝過盲目嘗試</strong> - 建立檢查清單，系統性排除可能原因，而不是隨機嘗試各種配置</p>
<h3 id="🔍-診斷方法教訓"><a href="#🔍-診斷方法教訓" class="headerlink" title="🔍 診斷方法教訓"></a><strong>🔍 診斷方法教訓</strong></h3><ol start="11">
<li><strong>最簡驗證法</strong> - 用最簡單的 <code>console.log</code> 在 constructor 中驗證服務是否被載入</li>
<li><strong>配置追蹤法</strong> - 追蹤從 <code>main.server.ts</code> 開始的完整配置鏈</li>
<li><strong>分層診斷法</strong> - 從架構 → 配置 → 實現的順序進行診斷</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cookieseventeen.github.io/2025/06/29/angular-ssr-transloco-troubleshooting-guide/" data-id="cmg51yfqh0009anmz42jramih" data-title="Angular SSR + Transloco 故障排除與除錯完整指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-SSR/" rel="tag">Angular SSR</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-Universal/" rel="tag">Angular Universal</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Debugging/" rel="tag">Debugging</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Error-Handling/" rel="tag">Error Handling</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NullInjectorError/" rel="tag">NullInjectorError</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Production-Issues/" rel="tag">Production Issues</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSR-Configuration/" rel="tag">SSR Configuration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Transloco/" rel="tag">Transloco</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Troubleshooting/" rel="tag">Troubleshooting</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/i18n-Debug/" rel="tag">i18n Debug</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-angular-ssr-transloco-setup-complete-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/29/angular-ssr-transloco-setup-complete-guide/" class="article-date">
  <time class="dt-published" datetime="2025-06-29T08:00:00.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech-Daily/">Tech Daily</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/29/angular-ssr-transloco-setup-complete-guide/">Angular SSR + Transloco 國際化配置實戰指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="📋-核心懶人包"><a href="#📋-核心懶人包" class="headerlink" title="📋 核心懶人包"></a>📋 核心懶人包</h2><ol>
<li><strong>專案名稱關鍵</strong>：所有 <code>your-project-name</code> 必須替換為實際專案名稱，影響構建和部署</li>
<li><strong>SSR 雙重配置</strong>：瀏覽器端和伺服器端需要不同的 Transloco loader 配置</li>
<li><strong>檔案路徑核心</strong>：assets 配置決定語系檔案能否正確載入，build 和 test 都要設定</li>
<li><strong>容錯機制</strong>：完整的錯誤處理確保 SSR 環境下的穩定運行</li>
<li><strong>驗證流程</strong>：提供完整的測試和驗證步驟，確保配置成功</li>
</ol>
<h2 id="🏗️-專案概述"><a href="#🏗️-專案概述" class="headerlink" title="🏗️ 專案概述"></a>🏗️ 專案概述</h2><p>本指南基於實際專案經驗，提供 Angular 19+ SSR + Transloco 的完整配置方案：</p>
<ul>
<li>🎯 <strong>完整配置清單</strong>：所有必要檔案的詳細程式碼和配置</li>
<li>🔄 <strong>SSR 雙重架構</strong>：瀏覽器端和伺服器端的不同載入策略</li>
<li>📁 <strong>檔案結構標準</strong>：規範的專案結構和檔案組織方式</li>
<li>⚠️ <strong>避坑指南</strong>：常見問題的預防和解決方案</li>
<li>✅ <strong>驗證機制</strong>：完整的測試和除錯流程</li>
</ul>
<h2 id="🏗️-Angular-SSR-Transloco-架構圖"><a href="#🏗️-Angular-SSR-Transloco-架構圖" class="headerlink" title="🏗️ Angular SSR + Transloco 架構圖"></a>🏗️ Angular SSR + Transloco 架構圖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[Angular SSR + Transloco 應用] --&gt; B[瀏覽器端配置]</span><br><span class="line">    A --&gt; C[伺服器端配置]</span><br><span class="line">    </span><br><span class="line">    B --&gt; B1[app.config.ts]</span><br><span class="line">    B --&gt; B2[TranslocoHttpLoader]</span><br><span class="line">    B --&gt; B3[HTTP 載入語系檔案]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1[app.config.server.ts]</span><br><span class="line">    C --&gt; C2[TranslocoSSRLoader]</span><br><span class="line">    C --&gt; C3[檔案系統載入]</span><br><span class="line">    </span><br><span class="line">    B3 --&gt; D[assets/i18n/]</span><br><span class="line">    C3 --&gt; D</span><br><span class="line">    D --&gt; D1[en.json]</span><br><span class="line">    D --&gt; D2[zh-tw.json]</span><br><span class="line">    </span><br><span class="line">    B1 --&gt; E[瀏覽器渲染]</span><br><span class="line">    C1 --&gt; F[伺服器端渲染]</span><br><span class="line">    </span><br><span class="line">    E --&gt; G[用戶端體驗]</span><br><span class="line">    F --&gt; G</span><br><span class="line">    </span><br><span class="line">    G --&gt; H[多語系應用]</span><br></pre></td></tr></table></figure>

<h1 id="Angular-SSR-Transloco-國際化配置實戰指南"><a href="#Angular-SSR-Transloco-國際化配置實戰指南" class="headerlink" title="Angular SSR + Transloco 國際化配置實戰指南"></a>Angular SSR + Transloco 國際化配置實戰指南</h1><h2 id="📚-指南簡介"><a href="#📚-指南簡介" class="headerlink" title="📚 指南簡介"></a>📚 <strong>指南簡介</strong></h2><p>本指南基於實際項目經驗，提供 <strong>Angular 19+ SSR + Transloco</strong> 的完整配置方案。包含所有必要檔案的完整程式碼，讓您可以快速上手並避免常見陷阱。</p>
<h3 id="技術環境"><a href="#技術環境" class="headerlink" title="技術環境"></a><strong>技術環境</strong></h3><ul>
<li>Angular 19.2.14+</li>
<li>@jsverse&#x2F;transloco</li>
<li>SSR + 預渲染支援</li>
<li>TypeScript</li>
</ul>
<h3 id="📋-重要提醒"><a href="#📋-重要提醒" class="headerlink" title="📋 重要提醒"></a><strong>📋 重要提醒</strong></h3><blockquote>
<p>⚠️ <strong>專案名稱替換</strong>：本指南中所有的 <code>your-project-name</code> 都需要替換為您的實際專案名稱。</p>
<p><strong>如何確認專案名稱？</strong></p>
<ol>
<li>檢查 <code>angular.json</code> 中的 <code>projects</code> 區塊</li>
<li>檢查 <code>package.json</code> 中的 <code>name</code> 欄位</li>
<li>建置後檢查 <code>dist/</code> 目錄下的資料夾名稱</li>
</ol>
<p><strong>替換範例：</strong><br>如果您的專案名稱是 <code>example_project_frontend</code>：</p>
<ul>
<li><code>your-project-name</code> → <code>example_project_frontend</code></li>
<li><code>npm run serve:ssr:your-project-name</code> → <code>npm run serve:ssr:example_project_frontend</code></li>
<li><code>dist/your-project-name/browser/</code> → <code>dist/example_project_frontend/browser/</code></li>
</ul>
</blockquote>
<hr>
<h2 id="🗂️-專案結構總覽"><a href="#🗂️-專案結構總覽" class="headerlink" title="🗂️ 專案結構總覽"></a>🗂️ <strong>專案結構總覽</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">your-project/</span><br><span class="line">├── angular.json                    # ✅ Assets 配置</span><br><span class="line">├── src/</span><br><span class="line">│   ├── assets/</span><br><span class="line">│   │   └── i18n/                  # ✅ 語系檔案目錄</span><br><span class="line">│   │       ├── en.json</span><br><span class="line">│   │       └── zh-tw.json</span><br><span class="line">│   ├── app/</span><br><span class="line">│   │   ├── app.config.ts          # ✅ 瀏覽器端配置</span><br><span class="line">│   │   ├── app.config.server.ts   # ✅ SSR 配置</span><br><span class="line">│   │   ├── app.routes.server.ts   # SSR 路由</span><br><span class="line">│   │   └── core/</span><br><span class="line">│   │       └── services/</span><br><span class="line">│   │           ├── transloco.config.ts      # ✅ 瀏覽器端 Loader</span><br><span class="line">│   │           └── transloco-ssr.loader.ts  # ✅ SSR Loader</span><br><span class="line">│   ├── main.ts                    # 瀏覽器端入口</span><br><span class="line">│   └── main.server.ts             # ✅ SSR 入口 (關鍵配置)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🔧-完整配置步驟"><a href="#🔧-完整配置步驟" class="headerlink" title="🔧 完整配置步驟"></a>🔧 <strong>完整配置步驟</strong></h2><h3 id="步驟-1：安裝必要套件"><a href="#步驟-1：安裝必要套件" class="headerlink" title="步驟 1：安裝必要套件"></a><strong>步驟 1：安裝必要套件</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安裝 Transloco</span></span><br><span class="line">ng add @jsverse/transloco</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果需要 SSR 支援 (Angular 17+)</span></span><br><span class="line">ng add @angular/ssr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是較舊版本 Angular (已棄用)</span></span><br><span class="line"><span class="comment"># ng add @nguniversal/express-engine</span></span><br></pre></td></tr></table></figure>

<h3 id="步驟-2：配置-angular-json-⚠️"><a href="#步驟-2：配置-angular-json-⚠️" class="headerlink" title="步驟 2：配置 angular.json ⚠️"></a><strong>步驟 2：配置 angular.json</strong> ⚠️</h3><p><strong>檔案路徑：</strong> <code>angular.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./node_modules/@angular/cli/lib/config/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;projects&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;your-project-name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="comment">// 👈 請替換為您的實際專案名稱</span></span><br><span class="line">            <span class="attr">&quot;projectType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;application&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;architect&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;builder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@angular-devkit/build-angular:application&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;outputPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dist/your-project-name&quot;</span><span class="punctuation">,</span> <span class="comment">// 👈 請替換為您的實際專案名稱</span></span><br><span class="line">                        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/index.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;browser&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/main.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;polyfills&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;zone.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;tsConfig&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tsconfig.app.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;assets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;public&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/assets&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/assets&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;styles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/styles.scss&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/main.server.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;outputMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;ssr&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;entry&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/server.ts&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;builder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@angular-devkit/build-angular:karma&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;polyfills&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;zone.js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;zone.js/testing&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;tsConfig&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tsconfig.spec.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;assets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;public&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/assets&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/assets&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;styles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/styles.scss&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>關鍵重點：</strong></p>
<ul>
<li><code>&quot;input&quot;: &quot;src/assets&quot;</code> + <code>&quot;output&quot;: &quot;/assets&quot;</code> 確保語系檔案被正確複製</li>
<li>同時在 <code>build</code> 和 <code>test</code> 中都要配置</li>
</ul>
<h3 id="步驟-3：創建語系檔案"><a href="#步驟-3：創建語系檔案" class="headerlink" title="步驟 3：創建語系檔案"></a><strong>步驟 3：創建語系檔案</strong></h3><p><strong>檔案路徑：</strong> <code>src/assets/i18n/zh-tw.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;demo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Demo 展示中心&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;subtitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;組件展示與測試&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;buttons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;primary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;主要動作&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;secondary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;次要動作&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;confirm&quot;</span><span class="punctuation">:</span> <span class="string">&quot;確認&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cancel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;取消&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;delete&quot;</span><span class="punctuation">:</span> <span class="string">&quot;刪除&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;edit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;編輯&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;save&quot;</span><span class="punctuation">:</span> <span class="string">&quot;儲存&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;form&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;使用者名稱&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;電子郵件&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;密碼&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;department&quot;</span><span class="punctuation">:</span> <span class="string">&quot;部門&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;職位&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;loading&quot;</span><span class="punctuation">:</span> <span class="string">&quot;載入中...&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作失敗&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;warning&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警告訊息&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;home&quot;</span><span class="punctuation">:</span> <span class="string">&quot;首頁&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dashboard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;儀表板&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;components&quot;</span><span class="punctuation">:</span> <span class="string">&quot;組件展示&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="string">&quot;設定&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>檔案路徑：</strong> <code>src/assets/i18n/en.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;demo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Demo Center&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;subtitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Component Demo &amp; Testing&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;buttons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;primary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Primary Action&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;secondary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Secondary Action&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;confirm&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Confirm&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cancel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Cancel&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;delete&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Delete&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;edit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Edit&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;save&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Save&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;form&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Username&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Email&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Password&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;department&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Department&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Position&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;loading&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Loading...&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Success&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Error&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;warning&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Warning&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;home&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Home&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dashboard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Dashboard&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;components&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Components&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Settings&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="步驟-4：創建瀏覽器端-Transloco-Loader"><a href="#步驟-4：創建瀏覽器端-Transloco-Loader" class="headerlink" title="步驟 4：創建瀏覽器端 Transloco Loader"></a><strong>步驟 4：創建瀏覽器端 Transloco Loader</strong></h3><p><strong>檔案路徑：</strong> <code>src/app/core/services/transloco.config.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; inject, <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Translation</span>, <span class="title class_">TranslocoLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; catchError, tap &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 瀏覽器端 Transloco Loader</span></span><br><span class="line"><span class="comment"> * 使用 HTTP 請求載入語系檔案</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Injectable</span>(&#123; <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TranslocoBrowserLoader</span> <span class="keyword">implements</span> <span class="title class_">TranslocoLoader</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> http = <span class="title function_">inject</span>(<span class="title class_">HttpClient</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;🌐 [Browser Transloco] TranslocoBrowserLoader 被初始化！&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;🌐 [Browser Transloco] 瀏覽器端 Transloco Loader 已就緒&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getTranslation</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="title class_">Observable</span>&lt;<span class="title class_">Translation</span>&gt; &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[Browser Transloco] 🌐 HTTP載入語系檔: <span class="subst">$&#123;lang&#125;</span>`</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[Browser Transloco] 請求路徑: /assets/i18n/<span class="subst">$&#123;lang&#125;</span>.json`</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="property">get</span>&lt;<span class="title class_">Translation</span>&gt;(<span class="string">`/assets/i18n/<span class="subst">$&#123;lang&#125;</span>.json`</span>).<span class="title function_">pipe</span>(</span><br><span class="line">            <span class="title function_">tap</span>(<span class="function">(<span class="params"><span class="attr">translation</span>: <span class="title class_">Translation</span></span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[Browser Transloco] ✅ HTTP載入成功: <span class="subst">$&#123;lang&#125;</span>`</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[Browser Transloco] 載入的 keys:`</span>, <span class="title class_">Object</span>.<span class="title function_">keys</span>(translation));</span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="title function_">catchError</span>(<span class="function">(<span class="params"><span class="attr">err</span>: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[Browser Transloco] ❌ HTTP載入失敗: <span class="subst">$&#123;lang&#125;</span>`</span>, err);</span><br><span class="line">                <span class="keyword">throw</span> err;</span><br><span class="line">            &#125;)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="步驟-5：創建-SSR-Transloco-Loader"><a href="#步驟-5：創建-SSR-Transloco-Loader" class="headerlink" title="步驟 5：創建 SSR Transloco Loader"></a><strong>步驟 5：創建 SSR Transloco Loader</strong></h3><p><strong>檔案路徑：</strong> <code>src/app/core/services/transloco-ssr.loader.ts</code></p>
<blockquote>
<p>💡 <strong>設計理念</strong>：採用明確的單一檔案路徑，避免多路徑嘗試的複雜性。<br>如果檔案找不到，提供清楚的錯誤訊息和診斷指引，讓開發者快速定位問題。</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Translation</span>, <span class="title class_">TranslocoLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SSR 專用 Transloco Loader</span></span><br><span class="line"><span class="comment"> * 使用文件系統直接讀取語系檔案</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 🎯 設計原則：</span></span><br><span class="line"><span class="comment"> * - 明確的檔案路徑，不嘗試多個可能位置</span></span><br><span class="line"><span class="comment"> * - 清楚的錯誤訊息和診斷指引</span></span><br><span class="line"><span class="comment"> * - 簡潔的邏輯，易於除錯和維護</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Injectable</span>(&#123; <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TranslocoSSRLoader</span> <span class="keyword">implements</span> <span class="title class_">TranslocoLoader</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 使用雙重輸出確保 log 可見</span></span><br><span class="line">        process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">&#x27;🚀 [SSR Transloco] TranslocoSSRLoader 被初始化！\n&#x27;</span>);</span><br><span class="line">        process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">&#x27;🚀 [SSR Transloco] 伺服器端 Transloco Loader 已就緒\n&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;🚀 [SSR Transloco] TranslocoSSRLoader 被初始化！&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;🚀 [SSR Transloco] 伺服器端 Transloco Loader 已就緒&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getTranslation</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">Translation</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// 明確的語系檔案路徑 - Angular 建置後的標準路徑</span></span><br><span class="line">        <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(</span><br><span class="line">            process.<span class="title function_">cwd</span>(),</span><br><span class="line">            <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;your-project-name&#x27;</span>, <span class="comment">// 👈 請替換為您的實際專案名稱</span></span><br><span class="line">            <span class="string">&#x27;browser&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;assets&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;i18n&#x27;</span>,</span><br><span class="line">            <span class="string">`<span class="subst">$&#123;lang&#125;</span>.json`</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 載入過程追蹤</span></span><br><span class="line">        process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] 🚀 載入語系檔: <span class="subst">$&#123;lang&#125;</span>\n`</span>);</span><br><span class="line">        process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] 📂 工作目錄: <span class="subst">$&#123;process.cwd()&#125;</span>\n`</span>);</span><br><span class="line">        process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] 📁 檔案路徑: <span class="subst">$&#123;filePath&#125;</span>\n`</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[SSR Transloco] 載入語系檔: <span class="subst">$&#123;lang&#125;</span>`</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[SSR Transloco] 工作目錄: <span class="subst">$&#123;process.cwd()&#125;</span>`</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[SSR Transloco] 檔案路徑: <span class="subst">$&#123;filePath&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="title class_">Translation</span>&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            fs.<span class="title function_">readFile</span>(filePath, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params"><span class="attr">err</span>: <span class="built_in">any</span>, <span class="attr">data</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">const</span> errorMsg = <span class="string">`無法讀取語系檔: <span class="subst">$&#123;lang&#125;</span>`</span>;</span><br><span class="line">                    process.<span class="property">stderr</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] ❌ <span class="subst">$&#123;errorMsg&#125;</span>\n`</span>);</span><br><span class="line">                    process.<span class="property">stderr</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] 💡 請檢查以下項目:\n`</span>);</span><br><span class="line">                    process.<span class="property">stderr</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco]    1. 檔案是否存在: <span class="subst">$&#123;filePath&#125;</span>\n`</span>);</span><br><span class="line">                    process.<span class="property">stderr</span>.<span class="title function_">write</span>(</span><br><span class="line">                        <span class="string">`[SSR Transloco]    2. angular.json 中 assets 配置是否正確\n`</span></span><br><span class="line">                    );</span><br><span class="line">                    process.<span class="property">stderr</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco]    3. 是否已執行 ng build\n`</span>);</span><br><span class="line">                    process.<span class="property">stderr</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco]    4. 專案名稱是否正確設定\n`</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[SSR Transloco] ❌ <span class="subst">$&#123;errorMsg&#125;</span>`</span>, err);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[SSR Transloco] 💡 請檢查:`</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[SSR Transloco]    1. 檔案是否存在: <span class="subst">$&#123;filePath&#125;</span>`</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[SSR Transloco]    2. angular.json 中 assets 配置是否正確`</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[SSR Transloco]    3. 是否已執行 ng build`</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[SSR Transloco]    4. 專案名稱是否正確設定`</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_">reject</span>(err);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> translation = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data) <span class="keyword">as</span> <span class="title class_">Translation</span>;</span><br><span class="line">                    process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] ✅ 成功載入語系檔: <span class="subst">$&#123;lang&#125;</span>\n`</span>);</span><br><span class="line">                    process.<span class="property">stdout</span>.<span class="title function_">write</span>(</span><br><span class="line">                        <span class="string">`[SSR Transloco] 🔑 載入的 keys: <span class="subst">$&#123;<span class="built_in">Object</span>.keys(translation).join(<span class="string">&#x27;, &#x27;</span>)&#125;</span>\n`</span></span><br><span class="line">                    );</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[SSR Transloco] ✅ 成功載入語系檔: <span class="subst">$&#123;lang&#125;</span>`</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[SSR Transloco] 載入的 keys:`</span>, <span class="title class_">Object</span>.<span class="title function_">keys</span>(translation));</span><br><span class="line">                    <span class="title function_">resolve</span>(translation);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (parseErr) &#123;</span><br><span class="line">                    process.<span class="property">stderr</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] ❌ JSON 解析失敗: <span class="subst">$&#123;lang&#125;</span>\n`</span>);</span><br><span class="line">                    process.<span class="property">stderr</span>.<span class="title function_">write</span>(<span class="string">`[SSR Transloco] 💡 請檢查 JSON 檔案格式是否正確\n`</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[SSR Transloco] ❌ JSON 解析失敗: <span class="subst">$&#123;lang&#125;</span>`</span>, parseErr);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[SSR Transloco] 💡 請檢查 JSON 檔案格式是否正確`</span>);</span><br><span class="line">                    <span class="title function_">reject</span>(parseErr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="步驟-6：配置瀏覽器端應用"><a href="#步驟-6：配置瀏覽器端應用" class="headerlink" title="步驟 6：配置瀏覽器端應用"></a><strong>步驟 6：配置瀏覽器端應用</strong></h3><p><strong>檔案路徑：</strong> <code>src/app/app.config.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; provideHttpClient, withInterceptorsFromDi &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApplicationConfig</span>, isDevMode &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideAnimationsAsync &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser/animations/async&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideTransloco &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslocoBrowserLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./core/services/transloco.config&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="title function_">provideRouter</span>(routes),</span><br><span class="line">        <span class="title function_">provideAnimationsAsync</span>(),</span><br><span class="line">        <span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptorsFromDi</span>()),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ✅ Transloco 配置</span></span><br><span class="line">        <span class="title function_">provideTransloco</span>(&#123;</span><br><span class="line">            <span class="attr">config</span>: &#123;</span><br><span class="line">                <span class="attr">availableLangs</span>: [<span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh-tw&#x27;</span>],</span><br><span class="line">                <span class="attr">defaultLang</span>: <span class="string">&#x27;zh-tw&#x27;</span>,</span><br><span class="line">                <span class="attr">fallbackLang</span>: <span class="string">&#x27;en&#x27;</span>,</span><br><span class="line">                <span class="attr">reRenderOnLangChange</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="comment">// 開發模式啟用 debug，生產模式關閉</span></span><br><span class="line">                <span class="attr">prodMode</span>: !<span class="title function_">isDevMode</span>(),</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">loader</span>: <span class="title class_">TranslocoBrowserLoader</span>,</span><br><span class="line">        &#125;),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果你有其他 providers，在此添加</span></span><br><span class="line">        <span class="comment">// providePrimeNG(&#123;...&#125;),</span></span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="步驟-7：配置-SSR-應用-🚨"><a href="#步驟-7：配置-SSR-應用-🚨" class="headerlink" title="步驟 7：配置 SSR 應用 🚨"></a><strong>步驟 7：配置 SSR 應用</strong> 🚨</h3><p><strong>檔案路徑：</strong> <code>src/app/app.config.server.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApplicationConfig</span>, mergeApplicationConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRendering &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-server&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRouting &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/ssr&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">TRANSLOCO_LOADER</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; appConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.config&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; serverRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes.server&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslocoSSRLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./core/services/transloco-ssr.loader&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">serverConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="title function_">provideServerRendering</span>(),</span><br><span class="line">        <span class="title function_">provideServerRouting</span>(serverRoutes),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ✅ 關鍵：為 SSR 環境提供專門的 Transloco Loader</span></span><br><span class="line">        <span class="comment">// 這會覆蓋瀏覽器端的 HTTP loader，改用文件系統讀取</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">provide</span>: <span class="variable constant_">TRANSLOCO_LOADER</span>,</span><br><span class="line">            <span class="attr">useClass</span>: <span class="title class_">TranslocoSSRLoader</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 關鍵：合併配置確保所有 Transloco providers（包括 TRANSLOCO_TRANSPILER）都被包含</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> config = <span class="title function_">mergeApplicationConfig</span>(appConfig, serverConfig);</span><br></pre></td></tr></table></figure>

<h3 id="步驟-8：配置瀏覽器端入口點"><a href="#步驟-8：配置瀏覽器端入口點" class="headerlink" title="步驟 8：配置瀏覽器端入口點"></a><strong>步驟 8：配置瀏覽器端入口點</strong></h3><p><strong>檔案路徑：</strong> <code>src/main.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; bootstrapApplication &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app/app.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; appConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;./app/app.config&#x27;</span>; <span class="comment">// ✅ 使用瀏覽器端配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 瀏覽器端應用程式的入口點</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 📝 說明：</span></span><br><span class="line"><span class="comment"> * - 使用 app.config.ts (瀏覽器端配置)</span></span><br><span class="line"><span class="comment"> * - 包含 HTTP 客戶端和瀏覽器端 Transloco Loader</span></span><br><span class="line"><span class="comment"> * - 在瀏覽器環境中執行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">bootstrapApplication</span>(<span class="title class_">AppComponent</span>, appConfig).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err));</span><br></pre></td></tr></table></figure>

<h3 id="步驟-9：配置-SSR-入口點-🚨"><a href="#步驟-9：配置-SSR-入口點-🚨" class="headerlink" title="步驟 9：配置 SSR 入口點 🚨"></a><strong>步驟 9：配置 SSR 入口點</strong> 🚨</h3><p><strong>檔案路徑：</strong> <code>src/main.server.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; bootstrapApplication &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AppComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./app/app.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; config &#125; <span class="keyword">from</span> <span class="string">&#x27;./app/app.config.server&#x27;</span>; <span class="comment">// ✅ 關鍵：使用 server 配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SSR 應用程式的入口點</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ⚠️ 重要：必須使用 app.config.server.ts 而不是 app.config.ts</span></span><br><span class="line"><span class="comment"> * 否則會導致 TRANSLOCO_TRANSPILER token 找不到的錯誤</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 📝 與 main.ts 的區別：</span></span><br><span class="line"><span class="comment"> * - 使用 app.config.server.ts (合併了瀏覽器端 + SSR 配置)</span></span><br><span class="line"><span class="comment"> * - 包含 SSR 專用的文件系統 Transloco Loader</span></span><br><span class="line"><span class="comment"> * - 在 Node.js 環境中執行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">bootstrapApplication</span>(<span class="title class_">AppComponent</span>, config);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="🔍-main-ts-vs-main-server-ts-配置對比"><a href="#🔍-main-ts-vs-main-server-ts-配置對比" class="headerlink" title="🔍 main.ts vs main.server.ts 配置對比"></a><strong>🔍 main.ts vs main.server.ts 配置對比</strong></h3><table>
<thead>
<tr>
<th>特性</th>
<th><code>main.ts</code> (瀏覽器端)</th>
<th><code>main.server.ts</code> (SSR)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>執行環境</strong></td>
<td>瀏覽器</td>
<td>Node.js 伺服器</td>
</tr>
<tr>
<td><strong>配置檔案</strong></td>
<td><code>app.config.ts</code></td>
<td><code>app.config.server.ts</code></td>
</tr>
<tr>
<td><strong>Transloco Loader</strong></td>
<td>HTTP 請求載入</td>
<td>文件系統讀取</td>
</tr>
<tr>
<td><strong>bootstrap 方式</strong></td>
<td>直接呼叫</td>
<td>返回 Promise 函數</td>
</tr>
<tr>
<td><strong>載入時機</strong></td>
<td>頁面載入時</td>
<td>每次 SSR 請求時</td>
</tr>
<tr>
<td><strong>語系檔案來源</strong></td>
<td><code>/assets/i18n/*.json</code></td>
<td><code>dist/*/browser/assets/i18n/*.json</code></td>
</tr>
</tbody></table>
<h3 id="步驟-10：創建-SSR-路由配置"><a href="#步驟-10：創建-SSR-路由配置" class="headerlink" title="步驟 10：創建 SSR 路由配置"></a><strong>步驟 10：創建 SSR 路由配置</strong></h3><p><strong>檔案路徑：</strong> <code>src/app/app.routes.server.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RenderMode</span>, <span class="title class_">ServerRoute</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/ssr&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">serverRoutes</span>: <span class="title class_">ServerRoute</span>[] = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;demo&#x27;</span>,</span><br><span class="line">        <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;demo/components&#x27;</span>,</span><br><span class="line">        <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;**&#x27;</span>,</span><br><span class="line">        <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Server</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🧪-驗證與測試"><a href="#🧪-驗證與測試" class="headerlink" title="🧪 驗證與測試"></a>🧪 <strong>驗證與測試</strong></h2><h3 id="測試步驟-1：建置專案"><a href="#測試步驟-1：建置專案" class="headerlink" title="測試步驟 1：建置專案"></a><strong>測試步驟 1：建置專案</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清理舊的建置檔案</span></span><br><span class="line"><span class="built_in">rm</span> -rf dist</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建置專案 (會顯示 SSR log)</span></span><br><span class="line">ng build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 確認語系檔案已複製</span></span><br><span class="line"><span class="built_in">ls</span> -la dist/your-project-name/browser/assets/i18n/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 💡 請將 your-project-name 替換為您的實際專案名稱</span></span><br><span class="line"><span class="comment"># 例如：ls -la dist/example_project_frontend/browser/assets/i18n/</span></span><br></pre></td></tr></table></figure>

<p><strong>預期輸出：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">🚀 [SSR Transloco] TranslocoSSRLoader 被初始化！</span><br><span class="line">🚀 [SSR Transloco] 伺服器端 Transloco Loader 已就緒</span><br><span class="line">[SSR Transloco] 🚀 載入語系檔: zh-tw</span><br><span class="line">[SSR Transloco] 📂 工作目錄: /path/to/your/project</span><br><span class="line">[SSR Transloco] 📁 檔案路徑: /path/to/your/project/dist/your-project-name/browser/assets/i18n/zh-tw.json</span><br><span class="line">[SSR Transloco] ✅ 成功載入語系檔: zh-tw</span><br><span class="line">[SSR Transloco] 🔑 載入的 keys: onlydemo, common, demo</span><br></pre></td></tr></table></figure>

<h3 id="測試步驟-2：啟動-SSR-服務器"><a href="#測試步驟-2：啟動-SSR-服務器" class="headerlink" title="測試步驟 2：啟動 SSR 服務器"></a><strong>測試步驟 2：啟動 SSR 服務器</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 啟動 SSR 服務器</span></span><br><span class="line">npm run serve:ssr:your-project-name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 💡 請將 your-project-name 替換為您的實際專案名稱</span></span><br><span class="line"><span class="comment"># 例如：npm run serve:ssr:example_project_frontend</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他常見的 SSR 啟動命令格式：</span></span><br><span class="line"><span class="comment"># npm run serve:ssr</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不確定，可以檢查 package.json 的 scripts 區塊</span></span><br></pre></td></tr></table></figure>

<p><strong>預期輸出：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Node Express server listening on http://localhost:4000</span><br></pre></td></tr></table></figure>

<h3 id="測試步驟-3：驗證頁面內容"><a href="#測試步驟-3：驗證頁面內容" class="headerlink" title="測試步驟 3：驗證頁面內容"></a><strong>測試步驟 3：驗證頁面內容</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 測試首頁</span></span><br><span class="line">curl -s http://localhost:4000/ | grep -E <span class="string">&quot;(title|Demo|展示)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 測試特定頁面</span></span><br><span class="line">curl -s http://localhost:4000/demo/components | grep -E <span class="string">&quot;(Demo|展示|按鈕|元件)&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>預期輸出：</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo 展示中心<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Demo 展示中心<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>主要動作<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span>次要動作<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🎯-使用範例"><a href="#🎯-使用範例" class="headerlink" title="🎯 使用範例"></a>🎯 <strong>使用範例</strong></h2><h3 id="在組件中使用-Transloco"><a href="#在組件中使用-Transloco" class="headerlink" title="在組件中使用 Transloco"></a><strong>在組件中使用 Transloco</strong></h3><p><strong>檔案路徑：</strong> <code>src/app/components/demo/demo.component.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslocoDirective</span>, <span class="title class_">TranslocoService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;app-demo&#x27;</span>,</span><br><span class="line">    <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">imports</span>: [<span class="title class_">TranslocoDirective</span>],</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div *transloco=&quot;let t&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;&#123;&#123; t(&#x27;demo.title&#x27;) &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;&#123;&#123; t(&#x27;demo.subtitle&#x27;) &#125;&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &lt;div class=&quot;buttons&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;button class=&quot;primary&quot;&gt;&#123;&#123; t(&#x27;demo.buttons.primary&#x27;) &#125;&#125;&lt;/button&gt;</span></span><br><span class="line"><span class="string">                &lt;button class=&quot;secondary&quot;&gt;&#123;&#123; t(&#x27;demo.buttons.secondary&#x27;) &#125;&#125;&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            &lt;form&gt;</span></span><br><span class="line"><span class="string">                &lt;label&gt;&#123;&#123; t(&#x27;demo.form.username&#x27;) &#125;&#125;&lt;/label&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;text&quot; /&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                &lt;label&gt;&#123;&#123; t(&#x27;demo.form.email&#x27;) &#125;&#125;&lt;/label&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;email&quot; /&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">DemoComponent</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="attr">transloco</span>: <span class="title class_">TranslocoService</span></span>) &#123;</span><br><span class="line">        <span class="comment">// 程式化使用</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">transloco</span>.<span class="title function_">translate</span>(<span class="string">&#x27;demo.title&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 切換語言</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">transloco</span>.<span class="title function_">setActiveLang</span>(<span class="string">&#x27;en&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="語言切換組件"><a href="#語言切換組件" class="headerlink" title="語言切換組件"></a><strong>語言切換組件</strong></h3><p><strong>檔案路徑：</strong> <code>src/app/shared/components/language-switcher/language-switcher.component.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslocoService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;app-language-switcher&#x27;</span>,</span><br><span class="line">    <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;language-switcher&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;button (click)=&quot;setLang(&#x27;zh-tw&#x27;)&quot; [class.active]=&quot;currentLang === &#x27;zh-tw&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">                繁體中文</span></span><br><span class="line"><span class="string">            &lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;button (click)=&quot;setLang(&#x27;en&#x27;)&quot; [class.active]=&quot;currentLang === &#x27;en&#x27;&quot;&gt;English&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    <span class="attr">styles</span>: [</span><br><span class="line">        <span class="string">`</span></span><br><span class="line"><span class="string">            .language-switcher button &#123;</span></span><br><span class="line"><span class="string">                margin: 0 5px;</span></span><br><span class="line"><span class="string">                padding: 8px 16px;</span></span><br><span class="line"><span class="string">                border: 1px solid #ccc;</span></span><br><span class="line"><span class="string">                background: white;</span></span><br><span class="line"><span class="string">                cursor: pointer;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            .language-switcher button.active &#123;</span></span><br><span class="line"><span class="string">                background: #007bff;</span></span><br><span class="line"><span class="string">                color: white;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        `</span>,</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">LanguageSwitcherComponent</span> &#123;</span><br><span class="line">    currentLang = <span class="variable language_">this</span>.<span class="property">transloco</span>.<span class="title function_">getActiveLang</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="attr">transloco</span>: <span class="title class_">TranslocoService</span></span>) &#123;</span><br><span class="line">        <span class="comment">// 監聽語言變更</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">transloco</span>.<span class="property">langChanges$</span>.<span class="title function_">subscribe</span>(<span class="function"><span class="params">lang</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">currentLang</span> = lang;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setLang</span>(<span class="params"><span class="attr">lang</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">transloco</span>.<span class="title function_">setActiveLang</span>(lang);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="⚠️-常見問題與解決方案"><a href="#⚠️-常見問題與解決方案" class="headerlink" title="⚠️ 常見問題與解決方案"></a>⚠️ <strong>常見問題與解決方案</strong></h2><h3 id="問題-1：Token-錯誤"><a href="#問題-1：Token-錯誤" class="headerlink" title="問題 1：Token 錯誤"></a><strong>問題 1：Token 錯誤</strong></h3><p><strong>錯誤訊息：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NullInjectorError: No provider <span class="keyword">for</span> InjectionToken TRANSLOCO_TRANSPILER!</span><br></pre></td></tr></table></figure>

<p><strong>解決方案：</strong></p>
<ol>
<li>確認 <code>src/main.server.ts</code> 使用 <code>app.config.server.ts</code></li>
<li>確認 <code>mergeApplicationConfig(appConfig, serverConfig)</code> 正確合併</li>
</ol>
<h3 id="問題-2：語系檔案載入失敗"><a href="#問題-2：語系檔案載入失敗" class="headerlink" title="問題 2：語系檔案載入失敗"></a><strong>問題 2：語系檔案載入失敗</strong></h3><p><strong>錯誤訊息：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP 404: /assets/i18n/zh-tw.json</span><br></pre></td></tr></table></figure>

<p><strong>解決方案：</strong></p>
<ol>
<li>檢查 <code>angular.json</code> 中的 assets 配置</li>
<li>確認語系檔案路徑：<code>src/assets/i18n/*.json</code></li>
<li>重新建置專案</li>
</ol>
<h3 id="問題-3：SSR-Loader-沒有被載入"><a href="#問題-3：SSR-Loader-沒有被載入" class="headerlink" title="問題 3：SSR Loader 沒有被載入"></a><strong>問題 3：SSR Loader 沒有被載入</strong></h3><p><strong>症狀：</strong> 沒有看到任何 SSR log 輸出</p>
<p><strong>診斷方法：</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 檢查 SSR Loader 是否被載入</span></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;🚀 SSR Loader 被初始化了嗎？&#x27;</span>); <span class="comment">// 如果看不到這個，代表沒載入</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 手動檢查語系檔案是否存在</span></span><br><span class="line"><span class="comment">// 在終端執行：</span></span><br><span class="line"><span class="comment">// ls -la dist/your-project-name/browser/assets/i18n/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 檢查路徑是否正確</span></span><br><span class="line"><span class="comment">// 確認 SSR Loader 中的專案名稱是否與實際建置目錄一致</span></span><br></pre></td></tr></table></figure>

<p><strong>解決方案：</strong></p>
<ol>
<li>檢查 <code>main.server.ts</code> 配置</li>
<li>確認 server config 中的 provider 註冊</li>
<li>驗證 <code>mergeApplicationConfig</code> 呼叫</li>
</ol>
<hr>
<h2 id="🚀-部署建議"><a href="#🚀-部署建議" class="headerlink" title="🚀 部署建議"></a>🚀 <strong>部署建議</strong></h2><h3 id="生產環境配置"><a href="#生產環境配置" class="headerlink" title="生產環境配置"></a><strong>生產環境配置</strong></h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/app.config.ts</span></span><br><span class="line"><span class="title function_">provideTransloco</span>(&#123;</span><br><span class="line">    <span class="attr">config</span>: &#123;</span><br><span class="line">        <span class="comment">// 生產環境設定</span></span><br><span class="line">        <span class="attr">prodMode</span>: !<span class="title function_">isDevMode</span>(), <span class="comment">// 會根據環境自動調整</span></span><br><span class="line">        <span class="attr">missingHandler</span>: &#123;</span><br><span class="line">            <span class="attr">logMissingKey</span>: !<span class="title function_">isDevMode</span>(), <span class="comment">// 只在開發環境 log 缺失的 key</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">loader</span>: <span class="title class_">TranslocoBrowserLoader</span>,</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<h3 id="建置腳本"><a href="#建置腳本" class="headerlink" title="建置腳本"></a><strong>建置腳本</strong></h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;build:prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ng build --configuration=production&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;serve:ssr:prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run build:prod &amp;&amp; npm run serve:ssr&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;prerender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ng build --configuration=production&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="✅-配置檢查清單"><a href="#✅-配置檢查清單" class="headerlink" title="✅ 配置檢查清單"></a>✅ <strong>配置檢查清單</strong></h2><h3 id="🔍-專案名稱驗證"><a href="#🔍-專案名稱驗證" class="headerlink" title="🔍 專案名稱驗證"></a><strong>🔍 專案名稱驗證</strong></h3><ul>
<li><input disabled="" type="checkbox"> 確認實際專案名稱（檢查 <code>angular.json</code> 和 <code>package.json</code>）</li>
<li><input disabled="" type="checkbox"> 所有檔案中的 <code>your-project-name</code> 都已替換為實際專案名稱</li>
<li><input disabled="" type="checkbox"> SSR Loader 中的路徑使用正確的專案名稱</li>
</ul>
<h3 id="📁-基礎配置"><a href="#📁-基礎配置" class="headerlink" title="📁 基礎配置"></a><strong>📁 基礎配置</strong></h3><ul>
<li><input disabled="" type="checkbox"> <code>angular.json</code> assets 配置正確</li>
<li><input disabled="" type="checkbox"> 語系檔案存在於 <code>src/assets/i18n/</code></li>
<li><input disabled="" type="checkbox"> JSON 格式正確無誤</li>
</ul>
<h3 id="⚙️-SSR-配置"><a href="#⚙️-SSR-配置" class="headerlink" title="⚙️ SSR 配置"></a><strong>⚙️ SSR 配置</strong></h3><ul>
<li><input disabled="" type="checkbox"> <code>main.server.ts</code> 使用 <code>app.config.server.ts</code></li>
<li><input disabled="" type="checkbox"> Server config 中有 <code>TRANSLOCO_LOADER</code> provider</li>
<li><input disabled="" type="checkbox"> <code>mergeApplicationConfig</code> 正確呼叫</li>
<li><input disabled="" type="checkbox"> SSR Loader 實現 <code>TranslocoLoader</code> 介面</li>
</ul>
<h3 id="🚀-運行時驗證"><a href="#🚀-運行時驗證" class="headerlink" title="🚀 運行時驗證"></a><strong>🚀 運行時驗證</strong></h3><ul>
<li><input disabled="" type="checkbox"> 建置時看到 SSR Transloco log</li>
<li><input disabled="" type="checkbox"> 語系檔案正確複製到 <code>dist/&#123;專案名稱&#125;/browser/assets/i18n/</code></li>
<li><input disabled="" type="checkbox"> 頁面顯示正確的翻譯內容</li>
<li><input disabled="" type="checkbox"> 語言切換功能正常</li>
</ul>
<h3 id="🐛-快速診斷"><a href="#🐛-快速診斷" class="headerlink" title="🐛 快速診斷"></a><strong>🐛 快速診斷</strong></h3><p>如果遇到問題，請依序檢查：</p>
<ol>
<li><strong>SSR Loader 是否被載入？</strong> → 建置時應該看到初始化 log</li>
<li><strong>專案名稱是否正確？</strong> → 檢查 SSR Loader 中的路徑</li>
<li><strong>語系檔案是否存在？</strong> → 檢查 <code>dist/&#123;專案名稱&#125;/browser/assets/i18n/</code></li>
<li><strong>配置是否合併？</strong> → 確認 <code>mergeApplicationConfig</code> 呼叫</li>
</ol>
<hr>
<h2 id="🎉-結語"><a href="#🎉-結語" class="headerlink" title="🎉 結語"></a>🎉 <strong>結語</strong></h2><p>本指南基於實際項目經驗，涵蓋了 Angular SSR + Transloco 配置的所有關鍵環節。按照這個指南操作，您應該能夠成功建立一個支援多語系的 SSR Angular 應用程式。</p>
<h3 id="🎯-關鍵成功要素"><a href="#🎯-關鍵成功要素" class="headerlink" title="🎯 關鍵成功要素"></a><strong>🎯 關鍵成功要素</strong></h3><ol>
<li><strong>正確的專案名稱替換</strong> - 確保所有 <code>your-project-name</code> 都替換為實際專案名稱</li>
<li><strong>完整的配置合併</strong> - 使用 <code>mergeApplicationConfig</code> 確保所有 providers 都被包含</li>
<li><strong>明確的檔案路徑</strong> - SSR Loader 使用正確的檔案系統路徑</li>
<li><strong>詳細的除錯資訊</strong> - 利用 log 輸出快速定位問題</li>
</ol>
<h3 id="🔧-故障排除原則"><a href="#🔧-故障排除原則" class="headerlink" title="🔧 故障排除原則"></a><strong>🔧 故障排除原則</strong></h3><p>如果遇到問題，請按照檢查清單逐項驗證，並參考常見問題解決方案。記住：</p>
<ul>
<li><strong>90% 的問題都出在配置架構上</strong>，只有 10% 是實現細節問題</li>
<li><strong>專案名稱不一致</strong>是最常見的陷阱</li>
<li><strong>SSR Loader 的 log 輸出</strong>是最佳的診斷工具</li>
</ul>
<p><strong>祝您配置順利！</strong> 🚀</p>
<h2 id="💡-SSR-Transloco-配置決策流程圖"><a href="#💡-SSR-Transloco-配置決策流程圖" class="headerlink" title="💡 SSR + Transloco 配置決策流程圖"></a>💡 SSR + Transloco 配置決策流程圖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[開始 Angular SSR + Transloco 配置] --&gt; B&#123;是否為新專案?&#125;</span><br><span class="line">    </span><br><span class="line">    B --&gt;|是| C[安裝 Angular SSR]</span><br><span class="line">    B --&gt;|否| D[檢查現有 SSR 配置]</span><br><span class="line">    </span><br><span class="line">    C --&gt; E[安裝 Transloco]</span><br><span class="line">    D --&gt; E</span><br><span class="line">    </span><br><span class="line">    E --&gt; F[確認專案名稱]</span><br><span class="line">    F --&gt; G[替換所有 your-project-name]</span><br><span class="line">    </span><br><span class="line">    G --&gt; H[配置 angular.json assets]</span><br><span class="line">    H --&gt; I[建立語系檔案]</span><br><span class="line">    </span><br><span class="line">    I --&gt; J[配置瀏覽器端 Loader]</span><br><span class="line">    J --&gt; K[配置伺服器端 Loader]</span><br><span class="line">    </span><br><span class="line">    K --&gt; L[建立 app.config.server.ts]</span><br><span class="line">    L --&gt; M[修改 main.server.ts]</span><br><span class="line">    </span><br><span class="line">    M --&gt; N[測試建置]</span><br><span class="line">    N --&gt; O&#123;建置成功?&#125;</span><br><span class="line">    </span><br><span class="line">    O --&gt;|否| P[檢查錯誤訊息]</span><br><span class="line">    P --&gt; P1&#123;是 Token 錯誤?&#125;</span><br><span class="line">    P1 --&gt;|是| P2[檢查 server config 合併]</span><br><span class="line">    P1 --&gt;|否| P3[檢查專案名稱和路徑]</span><br><span class="line">    P2 --&gt; N</span><br><span class="line">    P3 --&gt; N</span><br><span class="line">    </span><br><span class="line">    O --&gt;|是| Q[測試 SSR 啟動]</span><br><span class="line">    Q --&gt; R&#123;SSR 啟動成功?&#125;</span><br><span class="line">    </span><br><span class="line">    R --&gt;|否| S[檢查 Loader 初始化]</span><br><span class="line">    S --&gt; T[查看 console log]</span><br><span class="line">    T --&gt; N</span><br><span class="line">    </span><br><span class="line">    R --&gt;|是| U[測試語言切換]</span><br><span class="line">    U --&gt; V&#123;翻譯顯示正確?&#125;</span><br><span class="line">    </span><br><span class="line">    V --&gt;|否| W[檢查語系檔案格式]</span><br><span class="line">    W --&gt; N</span><br><span class="line">    </span><br><span class="line">    V --&gt;|是| X[部署到生產環境]</span><br><span class="line">    X --&gt; Y[配置完成 ✅]</span><br></pre></td></tr></table></figure>

<h2 id="🎯-核心洞察總結"><a href="#🎯-核心洞察總結" class="headerlink" title="🎯 核心洞察總結"></a>🎯 核心洞察總結</h2><h3 id="🔍-架構設計關鍵決策"><a href="#🔍-架構設計關鍵決策" class="headerlink" title="🔍 架構設計關鍵決策"></a>🔍 架構設計關鍵決策</h3><ol>
<li><p><strong>雙重載入機制</strong></p>
<ul>
<li><strong>瀏覽器端</strong>：使用 HTTP 載入，支援動態語言切換</li>
<li><strong>伺服器端</strong>：使用檔案系統，確保 SSR 性能和穩定性</li>
<li><strong>配置隔離</strong>：兩端使用不同的 loader 避免衝突</li>
</ul>
</li>
<li><p><strong>專案名稱管理策略</strong></p>
<ul>
<li><strong>統一命名</strong>：所有配置檔案使用一致的專案名稱</li>
<li><strong>路徑正確性</strong>：SSR Loader 必須使用正確的建置輸出路徑</li>
<li><strong>驗證機制</strong>：透過 console log 確認載入狀態</li>
</ul>
</li>
<li><p><strong>錯誤處理與除錯</strong></p>
<ul>
<li><strong>Layer 化除錯</strong>：從配置 → 建置 → 運行逐層檢查</li>
<li><strong>關鍵 Log 點</strong>：Loader 初始化、檔案載入、語言切換</li>
<li><strong>常見陷阱</strong>：Token 注入失敗、路徑錯誤、配置合併問題</li>
</ul>
</li>
</ol>
<h3 id="🚨-避免的關鍵陷阱"><a href="#🚨-避免的關鍵陷阱" class="headerlink" title="🚨 避免的關鍵陷阱"></a>🚨 避免的關鍵陷阱</h3><ol>
<li><strong>專案名稱不一致</strong>：90% 的問題源於此，必須完整替換所有佔位符</li>
<li><strong>配置合併遺漏</strong>：忘記使用 <code>mergeApplicationConfig</code> 導致 providers 丟失</li>
<li><strong>Assets 配置缺失</strong>：忘記在 angular.json 中配置語系檔案路徑</li>
</ol>
<h3 id="📊-效能與維護性考量"><a href="#📊-效能與維護性考量" class="headerlink" title="📊 效能與維護性考量"></a>📊 效能與維護性考量</h3><ul>
<li><strong>SSR 首屏渲染</strong>：伺服器端載入減少 FOUC (Flash of Untranslated Content)</li>
<li><strong>Bundle 最佳化</strong>：語系檔案按需載入，減少初始 bundle 大小</li>
<li><strong>快取策略</strong>：瀏覽器端可實現語系檔案快取，提升體驗</li>
</ul>
<h2 id="🚀-進階應用策略"><a href="#🚀-進階應用策略" class="headerlink" title="🚀 進階應用策略"></a>🚀 進階應用策略</h2><h3 id="🎯-多語系-SEO-優化"><a href="#🎯-多語系-SEO-優化" class="headerlink" title="🎯 多語系 SEO 優化"></a>🎯 多語系 SEO 優化</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 針對不同語言的 SSR 路由配置</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">redirectTo</span>: <span class="string">&#x27;/zh-tw&#x27;</span>, <span class="attr">pathMatch</span>: <span class="string">&#x27;full&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;:lang&#x27;</span>, <span class="attr">component</span>: <span class="title class_">AppComponent</span>, <span class="attr">children</span>: [</span><br><span class="line">    <span class="comment">// 子路由配置</span></span><br><span class="line">  ]&#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自動語言偵測和 SEO meta 標籤</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">configureSEOTransloco</span>(<span class="params"><span class="attr">lang</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">provide</span>: <span class="variable constant_">TRANSLOCO_CONFIG</span>,</span><br><span class="line">    <span class="attr">useValue</span>: &#123;</span><br><span class="line">      <span class="attr">availableLangs</span>: [<span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh-tw&#x27;</span>],</span><br><span class="line">      <span class="attr">defaultLang</span>: lang,</span><br><span class="line">      <span class="attr">fallbackLang</span>: <span class="string">&#x27;zh-tw&#x27;</span>,</span><br><span class="line">      <span class="attr">reRenderOnLangChange</span>: <span class="literal">false</span>, <span class="comment">// SSR 模式下建議關閉</span></span><br><span class="line">      <span class="attr">prodMode</span>: environment.<span class="property">production</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="🔄-動態語系載入"><a href="#🔄-動態語系載入" class="headerlink" title="🔄 動態語系載入"></a>🔄 動態語系載入</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 實現語系檔案的動態載入和快取</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">DynamicTranslocoLoader</span> <span class="keyword">implements</span> <span class="title class_">TranslocoLoader</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> cache = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Translation</span>&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">getTranslation</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="title class_">Observable</span>&lt;<span class="title class_">Translation</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">has</span>(lang)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">of</span>(<span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">get</span>(lang)!);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="property">get</span>&lt;<span class="title class_">Translation</span>&gt;(<span class="string">`/api/i18n/<span class="subst">$&#123;lang&#125;</span>`</span>).<span class="title function_">pipe</span>(</span><br><span class="line">      <span class="title function_">tap</span>(<span class="function"><span class="params">translation</span> =&gt;</span> <span class="variable language_">this</span>.<span class="property">cache</span>.<span class="title function_">set</span>(lang, translation)),</span><br><span class="line">      <span class="title function_">catchError</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">getFallbackTranslation</span>(lang))</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="📞-技術支援與參考資源"><a href="#📞-技術支援與參考資源" class="headerlink" title="📞 技術支援與參考資源"></a>📞 技術支援與參考資源</h2><h3 id="🛠️-除錯工具"><a href="#🛠️-除錯工具" class="headerlink" title="🛠️ 除錯工具"></a>🛠️ 除錯工具</h3><ul>
<li><strong>Angular DevTools</strong>：檢查 Transloco 服務狀態和語系載入</li>
<li><strong>Network Tab</strong>：監控語系檔案的 HTTP 請求</li>
<li><strong>Console Log</strong>：利用 SSR Loader 的詳細日誌進行診斷</li>
</ul>
<h3 id="📚-官方文件"><a href="#📚-官方文件" class="headerlink" title="📚 官方文件"></a>📚 官方文件</h3><ul>
<li><strong><a target="_blank" rel="noopener" href="https://ngneat.github.io/transloco/">Transloco 官方文檔</a></strong>：完整的 API 和配置指南</li>
<li><strong><a target="_blank" rel="noopener" href="https://angular.io/guide/ssr">Angular SSR Guide</a></strong>：伺服器端渲染官方指南</li>
<li><strong><a target="_blank" rel="noopener" href="https://angular.io/guide/i18n">Angular i18n</a></strong>：官方國際化解決方案比較</li>
<li><strong><a target="_blank" rel="noopener" href="https://github.com/angular/universal">Angular Universal</a></strong>：Universal 相關技術文檔</li>
</ul>
<h3 id="🌐-社群資源"><a href="#🌐-社群資源" class="headerlink" title="🌐 社群資源"></a>🌐 社群資源</h3><ul>
<li><strong><a target="_blank" rel="noopener" href="https://github.com/ngneat/transloco">Transloco GitHub</a></strong>：最新版本和 issue 追蹤</li>
<li><strong><a target="_blank" rel="noopener" href="https://community.angular.io/">Angular Community</a></strong>：社群討論和最佳實踐</li>
<li><strong><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/transloco">Stack Overflow</a></strong>：常見問題和解決方案</li>
</ul>
<hr>
<p><strong>作者</strong>：技術團隊<br><strong>版本</strong>：v1.0<br><strong>最後更新</strong>：2025-01-31<br><strong>文件狀態</strong>：✅ 已完成</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cookieseventeen.github.io/2025/06/29/angular-ssr-transloco-setup-complete-guide/" data-id="cmg51yfqg0006anmz22qhc2rk" data-title="Angular SSR + Transloco 國際化配置實戰指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-19/" rel="tag">Angular 19+</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-Universal/" rel="tag">Angular Universal</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Internationalization/" rel="tag">Internationalization</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Multi-language/" rel="tag">Multi-language</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Production-Deployment/" rel="tag">Production Deployment</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSR-Configuration/" rel="tag">SSR Configuration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Server-Side-Rendering/" rel="tag">Server-Side Rendering</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Transloco/" rel="tag">Transloco</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/i18n/" rel="tag">i18n</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jsverse-transloco/" rel="tag">jsverse&#x2F;transloco</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-angular-httpclient-modern-configuration-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/29/angular-httpclient-modern-configuration-guide/" class="article-date">
  <time class="dt-published" datetime="2025-06-29T07:00:00.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech-Daily/">Tech Daily</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/29/angular-httpclient-modern-configuration-guide/">Angular HttpClient 現代化配置與 withInterceptorsFromDI 實戰指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="📋-核心懶人包"><a href="#📋-核心懶人包" class="headerlink" title="📋 核心懶人包"></a>📋 核心懶人包</h2><ol>
<li><strong>provideHttpClient() 革命</strong>：Angular 15+ 新式配置取代 HttpClientModule，更小 bundle、更靈活</li>
<li><strong>withInterceptorsFromDI() 關鍵</strong>：向後兼容舊式 HTTP_INTERCEPTORS，支援第三方庫漸進式遷移</li>
<li><strong>配置策略</strong>：新舊 interceptors 可混合使用，滿足不同場景需求</li>
<li><strong>Transloco 整合</strong>：完美支援國際化庫的 HTTP 載入需求</li>
<li><strong>最佳實踐</strong>：優先使用新式函數 interceptors，保留 DI 支援作為向後兼容</li>
</ol>
<h2 id="🏗️-專案概述"><a href="#🏗️-專案概述" class="headerlink" title="🏗️ 專案概述"></a>🏗️ 專案概述</h2><p>本文詳細說明 Angular 15+ 中 <code>provideHttpClient()</code> 的使用方式，特別是 <code>withInterceptorsFromDI()</code> 配置選項的作用和最佳實踐：</p>
<ul>
<li>⚡ <strong>現代化配置</strong>：從 HttpClientModule 遷移到 provideHttpClient() 的完整指南</li>
<li>🔄 <strong>向後兼容策略</strong>：withInterceptorsFromDI() 支援既有 interceptors 和第三方庫</li>
<li>🌍 <strong>Transloco 整合</strong>：國際化庫的 HTTP 載入配置實戰</li>
<li>📊 <strong>效能優化</strong>：Tree-shakable 配置減少 bundle 大小</li>
<li>🛠️ <strong>實戰範例</strong>：前端專案的真實配置案例</li>
</ul>
<h2 id="🏗️-Angular-HttpClient-配置演進架構"><a href="#🏗️-Angular-HttpClient-配置演進架構" class="headerlink" title="🏗️ Angular HttpClient 配置演進架構"></a>🏗️ Angular HttpClient 配置演進架構</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[Angular HttpClient 配置] --&gt; B[傳統方式 Angular 14-]</span><br><span class="line">    A --&gt; C[現代方式 Angular 15+]</span><br><span class="line">    </span><br><span class="line">    B --&gt; B1[HttpClientModule]</span><br><span class="line">    B --&gt; B2[HTTP_INTERCEPTORS Token]</span><br><span class="line">    B --&gt; B3[較大 Bundle 大小]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1[provideHttpClient]</span><br><span class="line">    C --&gt; C2[函數式配置]</span><br><span class="line">    C --&gt; C3[Tree-shakable]</span><br><span class="line">    </span><br><span class="line">    C1 --&gt; D[配置選項]</span><br><span class="line">    D --&gt; D1[withInterceptors]</span><br><span class="line">    D --&gt; D2[withInterceptorsFromDI]</span><br><span class="line">    D --&gt; D3[withFetch]</span><br><span class="line">    D --&gt; D4[withRequestsMadeViaParent]</span><br><span class="line">    </span><br><span class="line">    D1 --&gt; E[新式函數 Interceptors]</span><br><span class="line">    D2 --&gt; F[相容舊式 DI Interceptors]</span><br><span class="line">    </span><br><span class="line">    E --&gt; G[推薦使用]</span><br><span class="line">    F --&gt; H[向後兼容]</span><br><span class="line">    </span><br><span class="line">    G --&gt; I[更好的 TypeScript 支援]</span><br><span class="line">    H --&gt; I</span><br><span class="line">    I --&gt; J[最佳化開發體驗]</span><br></pre></td></tr></table></figure>

<h1 id="Angular-HttpClient-現代化配置指南"><a href="#Angular-HttpClient-現代化配置指南" class="headerlink" title="Angular HttpClient 現代化配置指南"></a>Angular HttpClient 現代化配置指南</h1><h2 id="📋-概述"><a href="#📋-概述" class="headerlink" title="📋 概述"></a>📋 概述</h2><p>本文檔詳細說明 Angular 15+ 中 <code>provideHttpClient()</code> 的使用方式，特別是 <code>withInterceptorsFromDi()</code> 配置選項的作用和最佳實踐。</p>
<h2 id="🏗️-基本概念"><a href="#🏗️-基本概念" class="headerlink" title="🏗️ 基本概念"></a>🏗️ 基本概念</h2><h3 id="provideHttpClient"><a href="#provideHttpClient" class="headerlink" title="provideHttpClient()"></a>provideHttpClient()</h3><p>Angular 15+ 引入的新式 HTTP 客戶端配置方式，取代傳統的 <code>HttpClientModule</code>。</p>
<p><strong>特點：</strong></p>
<ul>
<li>函數式配置</li>
<li>Tree-shakable（更小的 bundle 大小）</li>
<li>更靈活的功能組合</li>
<li>更好的 TypeScript 支援</li>
</ul>
<h3 id="withInterceptorsFromDI"><a href="#withInterceptorsFromDI" class="headerlink" title="withInterceptorsFromDI()"></a>withInterceptorsFromDI()</h3><p>啟用基於依賴注入（DI）的 HTTP Interceptors 支援。</p>
<p><strong>用途：</strong></p>
<ul>
<li>向後兼容舊式 <code>HTTP_INTERCEPTORS</code> token</li>
<li>支援第三方庫的 interceptors</li>
<li>漸進式遷移策略</li>
</ul>
<h2 id="🔄-新舊對比"><a href="#🔄-新舊對比" class="headerlink" title="🔄 新舊對比"></a>🔄 新舊對比</h2><h3 id="舊方式（Angular-14-以前）"><a href="#舊方式（Angular-14-以前）" class="headerlink" title="舊方式（Angular 14 以前）"></a>舊方式（Angular 14 以前）</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">NgModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClientModule</span>, <span class="variable constant_">HTTP_INTERCEPTORS</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AuthInterceptor</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./interceptors/auth.interceptor&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">    <span class="attr">imports</span>: [</span><br><span class="line">        <span class="title class_">HttpClientModule</span>, <span class="comment">// 匯入整個模組</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="comment">// 註冊 interceptors</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">provide</span>: <span class="variable constant_">HTTP_INTERCEPTORS</span>,</span><br><span class="line">            <span class="attr">useClass</span>: <span class="title class_">AuthInterceptor</span>,</span><br><span class="line">            <span class="attr">multi</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="新方式（Angular-15-）"><a href="#新方式（Angular-15-）" class="headerlink" title="新方式（Angular 15+）"></a>新方式（Angular 15+）</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApplicationConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    provideHttpClient,</span><br><span class="line">    withInterceptors,</span><br><span class="line">    withInterceptorsFromDi,</span><br><span class="line">    <span class="variable constant_">HTTP_INTERCEPTORS</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="comment">// 方式1：新式函數 interceptors（推薦）</span></span><br><span class="line">        <span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptors</span>([authInterceptor, loggingInterceptor])),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方式2：相容舊式 DI interceptors</span></span><br><span class="line">        <span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptorsFromDi</span>()),</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">provide</span>: <span class="variable constant_">HTTP_INTERCEPTORS</span>,</span><br><span class="line">            <span class="attr">useClass</span>: <span class="title class_">AuthInterceptor</span>,</span><br><span class="line">            <span class="attr">multi</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="⚙️-配置選項詳解"><a href="#⚙️-配置選項詳解" class="headerlink" title="⚙️ 配置選項詳解"></a>⚙️ 配置選項詳解</h2><h3 id="1-基本配置"><a href="#1-基本配置" class="headerlink" title="1. 基本配置"></a>1. 基本配置</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最簡單的配置 - 只提供 HttpClient 服務</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>();</span><br></pre></td></tr></table></figure>

<h3 id="2-支援-DI-Interceptors"><a href="#2-支援-DI-Interceptors" class="headerlink" title="2. 支援 DI Interceptors"></a>2. 支援 DI Interceptors</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支援傳統的依賴注入 interceptors</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptorsFromDi</span>());</span><br></pre></td></tr></table></figure>

<h3 id="3-新式函數-Interceptors"><a href="#3-新式函數-Interceptors" class="headerlink" title="3. 新式函數 Interceptors"></a>3. 新式函數 Interceptors</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用新的函數式 interceptors</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(</span><br><span class="line">    <span class="title function_">withInterceptors</span>([authInterceptor, loggingInterceptor, errorHandlingInterceptor])</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="4-混合配置"><a href="#4-混合配置" class="headerlink" title="4. 混合配置"></a>4. 混合配置</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同時支援新舊兩種方式</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(</span><br><span class="line">    <span class="title function_">withInterceptors</span>([newStyleInterceptor]),</span><br><span class="line">    <span class="title function_">withInterceptorsFromDi</span>(),</span><br><span class="line">    <span class="title function_">withFetch</span>(), <span class="comment">// 使用 Fetch API</span></span><br><span class="line">    <span class="title function_">withRequestsMadeViaParent</span>() <span class="comment">// SSR 支援</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="🎯-實際範例"><a href="#🎯-實際範例" class="headerlink" title="🎯 實際範例"></a>🎯 實際範例</h2><h3 id="前端專案配置範例"><a href="#前端專案配置範例" class="headerlink" title="前端專案配置範例"></a>前端專案配置範例</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/app.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApplicationConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideHttpClient, withInterceptorsFromDi &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideTransloco &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TranslocoHttpLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./core/services/transloco.config&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; environment &#125; <span class="keyword">from</span> <span class="string">&#x27;../environments/environment&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="comment">// HTTP 客戶端配置 - 支援 DI interceptors</span></span><br><span class="line">        <span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptorsFromDi</span>()),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Transloco 國際化配置</span></span><br><span class="line">        <span class="title function_">provideTransloco</span>(&#123;</span><br><span class="line">            <span class="attr">config</span>: &#123;</span><br><span class="line">                <span class="attr">availableLangs</span>: [<span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh-tw&#x27;</span>],</span><br><span class="line">                <span class="attr">defaultLang</span>: <span class="string">&#x27;zh-tw&#x27;</span>,</span><br><span class="line">                <span class="attr">fallbackLang</span>: <span class="string">&#x27;zh-tw&#x27;</span>,</span><br><span class="line">                <span class="attr">reRenderOnLangChange</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">prodMode</span>: environment.<span class="property">production</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">loader</span>: <span class="title class_">TranslocoHttpLoader</span>, <span class="comment">// 依賴 HttpClient</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="TranslocoHttpLoader-使用範例"><a href="#TranslocoHttpLoader-使用範例" class="headerlink" title="TranslocoHttpLoader 使用範例"></a>TranslocoHttpLoader 使用範例</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/core/services/transloco.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span>, inject &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Translation</span>, <span class="title class_">TranslocoLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@jsverse/transloco&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>(&#123; <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TranslocoHttpLoader</span> <span class="keyword">implements</span> <span class="title class_">TranslocoLoader</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 inject() 函數注入 HttpClient</span></span><br><span class="line">    <span class="keyword">private</span> http = <span class="title function_">inject</span>(<span class="title class_">HttpClient</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getTranslation</span>(<span class="attr">lang</span>: <span class="built_in">string</span>): <span class="title class_">Observable</span>&lt;<span class="title class_">Translation</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// 載入翻譯檔案 - 需要 HttpClient 支援</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="property">get</span>&lt;<span class="title class_">Translation</span>&gt;(<span class="string">`/assets/i18n/<span class="subst">$&#123;lang&#125;</span>.json`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加-Interceptors-範例"><a href="#添加-Interceptors-範例" class="headerlink" title="添加 Interceptors 範例"></a>添加 Interceptors 範例</h3><h4 id="新式函數-Interceptor"><a href="#新式函數-Interceptor" class="headerlink" title="新式函數 Interceptor"></a>新式函數 Interceptor</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/core/interceptors/auth.interceptor.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpInterceptorFn</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AuthService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../services/auth.service&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">authInterceptor</span>: <span class="title class_">HttpInterceptorFn</span> = <span class="function">(<span class="params">req, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> authService = <span class="title function_">inject</span>(<span class="title class_">AuthService</span>);</span><br><span class="line">    <span class="keyword">const</span> token = authService.<span class="title function_">getToken</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">        <span class="keyword">const</span> authReq = req.<span class="title function_">clone</span>(&#123;</span><br><span class="line">            <span class="attr">setHeaders</span>: &#123;</span><br><span class="line">                <span class="title class_">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">next</span>(authReq);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">next</span>(req);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.config.ts</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptors</span>([authInterceptor]));</span><br></pre></td></tr></table></figure>

<h4 id="舊式類別-Interceptor"><a href="#舊式類別-Interceptor" class="headerlink" title="舊式類別 Interceptor"></a>舊式類別 Interceptor</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/core/interceptors/legacy-auth.interceptor.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpInterceptor</span>, <span class="title class_">HttpRequest</span>, <span class="title class_">HttpHandler</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">LegacyAuthInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HttpInterceptor</span> &#123;</span><br><span class="line">    <span class="title function_">intercept</span>(<span class="params"><span class="attr">req</span>: <span class="title class_">HttpRequest</span>&lt;<span class="built_in">any</span>&gt;, <span class="attr">next</span>: <span class="title class_">HttpHandler</span></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (token) &#123;</span><br><span class="line">            <span class="keyword">const</span> authReq = req.<span class="title function_">clone</span>(&#123;</span><br><span class="line">                <span class="attr">setHeaders</span>: &#123;</span><br><span class="line">                    <span class="title class_">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> next.<span class="title function_">handle</span>(authReq);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> next.<span class="title function_">handle</span>(req);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.config.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptorsFromDi</span>()),</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">provide</span>: <span class="variable constant_">HTTP_INTERCEPTORS</span>,</span><br><span class="line">            <span class="attr">useClass</span>: <span class="title class_">LegacyAuthInterceptor</span>,</span><br><span class="line">            <span class="attr">multi</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="🚀-最佳實踐"><a href="#🚀-最佳實踐" class="headerlink" title="🚀 最佳實踐"></a>🚀 最佳實踐</h2><h3 id="1-選擇適當的配置方式"><a href="#1-選擇適當的配置方式" class="headerlink" title="1. 選擇適當的配置方式"></a>1. 選擇適當的配置方式</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 推薦：新專案使用新式 interceptors</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptors</span>([authInterceptor, loggingInterceptor]));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 可接受：需要向後兼容時</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptorsFromDI</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 避免：不必要的複雜配置</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(</span><br><span class="line">    <span class="title function_">withInterceptors</span>([newInterceptor]),</span><br><span class="line">    <span class="title function_">withInterceptorsFromDI</span>() <span class="comment">// 同時使用兩種方式可能造成混淆</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="2-漸進式遷移策略"><a href="#2-漸進式遷移策略" class="headerlink" title="2. 漸進式遷移策略"></a>2. 漸進式遷移策略</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 階段1：添加 withInterceptorsFromDI 支援</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptorsFromDI</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 階段2：逐步將 interceptors 改為函數式</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(</span><br><span class="line">    <span class="title function_">withInterceptors</span>([newAuthInterceptor]), <span class="comment">// 新的</span></span><br><span class="line">    <span class="title function_">withInterceptorsFromDI</span>() <span class="comment">// 保留舊的</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 階段3：完全遷移到新式</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptors</span>([authInterceptor, loggingInterceptor, errorInterceptor]));</span><br></pre></td></tr></table></figure>

<h3 id="3-環境特定配置"><a href="#3-環境特定配置" class="headerlink" title="3. 環境特定配置"></a>3. 環境特定配置</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/config/http.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; environment &#125; <span class="keyword">from</span> <span class="string">&#x27;../../environments/environment&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getHttpClientConfig</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> interceptors = [authInterceptor];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 開發環境添加日誌 interceptor</span></span><br><span class="line">    <span class="keyword">if</span> (!environment.<span class="property">production</span>) &#123;</span><br><span class="line">        interceptors.<span class="title function_">push</span>(loggingInterceptor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">provideHttpClient</span>(</span><br><span class="line">        <span class="title function_">withInterceptors</span>(interceptors),</span><br><span class="line">        <span class="title function_">withFetch</span>() <span class="comment">// 生產環境使用 Fetch API</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.config.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">    <span class="attr">providers</span>: [</span><br><span class="line">        <span class="title function_">getHttpClientConfig</span>(),</span><br><span class="line">        <span class="comment">// ... 其他 providers</span></span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="⚠️-常見問題與解決方案"><a href="#⚠️-常見問題與解決方案" class="headerlink" title="⚠️ 常見問題與解決方案"></a>⚠️ 常見問題與解決方案</h2><h3 id="問題-1：Transloco-載入失敗"><a href="#問題-1：Transloco-載入失敗" class="headerlink" title="問題 1：Transloco 載入失敗"></a>問題 1：Transloco 載入失敗</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: NullInjectorError: No provider for HttpClient</span><br></pre></td></tr></table></figure>

<p><strong>解決方案：</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 確保有提供 HttpClient</span></span><br><span class="line"><span class="attr">providers</span>: [</span><br><span class="line">  <span class="title function_">provideHttpClient</span>(),  <span class="comment">// 或 withInterceptorsFromDI()</span></span><br><span class="line">  <span class="title function_">provideTransloco</span>(&#123;...&#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="問題-2：第三方庫-Interceptor-不起作用"><a href="#問題-2：第三方庫-Interceptor-不起作用" class="headerlink" title="問題 2：第三方庫 Interceptor 不起作用"></a>問題 2：第三方庫 Interceptor 不起作用</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 錯誤：只使用新式 interceptors</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptors</span>([myInterceptor]));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正確：添加 DI 支援</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(<span class="title function_">withInterceptors</span>([myInterceptor]), <span class="title function_">withInterceptorsFromDI</span>());</span><br></pre></td></tr></table></figure>

<h3 id="問題-3：SSR-環境下的問題"><a href="#問題-3：SSR-環境下的問題" class="headerlink" title="問題 3：SSR 環境下的問題"></a>問題 3：SSR 環境下的問題</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ SSR 友好配置</span></span><br><span class="line"><span class="title function_">provideHttpClient</span>(</span><br><span class="line">    <span class="title function_">withInterceptorsFromDI</span>(),</span><br><span class="line">    <span class="title function_">withRequestsMadeViaParent</span>() <span class="comment">// SSR 支援</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="🔧-除錯技巧"><a href="#🔧-除錯技巧" class="headerlink" title="🔧 除錯技巧"></a>🔧 除錯技巧</h2><h3 id="1-檢查-HTTP-請求"><a href="#1-檢查-HTTP-請求" class="headerlink" title="1. 檢查 HTTP 請求"></a>1. 檢查 HTTP 請求</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加日誌 interceptor 進行除錯</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">loggingInterceptor</span>: <span class="title class_">HttpInterceptorFn</span> = <span class="function">(<span class="params">req, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HTTP Request:&#x27;</span>, req.<span class="property">url</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">next</span>(req).<span class="title function_">pipe</span>(<span class="title function_">tap</span>(<span class="function"><span class="params">response</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HTTP Response:&#x27;</span>, response)));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-驗證配置"><a href="#2-驗證配置" class="headerlink" title="2. 驗證配置"></a>2. 驗證配置</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在元件中檢查 HttpClient 是否可用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TestComponent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> http = <span class="title function_">inject</span>(<span class="title class_">HttpClient</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HttpClient available:&#x27;</span>, !!<span class="variable language_">this</span>.<span class="property">http</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="📚-相關資源"><a href="#📚-相關資源" class="headerlink" title="📚 相關資源"></a>📚 相關資源</h2><ul>
<li><a target="_blank" rel="noopener" href="https://angular.io/guide/http">Angular HttpClient 官方文檔</a></li>
<li><a target="_blank" rel="noopener" href="https://angular.io/guide/http-interceptors">Interceptors 遷移指南</a></li>
<li><a target="_blank" rel="noopener" href="https://angular.io/guide/standalone-components">Standalone API 配置</a></li>
<li><a target="_blank" rel="noopener" href="https://ngneat.github.io/transloco/">Transloco 官方文檔</a></li>
</ul>
<h2 id="📝-總結"><a href="#📝-總結" class="headerlink" title="📝 總結"></a>📝 總結</h2><p><code>provideHttpClient(withInterceptorsFromDi())</code> 的核心作用：</p>
<ol>
<li><strong>現代化配置</strong>：使用新的函數式 API 配置 HTTP 客戶端</li>
<li><strong>向後兼容</strong>：支援傳統的 DI-based interceptors</li>
<li><strong>效能優化</strong>：Tree-shakable，減少 bundle 大小</li>
<li><strong>漸進式遷移</strong>：允許逐步從舊方式遷移到新方式</li>
</ol>
<p>在前端專案中，這個配置確保：</p>
<ul>
<li>✅ Transloco 能正常載入翻譯檔案</li>
<li>✅ 未來可以輕鬆添加認證、日誌等 interceptors</li>
<li>✅ 保持與 Angular 最新版本的兼容性</li>
<li>✅ 支援 SSR 和其他進階功能</li>
</ul>
<h2 id="💡-HttpClient-配置決策流程圖"><a href="#💡-HttpClient-配置決策流程圖" class="headerlink" title="💡 HttpClient 配置決策流程圖"></a>💡 HttpClient 配置決策流程圖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[選擇 HttpClient 配置方式] --&gt; B&#123;是否為新專案?&#125;</span><br><span class="line">    </span><br><span class="line">    B --&gt;|是| C[使用 provideHttpClient()]</span><br><span class="line">    B --&gt;|否| D&#123;是否需要相容既有 interceptors?&#125;</span><br><span class="line">    </span><br><span class="line">    D --&gt;|是| E[withInterceptorsFromDI]</span><br><span class="line">    D --&gt;|否| F[新式函數 interceptors]</span><br><span class="line">    </span><br><span class="line">    C --&gt; G&#123;需要第三方庫支援?&#125;</span><br><span class="line">    G --&gt;|是| H[添加 withInterceptorsFromDI]</span><br><span class="line">    G --&gt;|否| I[純新式配置]</span><br><span class="line">    </span><br><span class="line">    E --&gt; J[漸進式遷移策略]</span><br><span class="line">    F --&gt; K[現代化最佳實踐]</span><br><span class="line">    H --&gt; L[混合配置模式]</span><br><span class="line">    I --&gt; M[最佳效能配置]</span><br><span class="line">    </span><br><span class="line">    J --&gt; N&#123;遷移完成?&#125;</span><br><span class="line">    N --&gt;|否| O[保持混合模式]</span><br><span class="line">    N --&gt;|是| P[移除 DI 支援]</span><br><span class="line">    </span><br><span class="line">    K --&gt; Q[加入環境特定配置]</span><br><span class="line">    L --&gt; Q</span><br><span class="line">    M --&gt; Q</span><br><span class="line">    O --&gt; Q</span><br><span class="line">    P --&gt; Q</span><br><span class="line">    </span><br><span class="line">    Q --&gt; R[部署與監控]</span><br></pre></td></tr></table></figure>

<h2 id="🎯-核心洞察總結"><a href="#🎯-核心洞察總結" class="headerlink" title="🎯 核心洞察總結"></a>🎯 核心洞察總結</h2><h3 id="🔍-技術決策關鍵點"><a href="#🔍-技術決策關鍵點" class="headerlink" title="🔍 技術決策關鍵點"></a>🔍 技術決策關鍵點</h3><ol>
<li><p><strong>配置模式選擇</strong></p>
<ul>
<li><strong>新專案</strong>：優先使用 <code>withInterceptors([])</code> 新式函數配置</li>
<li><strong>既有專案</strong>：採用 <code>withInterceptorsFromDI()</code> 保持向後兼容</li>
<li><strong>混合專案</strong>：同時使用兩種模式，漸進式遷移</li>
</ul>
</li>
<li><p><strong>效能影響分析</strong></p>
<ul>
<li><strong>Bundle 大小</strong>：新式配置平均減少 15-20% HTTP 相關代碼</li>
<li><strong>Tree-shaking</strong>：未使用的 interceptor 功能會被自動移除</li>
<li><strong>運行時效能</strong>：函數式 interceptors 有更好的執行效率</li>
</ul>
</li>
<li><p><strong>維護性考量</strong></p>
<ul>
<li><strong>依賴管理</strong>：減少對 Module 系統的依賴</li>
<li><strong>測試友善</strong>：函數式配置更容易進行單元測試</li>
<li><strong>類型安全</strong>：更好的 TypeScript 推斷和錯誤檢查</li>
</ul>
</li>
</ol>
<h3 id="🚨-避免的常見陷阱"><a href="#🚨-避免的常見陷阱" class="headerlink" title="🚨 避免的常見陷阱"></a>🚨 避免的常見陷阱</h3><ol>
<li><strong>過度配置</strong>：不需要同時使用新舊兩種方式，除非有明確需求</li>
<li><strong>忽略第三方庫</strong>：使用 Transloco、Auth0 等庫時必須啟用 DI 支援</li>
<li><strong>SSR 兼容性</strong>：忘記配置 <code>withRequestsMadeViaParent()</code> 導致 SSR 問題</li>
</ol>
<h2 id="🚀-進階應用策略"><a href="#🚀-進階應用策略" class="headerlink" title="🚀 進階應用策略"></a>🚀 進階應用策略</h2><h3 id="🎯-企業級配置策略"><a href="#🎯-企業級配置策略" class="headerlink" title="🎯 企業級配置策略"></a>🎯 企業級配置策略</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 企業級 HttpClient 配置工廠</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createEnterpriseHttpConfig</span>(<span class="params"><span class="attr">environment</span>: <span class="built_in">any</span></span>): <span class="title class_">Provider</span>[] &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">interceptors</span>: <span class="title class_">HttpInterceptorFn</span>[] = [</span><br><span class="line">        authTokenInterceptor,</span><br><span class="line">        correlationIdInterceptor,</span><br><span class="line">        retryInterceptor</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 開發環境添加除錯工具</span></span><br><span class="line">    <span class="keyword">if</span> (!environment.<span class="property">production</span>) &#123;</span><br><span class="line">        interceptors.<span class="title function_">push</span>(</span><br><span class="line">            requestLoggingInterceptor,</span><br><span class="line">            responseTimeInterceptor,</span><br><span class="line">            mockDataInterceptor</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="title function_">provideHttpClient</span>(</span><br><span class="line">            <span class="title function_">withInterceptors</span>(interceptors),</span><br><span class="line">            <span class="title function_">withInterceptorsFromDI</span>(), <span class="comment">// 支援第三方庫</span></span><br><span class="line">            <span class="title function_">withFetch</span>(), <span class="comment">// 現代化 HTTP 實現</span></span><br><span class="line">            <span class="title function_">withRequestsMadeViaParent</span>() <span class="comment">// SSR 支援</span></span><br><span class="line">        ),</span><br><span class="line">        <span class="comment">// 環境特定的 HTTP 配置</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">provide</span>: <span class="variable constant_">HTTP_CONFIG</span>,</span><br><span class="line">            <span class="attr">useValue</span>: &#123;</span><br><span class="line">                <span class="attr">timeout</span>: environment.<span class="property">httpTimeout</span>,</span><br><span class="line">                <span class="attr">retryAttempts</span>: environment.<span class="property">httpRetryAttempts</span>,</span><br><span class="line">                <span class="attr">baseUrl</span>: environment.<span class="property">apiBaseUrl</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="🔄-自動化遷移工具"><a href="#🔄-自動化遷移工具" class="headerlink" title="🔄 自動化遷移工具"></a>🔄 自動化遷移工具</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自動檢測並建議遷移的工具函數</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">analyzeHttpConfigMigration</span>(<span class="params"><span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> analysis = &#123;</span><br><span class="line">        <span class="attr">hasHttpClientModule</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">hasProvideHttpClient</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">needsDIMigration</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">recommendations</span>: []</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分析現有配置</span></span><br><span class="line">    appConfig.<span class="property">providers</span>?.<span class="title function_">forEach</span>(<span class="function"><span class="params">provider</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isHttpClientModule</span>(provider)) &#123;</span><br><span class="line">            analysis.<span class="property">hasHttpClientModule</span> = <span class="literal">true</span>;</span><br><span class="line">            analysis.<span class="property">recommendations</span>.<span class="title function_">push</span>(<span class="string">&#x27;遷移到 provideHttpClient()&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isLegacyInterceptor</span>(provider)) &#123;</span><br><span class="line">            analysis.<span class="property">needsDIMigration</span> = <span class="literal">true</span>;</span><br><span class="line">            analysis.<span class="property">recommendations</span>.<span class="title function_">push</span>(<span class="string">&#x27;添加 withInterceptorsFromDI() 支援&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> analysis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="🧪-測試策略增強"><a href="#🧪-測試策略增強" class="headerlink" title="🧪 測試策略增強"></a>🧪 測試策略增強</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 針對 HttpClient 配置的測試工具</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createHttpClientTestingConfig</span>(<span class="params"></span>): <span class="title class_">Provider</span>[] &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="title function_">provideHttpClient</span>(</span><br><span class="line">            <span class="title function_">withInterceptors</span>([</span><br><span class="line">                mockAuthInterceptor,</span><br><span class="line">                testLoggingInterceptor</span><br><span class="line">            ]),</span><br><span class="line">            <span class="title function_">withInterceptorsFromDI</span>()</span><br><span class="line">        ),</span><br><span class="line">        <span class="title function_">provideHttpClientTesting</span>(),</span><br><span class="line">        <span class="comment">// 測試專用的模擬數據提供者</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">provide</span>: <span class="variable constant_">TEST_HTTP_CONFIG</span>,</span><br><span class="line">            <span class="attr">useValue</span>: &#123;</span><br><span class="line">                <span class="attr">enableMocking</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">responseDelay</span>: <span class="number">100</span>,</span><br><span class="line">                <span class="attr">errorRate</span>: <span class="number">0.1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="📞-技術支援與參考資源"><a href="#📞-技術支援與參考資源" class="headerlink" title="📞 技術支援與參考資源"></a>📞 技術支援與參考資源</h2><h3 id="🛠️-開發工具"><a href="#🛠️-開發工具" class="headerlink" title="🛠️ 開發工具"></a>🛠️ 開發工具</h3><ul>
<li><strong>Angular DevTools</strong>：監控 HTTP 請求和 interceptors 執行</li>
<li><strong>Network Tab</strong>：檢查實際的 HTTP 請求和回應</li>
<li><strong>Angular CLI</strong>：<code>ng update</code> 自動化遷移輔助</li>
</ul>
<h3 id="📚-官方文件"><a href="#📚-官方文件" class="headerlink" title="📚 官方文件"></a>📚 官方文件</h3><ul>
<li><strong><a target="_blank" rel="noopener" href="https://angular.io/guide/http">Angular HttpClient Guide</a></strong>：官方 HTTP 客戶端完整指南</li>
<li><strong><a target="_blank" rel="noopener" href="https://angular.io/guide/http-interceptors">HTTP Interceptors</a></strong>：攔截器使用和配置</li>
<li><strong><a target="_blank" rel="noopener" href="https://angular.io/guide/standalone-components#configuring-dependency-injection">Standalone Bootstrap</a></strong>：獨立組件配置指南</li>
<li><strong><a target="_blank" rel="noopener" href="https://update.angular.io/">Angular Update Guide</a></strong>：版本升級和遷移指南</li>
</ul>
<h3 id="🌐-社群資源"><a href="#🌐-社群資源" class="headerlink" title="🌐 社群資源"></a>🌐 社群資源</h3><ul>
<li><strong><a target="_blank" rel="noopener" href="https://blog.angular.io/">Angular Blog</a></strong>：官方技術部落格</li>
<li><strong><a target="_blank" rel="noopener" href="https://github.com/angular/angular/discussions">GitHub Discussion</a></strong>：技術討論和問題解答</li>
<li><strong><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/angular-httpclient">Stack Overflow</a></strong>：常見問題和解決方案</li>
<li><strong><a target="_blank" rel="noopener" href="https://www.angularjp.org/">Angular Community</a></strong>：社群交流和最佳實踐分享</li>
</ul>
<h3 id="🔗-相關工具和庫"><a href="#🔗-相關工具和庫" class="headerlink" title="🔗 相關工具和庫"></a>🔗 相關工具和庫</h3><ul>
<li><strong><a target="_blank" rel="noopener" href="https://ngneat.github.io/transloco/">Transloco</a></strong>：國際化解決方案</li>
<li><strong><a target="_blank" rel="noopener" href="https://angular.io/guide/service-worker-intro">Angular PWA</a></strong>：Progressive Web App 支援</li>
<li><strong><a target="_blank" rel="noopener" href="https://rxjs.dev/">RxJS</a></strong>：響應式程式設計工具</li>
<li><strong><a target="_blank" rel="noopener" href="https://github.com/Zak-C/ngx-loading">NGX-Loading</a></strong>：HTTP 請求載入狀態管理</li>
</ul>
<hr>
<p><strong>作者</strong>：技術團隊<br><strong>版本</strong>：v1.0<br><strong>最後更新</strong>：2025-01-31<br><strong>文件狀態</strong>：✅ 已完成</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cookieseventeen.github.io/2025/06/29/angular-httpclient-modern-configuration-guide/" data-id="cmg51yfqf0004anmzfkzb7sud" data-title="Angular HttpClient 現代化配置與 withInterceptorsFromDI 實戰指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-15/" rel="tag">Angular 15+</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-Configuration/" rel="tag">Angular Configuration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Dependency-Injection/" rel="tag">Dependency Injection</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP-Interceptors/" rel="tag">HTTP Interceptors</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HttpClient/" rel="tag">HttpClient</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Migration-Guide/" rel="tag">Migration Guide</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Standalone-Components/" rel="tag">Standalone Components</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Transloco/" rel="tag">Transloco</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/provideHttpClient/" rel="tag">provideHttpClient</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/withInterceptorsFromDI/" rel="tag">withInterceptorsFromDI</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-eslint-configuration-best-practices-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/29/eslint-configuration-best-practices-guide/" class="article-date">
  <time class="dt-published" datetime="2025-06-29T06:00:00.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech-Daily/">Tech Daily</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/29/eslint-configuration-best-practices-guide/">ESLint 9.x 革命性配置與前端開發最佳化實戰指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="📋-核心懶人包"><a href="#📋-核心懶人包" class="headerlink" title="📋 核心懶人包"></a>📋 核心懶人包</h2><ol>
<li><strong>ESLint 9.x 革命</strong>：Flat Config 取代複雜層級配置，單一檔案管理所有規則</li>
<li><strong>命名規範科學</strong>：TypeScript Interface PascalCase 降低認知負荷</li>
<li><strong>–no-warn-ignored 優化</strong>：消除噪音提醒，專注真正需要修正的問題</li>
<li><strong>專案重構思維</strong>：系統性檢查影響域，自動化驗證確保一致性</li>
<li><strong>Observable $ 後綴</strong>：現代匈牙利命名法，視覺化類型系統</li>
</ol>
<h2 id="🛠️-專案概述"><a href="#🛠️-專案概述" class="headerlink" title="🛠️ 專案概述"></a>🛠️ 專案概述</h2><p>本文深度分析了 ESLint 9.x 在能源管理系統 Angular 前端專案中的配置實戰，展示如何透過現代化工具鏈提升開發體驗：</p>
<ul>
<li>⚡ <strong>ESLint 9.x 升級</strong>：Flat Config 簡化配置管理</li>
<li>🎯 <strong>命名規範優化</strong>：TypeScript 和 Angular 最佳實踐</li>
<li>🔧 <strong>開發體驗改善</strong>：減少噪音，提升 CI&#x2F;CD 效率</li>
<li>🔄 <strong>重構策略</strong>：系統性方法處理專案改名和架構調整</li>
<li>📊 <strong>效果評估</strong>：配置即文檔的團隊協作哲學</li>
</ul>
<h2 id="🏗️-ESLint-9-x-配置架構"><a href="#🏗️-ESLint-9-x-配置架構" class="headerlink" title="🏗️ ESLint 9.x 配置架構"></a>🏗️ ESLint 9.x 配置架構</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[ESLint 9.x] --&gt; B[Flat Config]</span><br><span class="line">    B --&gt; C[單一配置檔案]</span><br><span class="line">    B --&gt; D[檔案類型分離]</span><br><span class="line">    B --&gt; E[內建忽略規則]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1[eslint.config.js]</span><br><span class="line">    D --&gt; D1[TypeScript 檔案]</span><br><span class="line">    D --&gt; D2[HTML 模板]</span><br><span class="line">    D --&gt; D3[測試檔案]</span><br><span class="line">    </span><br><span class="line">    E --&gt; E1[取代 .eslintignore]</span><br><span class="line">    E --&gt; E2[ignores 屬性]</span><br><span class="line">    </span><br><span class="line">    C1 --&gt; F[配置物件陣列]</span><br><span class="line">    F --&gt; F1[檔案匹配規則]</span><br><span class="line">    F --&gt; F2[語言選項設定]</span><br><span class="line">    F --&gt; F3[插件和規則]</span><br><span class="line">    </span><br><span class="line">    F1 --&gt; G[針對性配置]</span><br><span class="line">    F2 --&gt; G</span><br><span class="line">    F3 --&gt; G</span><br><span class="line">    G --&gt; H[最佳化開發體驗]</span><br></pre></td></tr></table></figure>



<h2 id="🚀-ESLint-9-x-革命性變化"><a href="#🚀-ESLint-9-x-革命性變化" class="headerlink" title="🚀 ESLint 9.x 革命性變化"></a>🚀 ESLint 9.x 革命性變化</h2><h3 id="💡-核心改變"><a href="#💡-核心改變" class="headerlink" title="💡 核心改變"></a>💡 核心改變</h3><ul>
<li><strong>Flat Config</strong>: 告別複雜的層級配置，擁抱扁平化</li>
<li><strong>單一配置文件</strong>: <code>eslint.config.js</code> 取代多個 <code>.eslintrc.*</code> 文件</li>
<li><strong>更強的 TypeScript 整合</strong>: 原生支援 ES 模組</li>
</ul>
<h3 id="🎯-實戰配置"><a href="#🎯-實戰配置" class="headerlink" title="🎯 實戰配置"></a>🎯 實戰配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eslint.config.js - 新時代的配置方式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">files</span>: [<span class="string">&#x27;src/**/*.ts&#x27;</span>],</span><br><span class="line">    <span class="attr">languageOptions</span>: &#123;</span><br><span class="line">      <span class="attr">parser</span>: typescriptParser,</span><br><span class="line">      <span class="attr">parserOptions</span>: &#123; <span class="attr">project</span>: <span class="string">&#x27;./tsconfig.json&#x27;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: &#123; <span class="string">&#x27;@typescript-eslint&#x27;</span>: typescriptEslint &#125;,</span><br><span class="line">    <span class="attr">rules</span>: &#123; <span class="comment">/* 針對性規則 */</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">files</span>: [<span class="string">&#x27;src/**/*.html&#x27;</span>],</span><br><span class="line">    <span class="attr">languageOptions</span>: &#123; <span class="attr">parser</span>: angularTemplateParser &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: &#123; <span class="string">&#x27;@angular-eslint/template&#x27;</span>: angularTemplateEslint &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">ignores</span>: [<span class="string">&#x27;dist/**&#x27;</span>, <span class="string">&#x27;node_modules/**&#x27;</span>] <span class="comment">// 直接內建忽略</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="🔧-遷移要點"><a href="#🔧-遷移要點" class="headerlink" title="🔧 遷移要點"></a>🔧 遷移要點</h3><ul>
<li>❌ <code>.eslintignore</code> 不再支援</li>
<li>✅ <code>ignores</code> 直接寫在配置中</li>
<li>✅ 多檔案類型可獨立配置</li>
<li>✅ 更清晰的依賴關係</li>
</ul>
<hr>
<h2 id="🎨-命名規範的科學化管理"><a href="#🎨-命名規範的科學化管理" class="headerlink" title="🎨 命名規範的科學化管理"></a>🎨 命名規範的科學化管理</h2><h3 id="💡-TypeScript-Interface-PascalCase-的威力"><a href="#💡-TypeScript-Interface-PascalCase-的威力" class="headerlink" title="💡 TypeScript Interface - PascalCase 的威力"></a>💡 TypeScript Interface - PascalCase 的威力</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 舊思維 - 隨意命名</span></span><br><span class="line"><span class="keyword">interface</span> energyData &#123; <span class="attr">id</span>: <span class="built_in">string</span>; &#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">data</span>: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 新標準 - 語義化命名</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">EnergyConsumptionData</span> &#123;</span><br><span class="line">  <span class="attr">sensorId</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">powerUsage</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">timestamp</span>: <span class="title class_">Date</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">consumptionData</span>: <span class="title class_">EnergyConsumptionData</span>[];</span><br></pre></td></tr></table></figure>

<h3 id="🎯-ESLint-強制執行"><a href="#🎯-ESLint-強制執行" class="headerlink" title="🎯 ESLint 強制執行"></a>🎯 ESLint 強制執行</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;@typescript-eslint/naming-convention&#x27;</span>: [</span><br><span class="line">  <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;interface&#x27;</span>,</span><br><span class="line">    <span class="attr">format</span>: [<span class="string">&#x27;PascalCase&#x27;</span>]  <span class="comment">// 強制大駝峰</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">selector</span>: <span class="string">&#x27;variable&#x27;</span>,</span><br><span class="line">    <span class="attr">filter</span>: &#123; <span class="attr">regex</span>: <span class="string">&#x27;\\$$&#x27;</span>, <span class="attr">match</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    <span class="attr">format</span>: [<span class="string">&#x27;camelCase&#x27;</span>],</span><br><span class="line">    <span class="attr">suffix</span>: [<span class="string">&#x27;$&#x27;</span>]  <span class="comment">// Observable 強制 $ 後綴</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="🧠-認知負荷優化"><a href="#🧠-認知負荷優化" class="headerlink" title="🧠 認知負荷優化"></a>🧠 認知負荷優化</h3><ul>
<li><strong>一眼識別類型</strong>: <code>EnergyData</code> vs <code>energydata</code></li>
<li><strong>減少誤解</strong>: <code>powerLevel$</code> 立即知道是 Observable</li>
<li><strong>團隊協作</strong>: 統一標準減少溝通成本</li>
</ul>
<hr>
<h2 id="🔕-no-warn-ignored-的深層邏輯"><a href="#🔕-no-warn-ignored-的深層邏輯" class="headerlink" title="🔕 --no-warn-ignored 的深層邏輯"></a>🔕 <code>--no-warn-ignored</code> 的深層邏輯</h2><h3 id="💡-ESLint-忽略的兩層結構"><a href="#💡-ESLint-忽略的兩層結構" class="headerlink" title="💡 ESLint 忽略的兩層結構"></a>💡 ESLint 忽略的兩層結構</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一層：忽略檢查，但提醒你「我忽略了這個文件」</span></span><br><span class="line">npx eslint src/**/*.ts</span><br><span class="line"><span class="comment"># 輸出: ⚠️ File ignored because of a matching ignore pattern</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二層：連提醒都不要，完全靜默</span></span><br><span class="line">npx eslint src/**/*.ts --no-warn-ignored</span><br><span class="line"><span class="comment"># 輸出: 乾淨的結果，專注於真正的問題</span></span><br></pre></td></tr></table></figure>

<h3 id="🎯-開發體驗優化"><a href="#🎯-開發體驗優化" class="headerlink" title="🎯 開發體驗優化"></a>🎯 開發體驗優化</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint src/**/*.ts --no-warn-ignored&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lint:fix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint src/**/*.ts --fix --no-warn-ignored&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lint:ci&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint src/**/*.ts --max-warnings 0 --no-warn-ignored&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="🚀-CI-CD-友善"><a href="#🚀-CI-CD-友善" class="headerlink" title="🚀 CI&#x2F;CD 友善"></a>🚀 CI&#x2F;CD 友善</h3><ul>
<li><strong>乾淨的建置日誌</strong>: 不被「噪音」干擾</li>
<li><strong>專注問題本質</strong>: 只看需要修正的程式碼</li>
<li><strong>零容忍模式</strong>: <code>--max-warnings 0</code> 確保品質</li>
</ul>
<hr>
<h2 id="🔄-專案重構的系統性思維"><a href="#🔄-專案重構的系統性思維" class="headerlink" title="🔄 專案重構的系統性思維"></a>🔄 專案重構的系統性思維</h2><h3 id="💡-重命名不是改一個名字"><a href="#💡-重命名不是改一個名字" class="headerlink" title="💡 重命名不是改一個名字"></a>💡 重命名不是改一個名字</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">taiwansteelunion_carscheduled_frontend</span><br><span class="line">↓ 需要檢查的影響域 ↓</span><br><span class="line">✅ package.json - 專案名稱</span><br><span class="line">✅ angular.json - 建置路徑、專案配置  </span><br><span class="line">✅ index.html - 網頁標題</span><br><span class="line">✅ 環境變數 - API 端點</span><br><span class="line">✅ 文檔 - README、註解</span><br><span class="line">✅ Git 分支 - 命名策略</span><br></pre></td></tr></table></figure>

<h3 id="🎯-自動化檢查流程"><a href="#🎯-自動化檢查流程" class="headerlink" title="🎯 自動化檢查流程"></a>🎯 自動化檢查流程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 全域搜尋舊名稱</span></span><br><span class="line">grep -r <span class="string">&quot;taiwansteelunion_carscheduled&quot;</span> .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 批量替換</span></span><br><span class="line">sed -i <span class="string">&#x27;s/taiwansteelunion_carscheduled/energy_management/g&#x27;</span> **/*.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ESLint 驗證新名稱符合規範</span></span><br><span class="line">npm run lint:check</span><br></pre></td></tr></table></figure>

<h3 id="🧠-重構策略"><a href="#🧠-重構策略" class="headerlink" title="🧠 重構策略"></a>🧠 重構策略</h3><ul>
<li><strong>影響域分析</strong>: 先找出所有需要改的地方</li>
<li><strong>原子化提交</strong>: 每次 commit 只改一類文件</li>
<li><strong>自動化驗證</strong>: 用工具確保一致性</li>
</ul>
<hr>
<h2 id="🎭-Observable-後綴的設計哲學"><a href="#🎭-Observable-後綴的設計哲學" class="headerlink" title="🎭 Observable $ 後綴的設計哲學"></a>🎭 Observable $ 後綴的設計哲學</h2><h3 id="💡-視覺化類型系統"><a href="#💡-視覺化類型系統" class="headerlink" title="💡 視覺化類型系統"></a>💡 視覺化類型系統</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 一眼就知道這是什麼</span></span><br><span class="line">energyData$ = <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">getEnergyData</span>();</span><br><span class="line">loading$ = <span class="keyword">new</span> <span class="title class_">BehaviorSubject</span>&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>);</span><br><span class="line">errors$ = <span class="keyword">new</span> <span class="title class_">Subject</span>&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用時的心智模型</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">energyData$</span>.<span class="title function_">pipe</span>(</span><br><span class="line">  <span class="title function_">takeUntil</span>(<span class="variable language_">this</span>.<span class="property">destroy$</span>),  <span class="comment">// 一看就知道生命週期管理</span></span><br><span class="line">  <span class="title function_">map</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">transform</span>(data))</span><br><span class="line">).<span class="title function_">subscribe</span>();</span><br></pre></td></tr></table></figure>

<h3 id="🎯-團隊認知統一"><a href="#🎯-團隊認知統一" class="headerlink" title="🎯 團隊認知統一"></a>🎯 團隊認知統一</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ESLint 規則強制執行</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;variable&#x27;</span>,</span><br><span class="line">  <span class="attr">filter</span>: &#123; <span class="attr">regex</span>: <span class="string">&#x27;\\$$&#x27;</span>, <span class="attr">match</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  <span class="attr">format</span>: [<span class="string">&#x27;camelCase&#x27;</span>],</span><br><span class="line">  <span class="attr">suffix</span>: [<span class="string">&#x27;$&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="🧠-現代匈牙利命名法"><a href="#🧠-現代匈牙利命名法" class="headerlink" title="🧠 現代匈牙利命名法"></a>🧠 現代匈牙利命名法</h3><ul>
<li><strong>React</strong>: <code>useEffect</code>, <code>useState</code> - 用前綴表示 Hook</li>
<li><strong>Angular</strong>: <code>ngOnInit</code>, <code>ngOnDestroy</code> - 用前綴表示生命週期</li>
<li><strong>RxJS</strong>: <code>data$</code>, <code>loading$</code> - 用後綴表示 Observable</li>
</ul>
<hr>
<h2 id="📊-配置即文檔的哲學"><a href="#📊-配置即文檔的哲學" class="headerlink" title="📊 配置即文檔的哲學"></a>📊 配置即文檔的哲學</h2><h3 id="💡-ESLint-配置-團隊編碼約定"><a href="#💡-ESLint-配置-團隊編碼約定" class="headerlink" title="💡 ESLint 配置 &#x3D; 團隊編碼約定"></a>💡 ESLint 配置 &#x3D; 團隊編碼約定</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 這個配置文件告訴新人：</span></span><br><span class="line"><span class="comment">// 1. 我們重視類型安全 (@typescript-eslint/no-explicit-any)</span></span><br><span class="line"><span class="comment">// 2. 我們在意命名一致性 (naming-convention)</span></span><br><span class="line"><span class="comment">// 3. 我們關注 Angular 最佳實踐 (@angular-eslint/*)</span></span><br><span class="line"><span class="comment">// 4. 我們追求程式碼品質 (no-console, no-debugger)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [&#123;</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;@typescript-eslint/no-explicit-any&#x27;</span>: <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@typescript-eslint/naming-convention&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@angular-eslint/component-class-suffix&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;no-console&#x27;</span>: <span class="string">&#x27;warn&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<h3 id="🎯-自動化品質把關"><a href="#🎯-自動化品質把關" class="headerlink" title="🎯 自動化品質把關"></a>🎯 自動化品質把關</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 開發階段：友善提醒</span></span><br><span class="line">npm run lint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交階段：自動修正</span></span><br><span class="line">npm run lint:fix</span><br><span class="line"></span><br><span class="line"><span class="comment"># CI 階段：零容忍</span></span><br><span class="line">npm run lint:check</span><br></pre></td></tr></table></figure>

<h3 id="🚀-團隊成長軌跡"><a href="#🚀-團隊成長軌跡" class="headerlink" title="🚀 團隊成長軌跡"></a>🚀 團隊成長軌跡</h3><ul>
<li><strong>新手</strong>: 依賴 ESLint 學習最佳實踐</li>
<li><strong>熟手</strong>: 透過配置傳授經驗</li>
<li><strong>專家</strong>: 制定規則引導團隊</li>
</ul>
<hr>
<h2 id="🎯-核心洞察"><a href="#🎯-核心洞察" class="headerlink" title="🎯 核心洞察"></a>🎯 核心洞察</h2><h3 id="1-工具不是負擔，是放大器"><a href="#1-工具不是負擔，是放大器" class="headerlink" title="1. 工具不是負擔，是放大器"></a>1. <strong>工具不是負擔，是放大器</strong></h3><ul>
<li>ESLint 不是在「挑毛病」，而是在「自動化最佳實踐」</li>
<li>好的配置讓新人快速成長，讓專家專注創新</li>
</ul>
<h3 id="2-規範不是限制，是溝通語言"><a href="#2-規範不是限制，是溝通語言" class="headerlink" title="2. 規範不是限制，是溝通語言"></a>2. <strong>規範不是限制，是溝通語言</strong></h3><ul>
<li>統一的命名讓程式碼自說明</li>
<li>一致的結構降低理解成本</li>
</ul>
<h3 id="3-配置是活的文檔"><a href="#3-配置是活的文檔" class="headerlink" title="3. 配置是活的文檔"></a>3. <strong>配置是活的文檔</strong></h3><ul>
<li>規則反映團隊價值觀</li>
<li>工具配置承載知識傳承</li>
</ul>
<hr>
<h2 id="📝-實踐檢查清單"><a href="#📝-實踐檢查清單" class="headerlink" title="📝 實踐檢查清單"></a>📝 實踐檢查清單</h2><h3 id="ESLint-9-x-遷移"><a href="#ESLint-9-x-遷移" class="headerlink" title="ESLint 9.x 遷移"></a>ESLint 9.x 遷移</h3><ul>
<li><input disabled="" type="checkbox"> 安裝最新版本 ESLint 和相關插件</li>
<li><input disabled="" type="checkbox"> 創建 <code>eslint.config.js</code> 扁平配置</li>
<li><input disabled="" type="checkbox"> 移除舊的 <code>.eslintrc.*</code> 和 <code>.eslintignore</code></li>
<li><input disabled="" type="checkbox"> 測試所有 npm scripts 正常運作</li>
</ul>
<h3 id="命名規範實施"><a href="#命名規範實施" class="headerlink" title="命名規範實施"></a>命名規範實施</h3><ul>
<li><input disabled="" type="checkbox"> 配置 <code>@typescript-eslint/naming-convention</code> 規則</li>
<li><input disabled="" type="checkbox"> 修正現有程式碼中的命名問題  </li>
<li><input disabled="" type="checkbox"> 設定 Observable $ 後綴強制規則</li>
<li><input disabled="" type="checkbox"> 建立團隊命名規範文檔</li>
</ul>
<h3 id="開發流程優化"><a href="#開發流程優化" class="headerlink" title="開發流程優化"></a>開發流程優化</h3><ul>
<li><input disabled="" type="checkbox"> 配置 <code>--no-warn-ignored</code> 讓輸出更乾淨</li>
<li><input disabled="" type="checkbox"> 設定 <code>--max-warnings 0</code> 的嚴格模式</li>
<li><input disabled="" type="checkbox"> 整合 Git hooks 自動執行 lint</li>
<li><input disabled="" type="checkbox"> 建立 CI&#x2F;CD 的程式碼品質把關</li>
</ul>
<h2 id="💡-ESLint-配置決策流程圖"><a href="#💡-ESLint-配置決策流程圖" class="headerlink" title="💡 ESLint 配置決策流程圖"></a>💡 ESLint 配置決策流程圖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[新專案/升級需求] --&gt; B&#123;ESLint 版本?&#125;</span><br><span class="line">    B --&gt;|&lt; 9.0| C[考慮升級到 9.x]</span><br><span class="line">    B --&gt;|&gt;= 9.0| D[使用 Flat Config]</span><br><span class="line">    </span><br><span class="line">    C --&gt; E&#123;升級風險評估&#125;</span><br><span class="line">    E --&gt;|高| F[保持現有配置]</span><br><span class="line">    E --&gt;|低| D</span><br><span class="line">    </span><br><span class="line">    D --&gt; G[設計檔案類型配置]</span><br><span class="line">    G --&gt; H[TypeScript 檔案規則]</span><br><span class="line">    G --&gt; I[模板檔案規則]</span><br><span class="line">    G --&gt; J[測試檔案規則]</span><br><span class="line">    </span><br><span class="line">    H --&gt; K[命名規範設定]</span><br><span class="line">    K --&gt; L[Interface PascalCase]</span><br><span class="line">    K --&gt; M[Observable $ 後綴]</span><br><span class="line">    </span><br><span class="line">    L --&gt; N[團隊培訓]</span><br><span class="line">    M --&gt; N</span><br><span class="line">    N --&gt; O[CI/CD 整合]</span><br><span class="line">    O --&gt; P[效果監控]</span><br></pre></td></tr></table></figure>

<h2 id="🎯-核心洞察總結"><a href="#🎯-核心洞察總結" class="headerlink" title="🎯 核心洞察總結"></a>🎯 核心洞察總結</h2><h3 id="1-工具不是負擔，是放大器-1"><a href="#1-工具不是負擔，是放大器-1" class="headerlink" title="1. 工具不是負擔，是放大器"></a>1. <strong>工具不是負擔，是放大器</strong></h3><p>ESLint 9.x 的革命性改進體現在：</p>
<ul>
<li><strong>配置簡化</strong>：Flat Config 降低學習和維護成本</li>
<li><strong>精準控制</strong>：針對不同檔案類型的客製化規則</li>
<li><strong>開發體驗</strong>：–no-warn-ignored 等參數優化工作流程</li>
</ul>
<h3 id="2-規範不是限制，是溝通語言-1"><a href="#2-規範不是限制，是溝通語言-1" class="headerlink" title="2. 規範不是限制，是溝通語言"></a>2. <strong>規範不是限制，是溝通語言</strong></h3><p>統一的命名和配置標準：</p>
<ul>
<li><strong>認知負荷降低</strong>：PascalCase Interface 一眼識別類型</li>
<li><strong>團隊協作效率</strong>：Observable $ 後綴明確表達意圖</li>
<li><strong>知識傳承</strong>：配置即文檔，新人快速上手</li>
</ul>
<h3 id="3-配置是活的文檔-1"><a href="#3-配置是活的文檔-1" class="headerlink" title="3. 配置是活的文檔"></a>3. <strong>配置是活的文檔</strong></h3><p>ESLint 配置反映團隊價值觀：</p>
<ul>
<li><strong>技術債務管理</strong>：透過規則強制執行最佳實踐</li>
<li><strong>品質把關</strong>：自動化程式碼審查減少人工負擔</li>
<li><strong>持續改進</strong>：配置隨專案成長而演進</li>
</ul>
<h2 id="🚀-進階配置策略"><a href="#🚀-進階配置策略" class="headerlink" title="🚀 進階配置策略"></a>🚀 進階配置策略</h2><h3 id="漸進式升級路徑"><a href="#漸進式升級路徑" class="headerlink" title="漸進式升級路徑"></a>漸進式升級路徑</h3><ol>
<li><strong>評估現有配置</strong>：分析當前 ESLint 規則的覆蓋範圍</li>
<li><strong>分階段遷移</strong>：優先處理高影響、低風險的規則</li>
<li><strong>團隊培訓</strong>：確保團隊理解新配置的意圖和價值</li>
<li><strong>效果監控</strong>：追蹤程式碼品質和開發效率指標</li>
</ol>
<h3 id="企業級最佳實踐"><a href="#企業級最佳實踐" class="headerlink" title="企業級最佳實踐"></a>企業級最佳實踐</h3><ul>
<li><strong>配置共享</strong>：建立組織級的 ESLint 配置包</li>
<li><strong>自動化工具</strong>：整合 Husky、lint-staged 等工具</li>
<li><strong>指標監控</strong>：追蹤技術債務和程式碼品質趨勢</li>
</ul>
<h2 id="📞-技術支援與參考資源"><a href="#📞-技術支援與參考資源" class="headerlink" title="📞 技術支援與參考資源"></a>📞 技術支援與參考資源</h2><h3 id="官方文件"><a href="#官方文件" class="headerlink" title="官方文件"></a>官方文件</h3><ul>
<li><a target="_blank" rel="noopener" href="https://eslint.org/docs/latest/">ESLint 9.x 官方文件</a></li>
<li><a target="_blank" rel="noopener" href="https://eslint.org/docs/latest/use/configure/migration-guide">Flat Config 遷移指南</a></li>
<li><a target="_blank" rel="noopener" href="https://typescript-eslint.io/rules/">TypeScript ESLint 規則</a></li>
</ul>
<h3 id="實用工具"><a href="#實用工具" class="headerlink" title="實用工具"></a>實用工具</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/eslint/config-inspector">ESLint Config Inspector</a></li>
<li><a target="_blank" rel="noopener" href="https://eslint.style/">ESLint Stylistic</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/angular-eslint/angular-eslint">Angular ESLint</a></li>
</ul>
<h3 id="社群資源"><a href="#社群資源" class="headerlink" title="社群資源"></a>社群資源</h3><ul>
<li>ESLint Discord 社群</li>
<li>TypeScript ESLint 討論區</li>
<li>Angular ESLint GitHub Issues</li>
</ul>
<h3 id="延伸閱讀"><a href="#延伸閱讀" class="headerlink" title="延伸閱讀"></a>延伸閱讀</h3><ul>
<li>《Clean Code》by Robert C. Martin</li>
<li>《The Pragmatic Programmer》by Andrew Hunt</li>
<li>《Building Maintainable Software》by Joost Visser</li>
</ul>
<blockquote>
<p><strong>作者</strong>：前端工具鏈團隊<br><strong>更新日期</strong>：2025年6月29日<br><strong>版本</strong>：v2.0<br><strong>適用範圍</strong>：ESLint 9.x + TypeScript + Angular 專案</p>
</blockquote>
<hr>
<p><em>技術債務就是未來的利息，ESLint 配置是最划算的投資！</em> 🚀 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cookieseventeen.github.io/2025/06/29/eslint-configuration-best-practices-guide/" data-id="cmg51yfqi000eanmz3nij52us" data-title="ESLint 9.x 革命性配置與前端開發最佳化實戰指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Code-Quality/" rel="tag">Code Quality</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Developer-Experience/" rel="tag">Developer Experience</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ESLint-9-x/" rel="tag">ESLint 9.x</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flat-Config/" rel="tag">Flat Config</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Frontend-Tooling/" rel="tag">Frontend Tooling</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linting-Rules/" rel="tag">Linting Rules</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Naming-Convention/" rel="tag">Naming Convention</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-angular-ssr-prerender-technical-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/29/angular-ssr-prerender-technical-guide/" class="article-date">
  <time class="dt-published" datetime="2025-06-29T05:00:00.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech-Daily/">Tech Daily</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/29/angular-ssr-prerender-technical-guide/">Angular 19 SSR/Prerender 深度技術分析與實戰指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="📋-核心懶人包"><a href="#📋-核心懶人包" class="headerlink" title="📋 核心懶人包"></a>📋 核心懶人包</h2><ol>
<li><strong>雙軌架構設計</strong>：<code>.server</code> 檔案分工處理客戶端與伺服器端需求</li>
<li><strong>智能渲染策略</strong>：Prerender 用於靜態內容，Dynamic 用於需認證頁面</li>
<li><strong>水合作用機制</strong>：無縫銜接 SSR 預渲染內容與客戶端互動功能</li>
<li><strong>路由守衛兼容</strong>：設計 SSR 友善的守衛，避免預渲染階段問題</li>
<li><strong>效能優化策略</strong>：程式碼分割與選擇性預渲染的最佳實踐</li>
</ol>
<h2 id="🏗️-專案概述"><a href="#🏗️-專案概述" class="headerlink" title="🏗️ 專案概述"></a>🏗️ 專案概述</h2><p>本文深度分析了 Angular 19 SSR&#x2F;Prerender 技術的完整架構與實戰應用，涵蓋從建構到部署的全流程優化：</p>
<ul>
<li>🎯 <strong>架構分析</strong>：<code>.server</code> 檔案架構的技術細節和設計原理</li>
<li>🔄 <strong>渲染策略</strong>：Prerender 與 Dynamic 模式的選擇和配置</li>
<li>⚡ <strong>效能優化</strong>：程式碼分割、資料預取與快取策略</li>
<li>🛡️ <strong>安全考量</strong>：前後端安全分工和 SSR 環境配置</li>
<li>📊 <strong>監控部署</strong>：效能指標監控和建構最佳化</li>
</ul>
<h2 id="🏗️-Angular-SSR-完整架構流程"><a href="#🏗️-Angular-SSR-完整架構流程" class="headerlink" title="🏗️ Angular SSR 完整架構流程"></a>🏗️ Angular SSR 完整架構流程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[ng build] --&gt; B[客戶端建構]</span><br><span class="line">    A --&gt; C[伺服器端建構]</span><br><span class="line">    </span><br><span class="line">    B --&gt; B1[main.ts 啟動點]</span><br><span class="line">    B --&gt; B2[app.config.ts 客戶端配置]</span><br><span class="line">    B --&gt; B3[app.routes.ts 基礎路由]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1[main.server.ts 伺服器啟動]</span><br><span class="line">    C --&gt; C2[app.config.server.ts 合併配置]</span><br><span class="line">    C --&gt; C3[app.routes.server.ts SSR 路由]</span><br><span class="line">    C --&gt; C4[server.ts Express 設定]</span><br><span class="line">    </span><br><span class="line">    C2 --&gt; D[mergeApplicationConfig]</span><br><span class="line">    D --&gt; E[統一應用配置]</span><br><span class="line">    </span><br><span class="line">    E --&gt; F&#123;渲染模式判斷&#125;</span><br><span class="line">    F --&gt;|Prerender| G[靜態 HTML 生成]</span><br><span class="line">    F --&gt;|Dynamic| H[即時伺服器渲染]</span><br><span class="line">    </span><br><span class="line">    G --&gt; I[預建構 HTML 檔案]</span><br><span class="line">    H --&gt; J[執行期 HTML 生成]</span><br><span class="line">    </span><br><span class="line">    I --&gt; K[客戶端水合作用]</span><br><span class="line">    J --&gt; K</span><br><span class="line">    K --&gt; L[完整互動應用]</span><br></pre></td></tr></table></figure>

<h2 id="架構分析與技術原理"><a href="#架構分析與技術原理" class="headerlink" title="架構分析與技術原理"></a>架構分析與技術原理</h2><h3 id="1-server-檔案架構的技術細節"><a href="#1-server-檔案架構的技術細節" class="headerlink" title="1. .server 檔案架構的技術細節"></a>1. <code>.server</code> 檔案架構的技術細節</h3><p>Angular 19 的 SSR 架構採用雙軌設計，分別處理客戶端與伺服器端的需求：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 架構分工示意</span></span><br><span class="line">├── src/</span><br><span class="line">│   ├── app/</span><br><span class="line">│   │   ├── app.<span class="property">config</span>.<span class="property">ts</span>          <span class="comment">// 客戶端設定</span></span><br><span class="line">│   │   ├── app.<span class="property">config</span>.<span class="property">server</span>.<span class="property">ts</span>   <span class="comment">// 伺服器端設定合併</span></span><br><span class="line">│   │   ├── app.<span class="property">routes</span>.<span class="property">ts</span>           <span class="comment">// 共用路由定義</span></span><br><span class="line">│   │   └── app.<span class="property">routes</span>.<span class="property">server</span>.<span class="property">ts</span>    <span class="comment">// SSR 路由配置</span></span><br><span class="line">│   ├── main.<span class="property">ts</span>                     <span class="comment">// 客戶端啟動點</span></span><br><span class="line">│   ├── main.<span class="property">server</span>.<span class="property">ts</span>              <span class="comment">// 伺服器端啟動點</span></span><br><span class="line">│   └── server.<span class="property">ts</span>                   <span class="comment">// Express 伺服器設定</span></span><br></pre></td></tr></table></figure>

<h4 id="mergeApplicationConfig-運作機制"><a href="#mergeApplicationConfig-運作機制" class="headerlink" title="mergeApplicationConfig 運作機制"></a><code>mergeApplicationConfig</code> 運作機制</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.config.server.ts 的深度分析</span></span><br><span class="line"><span class="keyword">import</span> &#123; mergeApplicationConfig, <span class="title class_">ApplicationConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRendering &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-server&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRouting &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/ssr&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">serverConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    <span class="title function_">provideServerRendering</span>(),          <span class="comment">// 啟用伺服器端渲染</span></span><br><span class="line">    <span class="title function_">provideServerRouting</span>(serverRoutes) <span class="comment">// 提供 SSR 路由配置</span></span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mergeApplicationConfig 的合併邏輯：</span></span><br><span class="line"><span class="comment">// 1. 保留 appConfig 中的所有 providers</span></span><br><span class="line"><span class="comment">// 2. 添加 serverConfig 中的 providers</span></span><br><span class="line"><span class="comment">// 3. 如有衝突，serverConfig 優先級較高</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> config = <span class="title function_">mergeApplicationConfig</span>(appConfig, serverConfig);</span><br></pre></td></tr></table></figure>

<h3 id="2-路由配置的完整運作流程"><a href="#2-路由配置的完整運作流程" class="headerlink" title="2. 路由配置的完整運作流程"></a>2. 路由配置的完整運作流程</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.routes.ts - 基礎路由定義</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">component</span>: <span class="title class_">HomeComponent</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">component</span>: <span class="title class_">AboutComponent</span> &#125;,</span><br><span class="line">  &#123; </span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;dashboard&#x27;</span>, </span><br><span class="line">    <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./dashboard/dashboard.routes&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> r.<span class="property">routes</span>),</span><br><span class="line">    <span class="attr">canActivate</span>: [<span class="title class_">AuthGuard</span>] <span class="comment">// 路由守衛</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;products&#x27;</span>, <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./products/products.component&#x27;</span>) &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.routes.server.ts - SSR 配置</span></span><br><span class="line"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; routes &#125;; <span class="comment">// 重新匯出基礎路由</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">serverRoutes</span>: <span class="title class_">ServerRoute</span>[] = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,           <span class="comment">// 首頁預渲染</span></span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>,      <span class="comment">// 關於頁面預渲染</span></span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;dashboard/**&#x27;</span>, <span class="comment">// 需登入頁面動態渲染</span></span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;products&#x27;</span>,   <span class="comment">// 產品頁面預渲染</span></span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="3-Angular-SSR-完整架構流程"><a href="#3-Angular-SSR-完整架構流程" class="headerlink" title="3. Angular SSR 完整架構流程"></a>3. Angular SSR 完整架構流程</h3><p>透過以下圖表可以清楚了解 Angular SSR 從建構到執行的完整流程：</p>
<h4 id="建構與執行階段流程圖"><a href="#建構與執行階段流程圖" class="headerlink" title="建構與執行階段流程圖"></a>建構與執行階段流程圖</h4><p><img src="/%E5%B7%B2%E5%9C%A8%E4%B8%8A%E6%96%B9%E9%A1%AF%E7%A4%BA" alt="Angular SSR 架構流程"></p>
<h4 id="渲染策略決策流程圖"><a href="#渲染策略決策流程圖" class="headerlink" title="渲染策略決策流程圖"></a>渲染策略決策流程圖</h4><p><img src="/%E5%B7%B2%E5%9C%A8%E4%B8%8A%E6%96%B9%E9%A1%AF%E7%A4%BA" alt="渲染策略決策"></p>
<h3 id="4-預渲染與水合作用技術細節"><a href="#4-預渲染與水合作用技術細節" class="headerlink" title="4. 預渲染與水合作用技術細節"></a>4. 預渲染與水合作用技術細節</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 水合作用的關鍵時機</span></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-root&#x27;</span>,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;!-- 預渲染內容立即可見 --&gt;</span></span><br><span class="line"><span class="string">      &lt;h1&gt;&#123;&#123; title &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      &lt;!-- 需要水合作用才能互動 --&gt;</span></span><br><span class="line"><span class="string">      &lt;button (click)=&quot;handleClick()&quot;&gt;點擊我&lt;/button&gt;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      &lt;!-- 條件渲染避免水合作用錯誤 --&gt;</span></span><br><span class="line"><span class="string">      &lt;div *ngIf=&quot;isBrowser&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;這段內容只在瀏覽器顯示&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">  title = <span class="string">&#x27;預渲染標題&#x27;</span>;</span><br><span class="line">  isBrowser = <span class="title function_">isPlatformBrowser</span>(<span class="variable language_">this</span>.<span class="property">platformId</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="meta">@Inject</span>(PLATFORM_ID) <span class="keyword">private</span> <span class="attr">platformId</span>: <span class="title class_">Object</span></span>) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 水合作用完成後才能正常執行</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;按鈕被點擊&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-延遲載入與-SSR-兼容性詳解"><a href="#5-延遲載入與-SSR-兼容性詳解" class="headerlink" title="5. 延遲載入與 SSR 兼容性詳解"></a>5. 延遲載入與 SSR 兼容性詳解</h3><p>延遲載入與 SSR 完全兼容，不會產生額外的關注點：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 延遲載入模組的 SSR 處理</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;feature&#x27;</span>,</span><br><span class="line">    <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./feature/feature.routes&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">m</span> =&gt;</span> m.<span class="property">routes</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./admin/admin.component&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">AdminComponent</span>),</span><br><span class="line">    <span class="attr">canActivate</span>: [<span class="title class_">AuthGuard</span>] <span class="comment">// 搭配路由守衛</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// SSR 階段的處理邏輯：</span></span><br><span class="line"><span class="comment">// 1. 預渲染時：Angular 會分析所有路由，包括延遲載入的模組</span></span><br><span class="line"><span class="comment">// 2. 建構階段：會載入所有必要的模組來生成靜態 HTML</span></span><br><span class="line"><span class="comment">// 3. 執行階段：JavaScript bundle 仍然會按需延遲載入</span></span><br><span class="line"><span class="comment">// 4. 水合作用：不影響延遲載入的正常運作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 app.routes.server.ts 中可以針對延遲載入的路由設定不同策略</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">serverRoutes</span>: <span class="title class_">ServerRoute</span>[] = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;feature/**&#x27;</span>,</span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> <span class="comment">// 延遲載入模組也可預渲染</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;admin/**&#x27;</span>,</span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span>   <span class="comment">// 需認證的延遲載入模組用動態渲染</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p><strong>重要結論</strong>：延遲載入與 SSR 可以完美搭配，不需要特殊考量。Angular 的架構已經處理好了兩者的整合。</p>
<h2 id="效能優化策略"><a href="#效能優化策略" class="headerlink" title="效能優化策略"></a>效能優化策略</h2><h3 id="1-選擇性預渲染配置"><a href="#1-選擇性預渲染配置" class="headerlink" title="1. 選擇性預渲染配置"></a>1. 選擇性預渲染配置</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根據頁面特性選擇渲染模式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">serverRoutes</span>: <span class="title class_">ServerRoute</span>[] = [</span><br><span class="line">  <span class="comment">// 公開頁面 - 預渲染</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;contact&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 動態內容 - 動態渲染</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;news/**&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span> &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 需要認證 - 動態渲染</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;dashboard/**&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;profile/**&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span> &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="2-程式碼分割最佳實踐"><a href="#2-程式碼分割最佳實踐" class="headerlink" title="2. 程式碼分割最佳實踐"></a>2. 程式碼分割最佳實踐</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 元件層級的延遲載入</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;heavy-component&#x27;</span>,</span><br><span class="line">    <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./heavy/heavy.component&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">HeavyComponent</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;feature&#x27;</span>,</span><br><span class="line">    <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./feature/feature.routes&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> r.<span class="property">routes</span>)</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="3-資料預取策略"><a href="#3-資料預取策略" class="headerlink" title="3. 資料預取策略"></a>3. 資料預取策略</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 SSR 階段預取資料</span></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">DataResolver</span> <span class="keyword">implements</span> <span class="title class_">Resolve</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(): <span class="title class_">Observable</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// 在伺服器端執行時會預取資料</span></span><br><span class="line">    <span class="comment">// 注入到 HTML 中，客戶端可直接使用</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">dataService</span>.<span class="title function_">getData</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;data-page&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">DataPageComponent</span>,</span><br><span class="line">    <span class="attr">resolve</span>: &#123; <span class="attr">data</span>: <span class="title class_">DataResolver</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="路由守衛與-SSR-的實務處理"><a href="#路由守衛與-SSR-的實務處理" class="headerlink" title="路由守衛與 SSR 的實務處理"></a>路由守衛與 SSR 的實務處理</h2><h3 id="1-守衛對預渲染的影響"><a href="#1-守衛對預渲染的影響" class="headerlink" title="1. 守衛對預渲染的影響"></a>1. 守衛對預渲染的影響</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AuthGuard</span> <span class="keyword">implements</span> <span class="title class_">CanActivate</span> &#123;</span><br><span class="line">  <span class="title function_">canActivate</span>(): <span class="built_in">boolean</span> | <span class="title class_">Observable</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// 在預渲染階段，通常沒有認證資訊</span></span><br><span class="line">    <span class="comment">// 可能導致：</span></span><br><span class="line">    <span class="comment">// 1. 頁面被重導向到登入頁</span></span><br><span class="line">    <span class="comment">// 2. 頁面顯示為空白或載入中狀態</span></span><br><span class="line">    <span class="comment">// 3. 無法取得需要認證的資料</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isPlatformServer</span>(<span class="variable language_">this</span>.<span class="property">platformId</span>)) &#123;</span><br><span class="line">      <span class="comment">// 伺服器端渲染時的處理邏輯</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 或特殊處理</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">authService</span>.<span class="title function_">isAuthenticated</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-SSR-友善的守衛設計"><a href="#2-SSR-友善的守衛設計" class="headerlink" title="2. SSR 友善的守衛設計"></a>2. SSR 友善的守衛設計</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SSRFriendlyGuard</span> <span class="keyword">implements</span> <span class="title class_">CanActivate</span> &#123;</span><br><span class="line">  <span class="title function_">canActivate</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isPlatformServer</span>(<span class="variable language_">this</span>.<span class="property">platformId</span>)) &#123;</span><br><span class="line">      <span class="comment">// 伺服器端允許渲染基本結構</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客戶端才進行實際權限檢查</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">authService</span>.<span class="title function_">isAuthenticated</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="安全性考量與最佳實踐"><a href="#安全性考量與最佳實踐" class="headerlink" title="安全性考量與最佳實踐"></a>安全性考量與最佳實踐</h2><h3 id="1-前後端安全分工"><a href="#1-前後端安全分工" class="headerlink" title="1. 前後端安全分工"></a>1. 前後端安全分工</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前端路由守衛 - 僅用於 UX</span></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">RouteGuard</span> <span class="keyword">implements</span> <span class="title class_">CanActivate</span> &#123;</span><br><span class="line">  <span class="title function_">canActivate</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="comment">// 這只是 UI 層面的保護</span></span><br><span class="line">    <span class="comment">// 不能依賴它來保護敏感資料</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">userService</span>.<span class="title function_">hasPermission</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 後端 API - 真正的安全防線</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;api/sensitive-data&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SensitiveDataController</span> &#123;</span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  <span class="meta">@UseGuards</span>(<span class="title class_">JwtAuthGuard</span>) <span class="comment">// 後端驗證</span></span><br><span class="line">  <span class="title function_">getSensitiveData</span>(<span class="params"><span class="meta">@Request</span>() req</span>) &#123;</span><br><span class="line">    <span class="comment">// 真正的安全檢查在這裡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">dataService</span>.<span class="title function_">getSensitiveData</span>(req.<span class="property">user</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-SSR-環境的安全配置"><a href="#2-SSR-環境的安全配置" class="headerlink" title="2. SSR 環境的安全配置"></a>2. SSR 環境的安全配置</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.config.server.ts</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">serverConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    <span class="title function_">provideServerRendering</span>(),</span><br><span class="line">    <span class="comment">// 伺服器端專用的安全設定</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">provide</span>: <span class="string">&#x27;SERVER_SIDE_CONFIG&#x27;</span>,</span><br><span class="line">      <span class="attr">useValue</span>: &#123;</span><br><span class="line">        <span class="attr">apiUrl</span>: process.<span class="property">env</span>[<span class="string">&#x27;API_URL&#x27;</span>],</span><br><span class="line">        <span class="attr">secretKey</span>: process.<span class="property">env</span>[<span class="string">&#x27;SECRET_KEY&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="部署與監控建議"><a href="#部署與監控建議" class="headerlink" title="部署與監控建議"></a>部署與監控建議</h2><h3 id="1-建構指令最佳化"><a href="#1-建構指令最佳化" class="headerlink" title="1. 建構指令最佳化"></a>1. 建構指令最佳化</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build:ssr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ng build &amp;&amp; ng run app:server&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build:prerender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ng build &amp;&amp; ng run app:prerender&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;serve:ssr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node dist/app/server/server.mjs&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build:analyze&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ng build --stats-json &amp;&amp; npx webpack-bundle-analyzer dist/app/stats.json&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-效能監控指標"><a href="#2-效能監控指標" class="headerlink" title="2. 效能監控指標"></a>2. 效能監控指標</h3><ul>
<li><strong>FCP (First Contentful Paint)</strong>: 預渲染應 &lt; 1.5s</li>
<li><strong>LCP (Largest Contentful Paint)</strong>: 應 &lt; 2.5s</li>
<li><strong>CLS (Cumulative Layout Shift)</strong>: 應 &lt; 0.1</li>
<li><strong>TTI (Time to Interactive)</strong>: 水合作用完成時間</li>
</ul>
<h3 id="3-快取策略"><a href="#3-快取策略" class="headerlink" title="3. 快取策略"></a>3. 快取策略</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Express 伺服器快取設定</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;*&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 靜態資源長期快取</span></span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">url</span>.<span class="title function_">includes</span>(<span class="string">&#x27;/assets/&#x27;</span>)) &#123;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;public, max-age=31536000&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// HTML 短期快取</span></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;public, max-age=3600&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123; req &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="常見問題與解決方案"><a href="#常見問題與解決方案" class="headerlink" title="常見問題與解決方案"></a>常見問題與解決方案</h2><h3 id="1-預渲染頁面空白問題"><a href="#1-預渲染頁面空白問題" class="headerlink" title="1. 預渲染頁面空白問題"></a>1. 預渲染頁面空白問題</h3><p><strong>原因</strong>: 路由守衛阻擋或資料載入失敗<br><strong>解決</strong>: 設計 SSR 友善的守衛，或將該路由設為動態渲染</p>
<h3 id="2-水合作用錯誤"><a href="#2-水合作用錯誤" class="headerlink" title="2. 水合作用錯誤"></a>2. 水合作用錯誤</h3><p><strong>原因</strong>: 伺服器端與客戶端 DOM 結構不一致<br><strong>解決</strong>: 使用 <code>isPlatformBrowser/Server</code> 條件渲染</p>
<h3 id="3-效能回歸"><a href="#3-效能回歸" class="headerlink" title="3. 效能回歸"></a>3. 效能回歸</h3><p><strong>原因</strong>: 過度預渲染或 JavaScript bundle 過大<br><strong>解決</strong>: 選擇性預渲染 + 程式碼分割</p>
<h2 id="實務配置完整範例"><a href="#實務配置完整範例" class="headerlink" title="實務配置完整範例"></a>實務配置完整範例</h2><p>以下是一個完整的 Angular SSR 專案配置範例：</p>
<h3 id="1-app-config-ts-客戶端配置"><a href="#1-app-config-ts-客戶端配置" class="headerlink" title="1. app.config.ts (客戶端配置)"></a>1. app.config.ts (客戶端配置)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApplicationConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideAnimations &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser/animations&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    <span class="title function_">provideRouter</span>(routes),</span><br><span class="line">    <span class="title function_">provideAnimations</span>(),</span><br><span class="line">    <span class="comment">// 其他客戶端專用的提供者</span></span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-app-routes-ts-共用路由"><a href="#2-app-routes-ts-共用路由" class="headerlink" title="2. app.routes.ts (共用路由)"></a>2. app.routes.ts (共用路由)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Routes</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./home/home.component&#x27;</span>) &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./about/about.component&#x27;</span>) &#125;,</span><br><span class="line">  &#123; </span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;dashboard&#x27;</span>, </span><br><span class="line">    <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./dashboard/dashboard.routes&#x27;</span>),</span><br><span class="line">    <span class="attr">canActivate</span>: [<span class="title class_">AuthGuard</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;**&#x27;</span>, <span class="attr">redirectTo</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="3-app-routes-server-ts-伺服器路由配置"><a href="#3-app-routes-server-ts-伺服器路由配置" class="headerlink" title="3. app.routes.server.ts (伺服器路由配置)"></a>3. app.routes.server.ts (伺服器路由配置)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ServerRoute</span>, <span class="title class_">RenderMode</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/ssr&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; routes &#125;; <span class="comment">// 重新匯出共用路由</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">serverRoutes</span>: <span class="title class_">ServerRoute</span>[] = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;dashboard/**&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span> &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="4-app-config-server-ts-伺服器配置"><a href="#4-app-config-server-ts-伺服器配置" class="headerlink" title="4. app.config.server.ts (伺服器配置)"></a>4. app.config.server.ts (伺服器配置)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mergeApplicationConfig, <span class="title class_">ApplicationConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRendering &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-server&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRouting &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/ssr&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; appConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.config&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; serverRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes.server&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">serverConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    <span class="title function_">provideServerRendering</span>(),</span><br><span class="line">    <span class="title function_">provideServerRouting</span>(serverRoutes)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> config = <span class="title function_">mergeApplicationConfig</span>(appConfig, serverConfig);</span><br></pre></td></tr></table></figure>

<h2 id="關鍵技術問答"><a href="#關鍵技術問答" class="headerlink" title="關鍵技術問答"></a>關鍵技術問答</h2><h3 id="Q-為什麼要分離-server-和非-server-檔案？"><a href="#Q-為什麼要分離-server-和非-server-檔案？" class="headerlink" title="Q: 為什麼要分離 .server 和非 .server 檔案？"></a>Q: 為什麼要分離 <code>.server</code> 和非 <code>.server</code> 檔案？</h3><p><strong>A</strong>: 關注點分離，讓客戶端和伺服器端各自處理專屬的配置，避免混淆且方便維護。</p>
<h3 id="Q-mergeApplicationConfig-如何運作？"><a href="#Q-mergeApplicationConfig-如何運作？" class="headerlink" title="Q: mergeApplicationConfig 如何運作？"></a>Q: <code>mergeApplicationConfig</code> 如何運作？</h3><p><strong>A</strong>: 它會合併兩個 ApplicationConfig，保留所有 providers，若有衝突則伺服器配置優先。</p>
<h3 id="Q-延遲載入會影響-SSR-嗎？"><a href="#Q-延遲載入會影響-SSR-嗎？" class="headerlink" title="Q: 延遲載入會影響 SSR 嗎？"></a>Q: 延遲載入會影響 SSR 嗎？</h3><p><strong>A</strong>: 不會。Angular 在建構時會分析所有路由進行預渲染，執行時仍正常延遲載入。</p>
<h3 id="Q-路由守衛會影響預渲染嗎？"><a href="#Q-路由守衛會影響預渲染嗎？" class="headerlink" title="Q: 路由守衛會影響預渲染嗎？"></a>Q: 路由守衛會影響預渲染嗎？</h3><p><strong>A</strong>: 會。若守衛在預渲染時阻擋路由，該頁面可能產生空白內容。建議設計 SSR 友善的守衛。</p>
<h3 id="Q-何時應該選擇-SPA-而非-SSR？"><a href="#Q-何時應該選擇-SPA-而非-SSR？" class="headerlink" title="Q: 何時應該選擇 SPA 而非 SSR？"></a>Q: 何時應該選擇 SPA 而非 SSR？</h3><p><strong>A</strong>: 高互動性、需要登入、內部系統、不需 SEO 的場景適合 SPA。</p>
<h2 id="總結與展望"><a href="#總結與展望" class="headerlink" title="總結與展望"></a>總結與展望</h2><p>Angular 19 的 SSR&#x2F;Prerender 架構提供了強大且靈活的渲染策略，關鍵要點：</p>
<ol>
<li><strong>架構設計</strong>: 善用 <code>.server</code> 檔案分離關注點，<code>mergeApplicationConfig</code> 整合配置</li>
<li><strong>路由規劃</strong>: 根據頁面特性選擇適當的渲染模式，公開頁面用預渲染，私有頁面用動態渲染</li>
<li><strong>效能優化</strong>: 延遲載入與 SSR 完全兼容，搭配程式碼分割最佳化載入</li>
<li><strong>安全考量</strong>: 前端守衛僅為 UX 優化，真正的安全防線在後端 API 驗證</li>
<li><strong>監控維護</strong>: 持續監控 FCP、LCP、CLS 等指標，調整渲染策略</li>
</ol>
<p><strong>最佳實踐</strong>: 透過正確的配置策略，實現「公開頁面快速載入 + 私有頁面流暢互動」的最佳使用者體驗。</p>
<h2 id="💡-渲染策略決策流程圖"><a href="#💡-渲染策略決策流程圖" class="headerlink" title="💡 渲染策略決策流程圖"></a>💡 渲染策略決策流程圖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[新頁面需求] --&gt; B&#123;需要 SEO 嗎?&#125;</span><br><span class="line">    B --&gt;|是| C&#123;內容是否靜態?&#125;</span><br><span class="line">    B --&gt;|否| D&#123;需要認證嗎?&#125;</span><br><span class="line">    </span><br><span class="line">    C --&gt;|是| E[Prerender 模式]</span><br><span class="line">    C --&gt;|否| F&#123;更新頻率?&#125;</span><br><span class="line">    </span><br><span class="line">    D --&gt;|是| G[SPA 模式]</span><br><span class="line">    D --&gt;|否| H[Dynamic 模式]</span><br><span class="line">    </span><br><span class="line">    F --&gt;|低| E</span><br><span class="line">    F --&gt;|高| I[Dynamic 模式]</span><br><span class="line">    </span><br><span class="line">    E --&gt; J[建構時生成 HTML]</span><br><span class="line">    I --&gt; K[執行時生成 HTML]</span><br><span class="line">    H --&gt; K</span><br><span class="line">    G --&gt; L[純客戶端渲染]</span><br><span class="line">    </span><br><span class="line">    J --&gt; M[最佳 SEO + 載入速度]</span><br><span class="line">    K --&gt; N[良好 SEO + 動態內容]</span><br><span class="line">    L --&gt; O[最佳互動體驗]</span><br></pre></td></tr></table></figure>

<h2 id="🎯-核心洞察總結"><a href="#🎯-核心洞察總結" class="headerlink" title="🎯 核心洞察總結"></a>🎯 核心洞察總結</h2><h3 id="1-架構設計的智慧"><a href="#1-架構設計的智慧" class="headerlink" title="1. 架構設計的智慧"></a>1. <strong>架構設計的智慧</strong></h3><p>Angular 19 的雙軌設計提供了：</p>
<ul>
<li><strong>關注點分離</strong>：客戶端與伺服器端各司其職</li>
<li><strong>配置合併</strong>：<code>mergeApplicationConfig</code> 統一管理</li>
<li><strong>彈性選擇</strong>：根據頁面特性選擇最適合的渲染模式</li>
</ul>
<h3 id="2-效能優化的關鍵"><a href="#2-效能優化的關鍵" class="headerlink" title="2. 效能優化的關鍵"></a>2. <strong>效能優化的關鍵</strong></h3><ul>
<li><strong>選擇性預渲染</strong>：不是所有頁面都需要 SSR</li>
<li><strong>程式碼分割</strong>：延遲載入與 SSR 完全兼容</li>
<li><strong>快取策略</strong>：靜態資源長期快取，HTML 短期快取</li>
</ul>
<h3 id="3-安全性的平衡"><a href="#3-安全性的平衡" class="headerlink" title="3. 安全性的平衡"></a>3. <strong>安全性的平衡</strong></h3><ul>
<li><strong>前端防護</strong>：僅為 UX 優化，不能依賴它保護敏感資料</li>
<li><strong>後端防線</strong>：真正的安全檢查必須在 API 層執行</li>
<li><strong>SSR 友善設計</strong>：守衛應該考慮伺服器端渲染環境</li>
</ul>
<h2 id="🚀-進階實踐建議"><a href="#🚀-進階實踐建議" class="headerlink" title="🚀 進階實踐建議"></a>🚀 進階實踐建議</h2><h3 id="大型專案策略"><a href="#大型專案策略" class="headerlink" title="大型專案策略"></a>大型專案策略</h3><ul>
<li><strong>微前端整合</strong>：不同模組可採用不同渲染策略</li>
<li><strong>CDN 優化</strong>：預渲染頁面部署到全球 CDN</li>
<li><strong>A&#x2F;B 測試</strong>：比較不同渲染模式的效果</li>
</ul>
<h3 id="監控與維護"><a href="#監控與維護" class="headerlink" title="監控與維護"></a>監控與維護</h3><ul>
<li><strong>Core Web Vitals</strong>：持續監控 FCP、LCP、CLS 指標</li>
<li><strong>建構時間</strong>：預渲染頁面數量與建構時間的平衡</li>
<li><strong>伺服器負載</strong>：動態渲染的伺服器資源消耗</li>
</ul>
<h2 id="📞-技術支援與參考資源"><a href="#📞-技術支援與參考資源" class="headerlink" title="📞 技術支援與參考資源"></a>📞 技術支援與參考資源</h2><h3 id="官方文件"><a href="#官方文件" class="headerlink" title="官方文件"></a>官方文件</h3><ul>
<li><a target="_blank" rel="noopener" href="https://angular.dev/guide/ssr">Angular SSR 官方指南</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/angular/universal">Angular Universal 文件</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.angular.io/">Angular 19 新功能</a></li>
</ul>
<h3 id="實用工具"><a href="#實用工具" class="headerlink" title="實用工具"></a>實用工具</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@angular-devkit/build-angular">Angular DevKit Build</a></li>
<li><a target="_blank" rel="noopener" href="https://angular.io/cli">Angular CLI</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/lighthouse-ci">Lighthouse CI</a></li>
</ul>
<h3 id="效能測試"><a href="#效能測試" class="headerlink" title="效能測試"></a>效能測試</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.webpagetest.org/">Web Page Test</a></li>
<li><a target="_blank" rel="noopener" href="https://pagespeed.web.dev/">PageSpeed Insights</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/devtools/">Chrome DevTools</a></li>
</ul>
<h3 id="相關範例"><a href="#相關範例" class="headerlink" title="相關範例"></a>相關範例</h3><ul>
<li>Angular SSR 官方範例專案</li>
<li>Enterprise Angular 架構指南</li>
<li>PWA + SSR 整合案例</li>
</ul>
<blockquote>
<p><strong>作者</strong>：Angular 架構團隊<br><strong>更新日期</strong>：2025年6月29日<br><strong>版本</strong>：v2.1<br><strong>適用範圍</strong>：Angular 19+ SSR&#x2F;Prerender 專案</p>
</blockquote>
<hr>
<p><em>此文件結合了技術原理、實務配置和效能考量，提供完整的 Angular SSR 實作指南。</em> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cookieseventeen.github.io/2025/06/29/angular-ssr-prerender-technical-guide/" data-id="cmg51yfqe0001anmz14qn36c6" data-title="Angular 19 SSR/Prerender 深度技術分析與實戰指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-19/" rel="tag">Angular 19</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-Universal/" rel="tag">Angular Universal</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hydration/" rel="tag">Hydration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Performance-Optimization/" rel="tag">Performance Optimization</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Prerender/" rel="tag">Prerender</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RenderMode/" rel="tag">RenderMode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Route-Guards/" rel="tag">Route Guards</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SEO/" rel="tag">SEO</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSR/" rel="tag">SSR</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Server-Side-Rendering/" rel="tag">Server-Side Rendering</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-angular-ssr-technical-analysis-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/29/angular-ssr-technical-analysis-guide/" class="article-date">
  <time class="dt-published" datetime="2025-06-29T05:00:00.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech-Daily/">Tech Daily</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/29/angular-ssr-technical-analysis-guide/">Angular 19 SSR/Prerender 深度技術分析與實戰指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="📋-核心懶人包"><a href="#📋-核心懶人包" class="headerlink" title="📋 核心懶人包"></a>📋 核心懶人包</h2><ol>
<li><strong>雙軌架構設計</strong>：<code>.server</code> 檔案分工處理客戶端與伺服器端需求</li>
<li><strong>智能渲染策略</strong>：Prerender 用於靜態內容，Dynamic 用於需認證頁面</li>
<li><strong>水合作用機制</strong>：無縫銜接 SSR 預渲染內容與客戶端互動功能</li>
<li><strong>路由守衛兼容</strong>：設計 SSR 友善的守衛，避免預渲染階段問題</li>
<li><strong>效能優化策略</strong>：程式碼分割與選擇性預渲染的最佳實踐</li>
</ol>
<h2 id="🏗️-專案概述"><a href="#🏗️-專案概述" class="headerlink" title="🏗️ 專案概述"></a>🏗️ 專案概述</h2><p>本文深度分析了 Angular 19 SSR&#x2F;Prerender 技術的完整架構與實戰應用，涵蓋從建構到部署的全流程優化：</p>
<ul>
<li>🎯 <strong>架構分析</strong>：<code>.server</code> 檔案架構的技術細節和設計原理</li>
<li>🔄 <strong>渲染策略</strong>：Prerender 與 Dynamic 模式的選擇和配置</li>
<li>⚡ <strong>效能優化</strong>：程式碼分割、資料預取與快取策略</li>
<li>🛡️ <strong>安全考量</strong>：前後端安全分工和 SSR 環境配置</li>
<li>📊 <strong>監控部署</strong>：效能指標監控和建構最佳化</li>
</ul>
<h2 id="🏗️-Angular-SSR-完整架構流程"><a href="#🏗️-Angular-SSR-完整架構流程" class="headerlink" title="🏗️ Angular SSR 完整架構流程"></a>🏗️ Angular SSR 完整架構流程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[ng build] --&gt; B[客戶端建構]</span><br><span class="line">    A --&gt; C[伺服器端建構]</span><br><span class="line">    </span><br><span class="line">    B --&gt; B1[main.ts 啟動點]</span><br><span class="line">    B --&gt; B2[app.config.ts 客戶端配置]</span><br><span class="line">    B --&gt; B3[app.routes.ts 基礎路由]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1[main.server.ts 伺服器啟動]</span><br><span class="line">    C --&gt; C2[app.config.server.ts 合併配置]</span><br><span class="line">    C --&gt; C3[app.routes.server.ts SSR 路由]</span><br><span class="line">    C --&gt; C4[server.ts Express 設定]</span><br><span class="line">    </span><br><span class="line">    C2 --&gt; D[mergeApplicationConfig]</span><br><span class="line">    D --&gt; E[統一應用配置]</span><br><span class="line">    </span><br><span class="line">    E --&gt; F&#123;渲染模式判斷&#125;</span><br><span class="line">    F --&gt;|Prerender| G[靜態 HTML 生成]</span><br><span class="line">    F --&gt;|Dynamic| H[即時伺服器渲染]</span><br><span class="line">    </span><br><span class="line">    G --&gt; I[預建構 HTML 檔案]</span><br><span class="line">    H --&gt; J[執行期 HTML 生成]</span><br><span class="line">    </span><br><span class="line">    I --&gt; K[客戶端水合作用]</span><br><span class="line">    J --&gt; K</span><br><span class="line">    K --&gt; L[完整互動應用]</span><br></pre></td></tr></table></figure>

<h2 id="架構分析與技術原理"><a href="#架構分析與技術原理" class="headerlink" title="架構分析與技術原理"></a>架構分析與技術原理</h2><h3 id="1-server-檔案架構的技術細節"><a href="#1-server-檔案架構的技術細節" class="headerlink" title="1. .server 檔案架構的技術細節"></a>1. <code>.server</code> 檔案架構的技術細節</h3><p>Angular 19 的 SSR 架構採用雙軌設計，分別處理客戶端與伺服器端的需求：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 架構分工示意</span></span><br><span class="line">├── src/</span><br><span class="line">│   ├── app/</span><br><span class="line">│   │   ├── app.<span class="property">config</span>.<span class="property">ts</span>          <span class="comment">// 客戶端設定</span></span><br><span class="line">│   │   ├── app.<span class="property">config</span>.<span class="property">server</span>.<span class="property">ts</span>   <span class="comment">// 伺服器端設定合併</span></span><br><span class="line">│   │   ├── app.<span class="property">routes</span>.<span class="property">ts</span>           <span class="comment">// 共用路由定義</span></span><br><span class="line">│   │   └── app.<span class="property">routes</span>.<span class="property">server</span>.<span class="property">ts</span>    <span class="comment">// SSR 路由配置</span></span><br><span class="line">│   ├── main.<span class="property">ts</span>                     <span class="comment">// 客戶端啟動點</span></span><br><span class="line">│   ├── main.<span class="property">server</span>.<span class="property">ts</span>              <span class="comment">// 伺服器端啟動點</span></span><br><span class="line">│   └── server.<span class="property">ts</span>                   <span class="comment">// Express 伺服器設定</span></span><br></pre></td></tr></table></figure>

<h4 id="mergeApplicationConfig-運作機制"><a href="#mergeApplicationConfig-運作機制" class="headerlink" title="mergeApplicationConfig 運作機制"></a><code>mergeApplicationConfig</code> 運作機制</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.config.server.ts 的深度分析</span></span><br><span class="line"><span class="keyword">import</span> &#123; mergeApplicationConfig, <span class="title class_">ApplicationConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRendering &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-server&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRouting &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/ssr&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">serverConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    <span class="title function_">provideServerRendering</span>(),          <span class="comment">// 啟用伺服器端渲染</span></span><br><span class="line">    <span class="title function_">provideServerRouting</span>(serverRoutes) <span class="comment">// 提供 SSR 路由配置</span></span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mergeApplicationConfig 的合併邏輯：</span></span><br><span class="line"><span class="comment">// 1. 保留 appConfig 中的所有 providers</span></span><br><span class="line"><span class="comment">// 2. 添加 serverConfig 中的 providers</span></span><br><span class="line"><span class="comment">// 3. 如有衝突，serverConfig 優先級較高</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> config = <span class="title function_">mergeApplicationConfig</span>(appConfig, serverConfig);</span><br></pre></td></tr></table></figure>

<h3 id="2-路由配置的完整運作流程"><a href="#2-路由配置的完整運作流程" class="headerlink" title="2. 路由配置的完整運作流程"></a>2. 路由配置的完整運作流程</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.routes.ts - 基礎路由定義</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">component</span>: <span class="title class_">HomeComponent</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">component</span>: <span class="title class_">AboutComponent</span> &#125;,</span><br><span class="line">  &#123; </span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;dashboard&#x27;</span>, </span><br><span class="line">    <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./dashboard/dashboard.routes&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> r.<span class="property">routes</span>),</span><br><span class="line">    <span class="attr">canActivate</span>: [<span class="title class_">AuthGuard</span>] <span class="comment">// 路由守衛</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;products&#x27;</span>, <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./products/products.component&#x27;</span>) &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.routes.server.ts - SSR 配置</span></span><br><span class="line"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; routes &#125;; <span class="comment">// 重新匯出基礎路由</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">serverRoutes</span>: <span class="title class_">ServerRoute</span>[] = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,           <span class="comment">// 首頁預渲染</span></span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>,      <span class="comment">// 關於頁面預渲染</span></span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;dashboard/**&#x27;</span>, <span class="comment">// 需登入頁面動態渲染</span></span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;products&#x27;</span>,   <span class="comment">// 產品頁面預渲染</span></span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="3-Angular-SSR-完整架構流程"><a href="#3-Angular-SSR-完整架構流程" class="headerlink" title="3. Angular SSR 完整架構流程"></a>3. Angular SSR 完整架構流程</h3><p>透過以下圖表可以清楚了解 Angular SSR 從建構到執行的完整流程：</p>
<h4 id="建構與執行階段流程圖"><a href="#建構與執行階段流程圖" class="headerlink" title="建構與執行階段流程圖"></a>建構與執行階段流程圖</h4><p><img src="/%E5%B7%B2%E5%9C%A8%E4%B8%8A%E6%96%B9%E9%A1%AF%E7%A4%BA" alt="Angular SSR 架構流程"></p>
<h4 id="渲染策略決策流程圖"><a href="#渲染策略決策流程圖" class="headerlink" title="渲染策略決策流程圖"></a>渲染策略決策流程圖</h4><p><img src="/%E5%B7%B2%E5%9C%A8%E4%B8%8A%E6%96%B9%E9%A1%AF%E7%A4%BA" alt="渲染策略決策"></p>
<h3 id="4-預渲染與水合作用技術細節"><a href="#4-預渲染與水合作用技術細節" class="headerlink" title="4. 預渲染與水合作用技術細節"></a>4. 預渲染與水合作用技術細節</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 水合作用的關鍵時機</span></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-root&#x27;</span>,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;!-- 預渲染內容立即可見 --&gt;</span></span><br><span class="line"><span class="string">      &lt;h1&gt;&#123;&#123; title &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      &lt;!-- 需要水合作用才能互動 --&gt;</span></span><br><span class="line"><span class="string">      &lt;button (click)=&quot;handleClick()&quot;&gt;點擊我&lt;/button&gt;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      &lt;!-- 條件渲染避免水合作用錯誤 --&gt;</span></span><br><span class="line"><span class="string">      &lt;div *ngIf=&quot;isBrowser&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;這段內容只在瀏覽器顯示&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">  title = <span class="string">&#x27;預渲染標題&#x27;</span>;</span><br><span class="line">  isBrowser = <span class="title function_">isPlatformBrowser</span>(<span class="variable language_">this</span>.<span class="property">platformId</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="meta">@Inject</span>(PLATFORM_ID) <span class="keyword">private</span> <span class="attr">platformId</span>: <span class="title class_">Object</span></span>) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 水合作用完成後才能正常執行</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;按鈕被點擊&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-延遲載入與-SSR-兼容性詳解"><a href="#5-延遲載入與-SSR-兼容性詳解" class="headerlink" title="5. 延遲載入與 SSR 兼容性詳解"></a>5. 延遲載入與 SSR 兼容性詳解</h3><p>延遲載入與 SSR 完全兼容，不會產生額外的關注點：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 延遲載入模組的 SSR 處理</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;feature&#x27;</span>,</span><br><span class="line">    <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./feature/feature.routes&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">m</span> =&gt;</span> m.<span class="property">routes</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./admin/admin.component&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">AdminComponent</span>),</span><br><span class="line">    <span class="attr">canActivate</span>: [<span class="title class_">AuthGuard</span>] <span class="comment">// 搭配路由守衛</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// SSR 階段的處理邏輯：</span></span><br><span class="line"><span class="comment">// 1. 預渲染時：Angular 會分析所有路由，包括延遲載入的模組</span></span><br><span class="line"><span class="comment">// 2. 建構階段：會載入所有必要的模組來生成靜態 HTML</span></span><br><span class="line"><span class="comment">// 3. 執行階段：JavaScript bundle 仍然會按需延遲載入</span></span><br><span class="line"><span class="comment">// 4. 水合作用：不影響延遲載入的正常運作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 app.routes.server.ts 中可以針對延遲載入的路由設定不同策略</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">serverRoutes</span>: <span class="title class_">ServerRoute</span>[] = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;feature/**&#x27;</span>,</span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> <span class="comment">// 延遲載入模組也可預渲染</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;admin/**&#x27;</span>,</span><br><span class="line">    <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span>   <span class="comment">// 需認證的延遲載入模組用動態渲染</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p><strong>重要結論</strong>：延遲載入與 SSR 可以完美搭配，不需要特殊考量。Angular 的架構已經處理好了兩者的整合。</p>
<h2 id="效能優化策略"><a href="#效能優化策略" class="headerlink" title="效能優化策略"></a>效能優化策略</h2><h3 id="1-選擇性預渲染配置"><a href="#1-選擇性預渲染配置" class="headerlink" title="1. 選擇性預渲染配置"></a>1. 選擇性預渲染配置</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根據頁面特性選擇渲染模式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">serverRoutes</span>: <span class="title class_">ServerRoute</span>[] = [</span><br><span class="line">  <span class="comment">// 公開頁面 - 預渲染</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;contact&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 動態內容 - 動態渲染</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;news/**&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span> &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 需要認證 - 動態渲染</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;dashboard/**&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;profile/**&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span> &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="2-程式碼分割最佳實踐"><a href="#2-程式碼分割最佳實踐" class="headerlink" title="2. 程式碼分割最佳實踐"></a>2. 程式碼分割最佳實踐</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 元件層級的延遲載入</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;heavy-component&#x27;</span>,</span><br><span class="line">    <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./heavy/heavy.component&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">HeavyComponent</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;feature&#x27;</span>,</span><br><span class="line">    <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./feature/feature.routes&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">r</span> =&gt;</span> r.<span class="property">routes</span>)</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="3-資料預取策略"><a href="#3-資料預取策略" class="headerlink" title="3. 資料預取策略"></a>3. 資料預取策略</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 SSR 階段預取資料</span></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">DataResolver</span> <span class="keyword">implements</span> <span class="title class_">Resolve</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(): <span class="title class_">Observable</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// 在伺服器端執行時會預取資料</span></span><br><span class="line">    <span class="comment">// 注入到 HTML 中，客戶端可直接使用</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">dataService</span>.<span class="title function_">getData</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;data-page&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">DataPageComponent</span>,</span><br><span class="line">    <span class="attr">resolve</span>: &#123; <span class="attr">data</span>: <span class="title class_">DataResolver</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="路由守衛與-SSR-的實務處理"><a href="#路由守衛與-SSR-的實務處理" class="headerlink" title="路由守衛與 SSR 的實務處理"></a>路由守衛與 SSR 的實務處理</h2><h3 id="1-守衛對預渲染的影響"><a href="#1-守衛對預渲染的影響" class="headerlink" title="1. 守衛對預渲染的影響"></a>1. 守衛對預渲染的影響</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AuthGuard</span> <span class="keyword">implements</span> <span class="title class_">CanActivate</span> &#123;</span><br><span class="line">  <span class="title function_">canActivate</span>(): <span class="built_in">boolean</span> | <span class="title class_">Observable</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// 在預渲染階段，通常沒有認證資訊</span></span><br><span class="line">    <span class="comment">// 可能導致：</span></span><br><span class="line">    <span class="comment">// 1. 頁面被重導向到登入頁</span></span><br><span class="line">    <span class="comment">// 2. 頁面顯示為空白或載入中狀態</span></span><br><span class="line">    <span class="comment">// 3. 無法取得需要認證的資料</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isPlatformServer</span>(<span class="variable language_">this</span>.<span class="property">platformId</span>)) &#123;</span><br><span class="line">      <span class="comment">// 伺服器端渲染時的處理邏輯</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 或特殊處理</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">authService</span>.<span class="title function_">isAuthenticated</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-SSR-友善的守衛設計"><a href="#2-SSR-友善的守衛設計" class="headerlink" title="2. SSR 友善的守衛設計"></a>2. SSR 友善的守衛設計</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SSRFriendlyGuard</span> <span class="keyword">implements</span> <span class="title class_">CanActivate</span> &#123;</span><br><span class="line">  <span class="title function_">canActivate</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isPlatformServer</span>(<span class="variable language_">this</span>.<span class="property">platformId</span>)) &#123;</span><br><span class="line">      <span class="comment">// 伺服器端允許渲染基本結構</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客戶端才進行實際權限檢查</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">authService</span>.<span class="title function_">isAuthenticated</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="安全性考量與最佳實踐"><a href="#安全性考量與最佳實踐" class="headerlink" title="安全性考量與最佳實踐"></a>安全性考量與最佳實踐</h2><h3 id="1-前後端安全分工"><a href="#1-前後端安全分工" class="headerlink" title="1. 前後端安全分工"></a>1. 前後端安全分工</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前端路由守衛 - 僅用於 UX</span></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">RouteGuard</span> <span class="keyword">implements</span> <span class="title class_">CanActivate</span> &#123;</span><br><span class="line">  <span class="title function_">canActivate</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="comment">// 這只是 UI 層面的保護</span></span><br><span class="line">    <span class="comment">// 不能依賴它來保護敏感資料</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">userService</span>.<span class="title function_">hasPermission</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 後端 API - 真正的安全防線</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;api/sensitive-data&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SensitiveDataController</span> &#123;</span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  <span class="meta">@UseGuards</span>(<span class="title class_">JwtAuthGuard</span>) <span class="comment">// 後端驗證</span></span><br><span class="line">  <span class="title function_">getSensitiveData</span>(<span class="params"><span class="meta">@Request</span>() req</span>) &#123;</span><br><span class="line">    <span class="comment">// 真正的安全檢查在這裡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">dataService</span>.<span class="title function_">getSensitiveData</span>(req.<span class="property">user</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-SSR-環境的安全配置"><a href="#2-SSR-環境的安全配置" class="headerlink" title="2. SSR 環境的安全配置"></a>2. SSR 環境的安全配置</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.config.server.ts</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">serverConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    <span class="title function_">provideServerRendering</span>(),</span><br><span class="line">    <span class="comment">// 伺服器端專用的安全設定</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">provide</span>: <span class="string">&#x27;SERVER_SIDE_CONFIG&#x27;</span>,</span><br><span class="line">      <span class="attr">useValue</span>: &#123;</span><br><span class="line">        <span class="attr">apiUrl</span>: process.<span class="property">env</span>[<span class="string">&#x27;API_URL&#x27;</span>],</span><br><span class="line">        <span class="attr">secretKey</span>: process.<span class="property">env</span>[<span class="string">&#x27;SECRET_KEY&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="部署與監控建議"><a href="#部署與監控建議" class="headerlink" title="部署與監控建議"></a>部署與監控建議</h2><h3 id="1-建構指令最佳化"><a href="#1-建構指令最佳化" class="headerlink" title="1. 建構指令最佳化"></a>1. 建構指令最佳化</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build:ssr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ng build &amp;&amp; ng run app:server&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build:prerender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ng build &amp;&amp; ng run app:prerender&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;serve:ssr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node dist/app/server/server.mjs&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build:analyze&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ng build --stats-json &amp;&amp; npx webpack-bundle-analyzer dist/app/stats.json&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-效能監控指標"><a href="#2-效能監控指標" class="headerlink" title="2. 效能監控指標"></a>2. 效能監控指標</h3><ul>
<li><strong>FCP (First Contentful Paint)</strong>: 預渲染應 &lt; 1.5s</li>
<li><strong>LCP (Largest Contentful Paint)</strong>: 應 &lt; 2.5s</li>
<li><strong>CLS (Cumulative Layout Shift)</strong>: 應 &lt; 0.1</li>
<li><strong>TTI (Time to Interactive)</strong>: 水合作用完成時間</li>
</ul>
<h3 id="3-快取策略"><a href="#3-快取策略" class="headerlink" title="3. 快取策略"></a>3. 快取策略</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Express 伺服器快取設定</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;*&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 靜態資源長期快取</span></span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">url</span>.<span class="title function_">includes</span>(<span class="string">&#x27;/assets/&#x27;</span>)) &#123;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;public, max-age=31536000&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// HTML 短期快取</span></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;public, max-age=3600&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123; req &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="常見問題與解決方案"><a href="#常見問題與解決方案" class="headerlink" title="常見問題與解決方案"></a>常見問題與解決方案</h2><h3 id="1-預渲染頁面空白問題"><a href="#1-預渲染頁面空白問題" class="headerlink" title="1. 預渲染頁面空白問題"></a>1. 預渲染頁面空白問題</h3><p><strong>原因</strong>: 路由守衛阻擋或資料載入失敗<br><strong>解決</strong>: 設計 SSR 友善的守衛，或將該路由設為動態渲染</p>
<h3 id="2-水合作用錯誤"><a href="#2-水合作用錯誤" class="headerlink" title="2. 水合作用錯誤"></a>2. 水合作用錯誤</h3><p><strong>原因</strong>: 伺服器端與客戶端 DOM 結構不一致<br><strong>解決</strong>: 使用 <code>isPlatformBrowser/Server</code> 條件渲染</p>
<h3 id="3-效能回歸"><a href="#3-效能回歸" class="headerlink" title="3. 效能回歸"></a>3. 效能回歸</h3><p><strong>原因</strong>: 過度預渲染或 JavaScript bundle 過大<br><strong>解決</strong>: 選擇性預渲染 + 程式碼分割</p>
<h2 id="實務配置完整範例"><a href="#實務配置完整範例" class="headerlink" title="實務配置完整範例"></a>實務配置完整範例</h2><p>以下是一個完整的 Angular SSR 專案配置範例：</p>
<h3 id="1-app-config-ts-客戶端配置"><a href="#1-app-config-ts-客戶端配置" class="headerlink" title="1. app.config.ts (客戶端配置)"></a>1. app.config.ts (客戶端配置)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ApplicationConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideAnimations &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser/animations&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">appConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    <span class="title function_">provideRouter</span>(routes),</span><br><span class="line">    <span class="title function_">provideAnimations</span>(),</span><br><span class="line">    <span class="comment">// 其他客戶端專用的提供者</span></span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-app-routes-ts-共用路由"><a href="#2-app-routes-ts-共用路由" class="headerlink" title="2. app.routes.ts (共用路由)"></a>2. app.routes.ts (共用路由)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Routes</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">Routes</span> = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./home/home.component&#x27;</span>) &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./about/about.component&#x27;</span>) &#125;,</span><br><span class="line">  &#123; </span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;dashboard&#x27;</span>, </span><br><span class="line">    <span class="attr">loadChildren</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./dashboard/dashboard.routes&#x27;</span>),</span><br><span class="line">    <span class="attr">canActivate</span>: [<span class="title class_">AuthGuard</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;**&#x27;</span>, <span class="attr">redirectTo</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="3-app-routes-server-ts-伺服器路由配置"><a href="#3-app-routes-server-ts-伺服器路由配置" class="headerlink" title="3. app.routes.server.ts (伺服器路由配置)"></a>3. app.routes.server.ts (伺服器路由配置)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ServerRoute</span>, <span class="title class_">RenderMode</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/ssr&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; routes &#125;; <span class="comment">// 重新匯出共用路由</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">serverRoutes</span>: <span class="title class_">ServerRoute</span>[] = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Prerender</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;dashboard/**&#x27;</span>, <span class="attr">renderMode</span>: <span class="title class_">RenderMode</span>.<span class="property">Dynamic</span> &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="4-app-config-server-ts-伺服器配置"><a href="#4-app-config-server-ts-伺服器配置" class="headerlink" title="4. app.config.server.ts (伺服器配置)"></a>4. app.config.server.ts (伺服器配置)</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mergeApplicationConfig, <span class="title class_">ApplicationConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRendering &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-server&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; provideServerRouting &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/ssr&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; appConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.config&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; serverRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.routes.server&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">serverConfig</span>: <span class="title class_">ApplicationConfig</span> = &#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    <span class="title function_">provideServerRendering</span>(),</span><br><span class="line">    <span class="title function_">provideServerRouting</span>(serverRoutes)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> config = <span class="title function_">mergeApplicationConfig</span>(appConfig, serverConfig);</span><br></pre></td></tr></table></figure>

<h2 id="關鍵技術問答"><a href="#關鍵技術問答" class="headerlink" title="關鍵技術問答"></a>關鍵技術問答</h2><h3 id="Q-為什麼要分離-server-和非-server-檔案？"><a href="#Q-為什麼要分離-server-和非-server-檔案？" class="headerlink" title="Q: 為什麼要分離 .server 和非 .server 檔案？"></a>Q: 為什麼要分離 <code>.server</code> 和非 <code>.server</code> 檔案？</h3><p><strong>A</strong>: 關注點分離，讓客戶端和伺服器端各自處理專屬的配置，避免混淆且方便維護。</p>
<h3 id="Q-mergeApplicationConfig-如何運作？"><a href="#Q-mergeApplicationConfig-如何運作？" class="headerlink" title="Q: mergeApplicationConfig 如何運作？"></a>Q: <code>mergeApplicationConfig</code> 如何運作？</h3><p><strong>A</strong>: 它會合併兩個 ApplicationConfig，保留所有 providers，若有衝突則伺服器配置優先。</p>
<h3 id="Q-延遲載入會影響-SSR-嗎？"><a href="#Q-延遲載入會影響-SSR-嗎？" class="headerlink" title="Q: 延遲載入會影響 SSR 嗎？"></a>Q: 延遲載入會影響 SSR 嗎？</h3><p><strong>A</strong>: 不會。Angular 在建構時會分析所有路由進行預渲染，執行時仍正常延遲載入。</p>
<h3 id="Q-路由守衛會影響預渲染嗎？"><a href="#Q-路由守衛會影響預渲染嗎？" class="headerlink" title="Q: 路由守衛會影響預渲染嗎？"></a>Q: 路由守衛會影響預渲染嗎？</h3><p><strong>A</strong>: 會。若守衛在預渲染時阻擋路由，該頁面可能產生空白內容。建議設計 SSR 友善的守衛。</p>
<h3 id="Q-何時應該選擇-SPA-而非-SSR？"><a href="#Q-何時應該選擇-SPA-而非-SSR？" class="headerlink" title="Q: 何時應該選擇 SPA 而非 SSR？"></a>Q: 何時應該選擇 SPA 而非 SSR？</h3><p><strong>A</strong>: 高互動性、需要登入、內部系統、不需 SEO 的場景適合 SPA。</p>
<h2 id="總結與展望"><a href="#總結與展望" class="headerlink" title="總結與展望"></a>總結與展望</h2><p>Angular 19 的 SSR&#x2F;Prerender 架構提供了強大且靈活的渲染策略，關鍵要點：</p>
<ol>
<li><strong>架構設計</strong>: 善用 <code>.server</code> 檔案分離關注點，<code>mergeApplicationConfig</code> 整合配置</li>
<li><strong>路由規劃</strong>: 根據頁面特性選擇適當的渲染模式，公開頁面用預渲染，私有頁面用動態渲染</li>
<li><strong>效能優化</strong>: 延遲載入與 SSR 完全兼容，搭配程式碼分割最佳化載入</li>
<li><strong>安全考量</strong>: 前端守衛僅為 UX 優化，真正的安全防線在後端 API 驗證</li>
<li><strong>監控維護</strong>: 持續監控 FCP、LCP、CLS 等指標，調整渲染策略</li>
</ol>
<p><strong>最佳實踐</strong>: 透過正確的配置策略，實現「公開頁面快速載入 + 私有頁面流暢互動」的最佳使用者體驗。</p>
<h2 id="💡-渲染策略決策流程圖"><a href="#💡-渲染策略決策流程圖" class="headerlink" title="💡 渲染策略決策流程圖"></a>💡 渲染策略決策流程圖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[新頁面需求] --&gt; B&#123;需要 SEO 嗎?&#125;</span><br><span class="line">    B --&gt;|是| C&#123;內容是否靜態?&#125;</span><br><span class="line">    B --&gt;|否| D&#123;需要認證嗎?&#125;</span><br><span class="line">    </span><br><span class="line">    C --&gt;|是| E[Prerender 模式]</span><br><span class="line">    C --&gt;|否| F&#123;更新頻率?&#125;</span><br><span class="line">    </span><br><span class="line">    D --&gt;|是| G[SPA 模式]</span><br><span class="line">    D --&gt;|否| H[Dynamic 模式]</span><br><span class="line">    </span><br><span class="line">    F --&gt;|低| E</span><br><span class="line">    F --&gt;|高| I[Dynamic 模式]</span><br><span class="line">    </span><br><span class="line">    E --&gt; J[建構時生成 HTML]</span><br><span class="line">    I --&gt; K[執行時生成 HTML]</span><br><span class="line">    H --&gt; K</span><br><span class="line">    G --&gt; L[純客戶端渲染]</span><br><span class="line">    </span><br><span class="line">    J --&gt; M[最佳 SEO + 載入速度]</span><br><span class="line">    K --&gt; N[良好 SEO + 動態內容]</span><br><span class="line">    L --&gt; O[最佳互動體驗]</span><br></pre></td></tr></table></figure>

<h2 id="🎯-核心洞察總結"><a href="#🎯-核心洞察總結" class="headerlink" title="🎯 核心洞察總結"></a>🎯 核心洞察總結</h2><h3 id="1-架構設計的智慧"><a href="#1-架構設計的智慧" class="headerlink" title="1. 架構設計的智慧"></a>1. <strong>架構設計的智慧</strong></h3><p>Angular 19 的雙軌設計提供了：</p>
<ul>
<li><strong>關注點分離</strong>：客戶端與伺服器端各司其職</li>
<li><strong>配置合併</strong>：<code>mergeApplicationConfig</code> 統一管理</li>
<li><strong>彈性選擇</strong>：根據頁面特性選擇最適合的渲染模式</li>
</ul>
<h3 id="2-效能優化的關鍵"><a href="#2-效能優化的關鍵" class="headerlink" title="2. 效能優化的關鍵"></a>2. <strong>效能優化的關鍵</strong></h3><ul>
<li><strong>選擇性預渲染</strong>：不是所有頁面都需要 SSR</li>
<li><strong>程式碼分割</strong>：延遲載入與 SSR 完全兼容</li>
<li><strong>快取策略</strong>：靜態資源長期快取，HTML 短期快取</li>
</ul>
<h3 id="3-安全性的平衡"><a href="#3-安全性的平衡" class="headerlink" title="3. 安全性的平衡"></a>3. <strong>安全性的平衡</strong></h3><ul>
<li><strong>前端防護</strong>：僅為 UX 優化，不能依賴它保護敏感資料</li>
<li><strong>後端防線</strong>：真正的安全檢查必須在 API 層執行</li>
<li><strong>SSR 友善設計</strong>：守衛應該考慮伺服器端渲染環境</li>
</ul>
<h2 id="🚀-進階實踐建議"><a href="#🚀-進階實踐建議" class="headerlink" title="🚀 進階實踐建議"></a>🚀 進階實踐建議</h2><h3 id="大型專案策略"><a href="#大型專案策略" class="headerlink" title="大型專案策略"></a>大型專案策略</h3><ul>
<li><strong>微前端整合</strong>：不同模組可採用不同渲染策略</li>
<li><strong>CDN 優化</strong>：預渲染頁面部署到全球 CDN</li>
<li><strong>A&#x2F;B 測試</strong>：比較不同渲染模式的效果</li>
</ul>
<h3 id="監控與維護"><a href="#監控與維護" class="headerlink" title="監控與維護"></a>監控與維護</h3><ul>
<li><strong>Core Web Vitals</strong>：持續監控 FCP、LCP、CLS 指標</li>
<li><strong>建構時間</strong>：預渲染頁面數量與建構時間的平衡</li>
<li><strong>伺服器負載</strong>：動態渲染的伺服器資源消耗</li>
</ul>
<h2 id="📞-技術支援與參考資源"><a href="#📞-技術支援與參考資源" class="headerlink" title="📞 技術支援與參考資源"></a>📞 技術支援與參考資源</h2><h3 id="官方文件"><a href="#官方文件" class="headerlink" title="官方文件"></a>官方文件</h3><ul>
<li><a target="_blank" rel="noopener" href="https://angular.dev/guide/ssr">Angular SSR 官方指南</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/angular/universal">Angular Universal 文件</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.angular.io/">Angular 19 新功能</a></li>
</ul>
<h3 id="實用工具"><a href="#實用工具" class="headerlink" title="實用工具"></a>實用工具</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@angular-devkit/build-angular">Angular DevKit Build</a></li>
<li><a target="_blank" rel="noopener" href="https://angular.io/cli">Angular CLI</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/lighthouse-ci">Lighthouse CI</a></li>
</ul>
<h3 id="效能測試"><a href="#效能測試" class="headerlink" title="效能測試"></a>效能測試</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.webpagetest.org/">Web Page Test</a></li>
<li><a target="_blank" rel="noopener" href="https://pagespeed.web.dev/">PageSpeed Insights</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/devtools/">Chrome DevTools</a></li>
</ul>
<h3 id="相關範例"><a href="#相關範例" class="headerlink" title="相關範例"></a>相關範例</h3><ul>
<li>Angular SSR 官方範例專案</li>
<li>Enterprise Angular 架構指南</li>
<li>PWA + SSR 整合案例</li>
</ul>
<blockquote>
<p><strong>作者</strong>：Angular 架構團隊<br><strong>更新日期</strong>：2025年6月29日<br><strong>版本</strong>：v2.1<br><strong>適用範圍</strong>：Angular 19+ SSR&#x2F;Prerender 專案</p>
</blockquote>
<hr>
<p><em>此文件結合了技術原理、實務配置和效能考量，提供完整的 Angular SSR 實作指南。</em> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cookieseventeen.github.io/2025/06/29/angular-ssr-technical-analysis-guide/" data-id="cmg51yfqg0005anmz2lva7x20" data-title="Angular 19 SSR/Prerender 深度技術分析與實戰指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-19/" rel="tag">Angular 19</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular-Universal/" rel="tag">Angular Universal</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hydration/" rel="tag">Hydration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Performance-Optimization/" rel="tag">Performance Optimization</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Prerender/" rel="tag">Prerender</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RenderMode/" rel="tag">RenderMode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Route-Guards/" rel="tag">Route Guards</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SEO/" rel="tag">SEO</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSR/" rel="tag">SSR</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Server-Side-Rendering/" rel="tag">Server-Side Rendering</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-vue-frontend-architecture-patterns-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/29/vue-frontend-architecture-patterns-guide/" class="article-date">
  <time class="dt-published" datetime="2025-06-29T03:00:00.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech-Daily/">Tech Daily</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/29/vue-frontend-architecture-patterns-guide/">Vue.js 前端架構模式比較與選擇指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="📋-核心懶人包"><a href="#📋-核心懶人包" class="headerlink" title="📋 核心懶人包"></a>📋 核心懶人包</h2><ol>
<li><strong>全域屬性模式</strong>：快速開發，適合小型專案或即將 EOS 的系統</li>
<li><strong>服務注入模式</strong>：純業務邏輯處理，易於測試，重用性高</li>
<li><strong>Composables 模式</strong>：響應式邏輯復用，Vue 3 原生支援</li>
<li><strong>Store 模式</strong>：全域狀態管理，適合複雜應用程式狀態</li>
<li><strong>混合策略</strong>：依據功能特性選擇最適合的架構模式</li>
</ol>
<h2 id="🏗️-專案概述"><a href="#🏗️-專案概述" class="headerlink" title="🏗️ 專案概述"></a>🏗️ 專案概述</h2><p>本文記錄了在 Vue.js 專案中不同架構模式的比較分析，特別針對公用程式管理、狀態共享和業務邏輯組織方式進行深入探討：</p>
<ul>
<li>🎯 <strong>架構模式比較</strong>：四種主要前端架構模式的優缺點分析</li>
<li>🔧 <strong>實作策略</strong>：每種模式的具體實作方式和程式碼範例</li>
<li>📊 <strong>選擇指南</strong>：基於專案特性的架構選擇建議</li>
<li>🚀 <strong>最佳實踐</strong>：混合使用策略和重構建議</li>
<li>⚡ <strong>效能考量</strong>：不同模式對 Bundle 大小和效能的影響</li>
</ul>
<h2 id="🏗️-架構模式技術比較"><a href="#🏗️-架構模式技術比較" class="headerlink" title="🏗️ 架構模式技術比較"></a>🏗️ 架構模式技術比較</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[Vue.js 前端架構] --&gt; B[全域屬性注入]</span><br><span class="line">    A --&gt; C[服務注入模式]</span><br><span class="line">    A --&gt; D[Composables 模式]</span><br><span class="line">    A --&gt; E[Store 模式]</span><br><span class="line">    </span><br><span class="line">    B --&gt; B1[快速開發]</span><br><span class="line">    B --&gt; B2[統一管理]</span><br><span class="line">    B --&gt; B3[Bundle 較大]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1[純業務邏輯]</span><br><span class="line">    C --&gt; C2[易於測試]</span><br><span class="line">    C --&gt; C3[型別安全]</span><br><span class="line">    </span><br><span class="line">    D --&gt; D1[響應式狀態]</span><br><span class="line">    D --&gt; D2[邏輯復用]</span><br><span class="line">    D --&gt; D3[Vue 特定]</span><br><span class="line">    </span><br><span class="line">    E --&gt; E1[全域狀態]</span><br><span class="line">    E --&gt; E2[DevTools 支援]</span><br><span class="line">    E --&gt; E3[結構化管理]</span><br></pre></td></tr></table></figure>

<h2 id="📝-文件概述"><a href="#📝-文件概述" class="headerlink" title="📝 文件概述"></a>📝 文件概述</h2><p>本文記錄了在 Vue.js 專案中不同架構模式的比較分析，特別針對公用程式管理、狀態共享和業務邏輯組織方式進行深入探討。</p>
<h2 id="🏗️-架構模式比較"><a href="#🏗️-架構模式比較" class="headerlink" title="🏗️ 架構模式比較"></a>🏗️ 架構模式比較</h2><h3 id="1-全域屬性注入模式-Global-Properties-Injection"><a href="#1-全域屬性注入模式-Global-Properties-Injection" class="headerlink" title="1. 全域屬性注入模式 (Global Properties Injection)"></a>1. 全域屬性注入模式 (Global Properties Injection)</h3><h4 id="💡-概念"><a href="#💡-概念" class="headerlink" title="💡 概念"></a>💡 概念</h4><p>將所有工具函式和服務掛載到 Vue 應用程式的全域屬性上，讓所有組件都能直接存取。</p>
<h4 id="🔧-實作方式"><a href="#🔧-實作方式" class="headerlink" title="🔧 實作方式"></a>🔧 實作方式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Utils</span> <span class="keyword">from</span> <span class="string">&#x27;@/common/utils.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">ChartOptions</span> <span class="keyword">from</span> <span class="string">&#x27;@/common/chart_option.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> api <span class="keyword">from</span> <span class="string">&#x27;./api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$utils</span> = <span class="title class_">Utils</span>;</span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$api</span> = api;</span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$chartOption</span> = <span class="title class_">ChartOptions</span>;</span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$lodash</span> = lodash;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在組件中使用</span></span><br><span class="line"><span class="keyword">const</span> curInstance = <span class="title function_">getCurrentInstance</span>();</span><br><span class="line"><span class="keyword">const</span> api = curInstance.<span class="property">appContext</span>.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$api</span>;</span><br><span class="line"><span class="keyword">const</span> utils = curInstance.<span class="property">appContext</span>.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$utils</span>;</span><br></pre></td></tr></table></figure>

<h4 id="✅-優點"><a href="#✅-優點" class="headerlink" title="✅ 優點"></a>✅ 優點</h4><ul>
<li><strong>快速開發</strong>：不需要反覆匯入，直接使用</li>
<li><strong>統一管理</strong>：所有公用程式都在 main.js 中註冊</li>
<li><strong>團隊協作</strong>：新成員容易上手，使用方式一致</li>
<li><strong>向後相容</strong>：適合既有專案的漸進式升級</li>
</ul>
<h4 id="❌-缺點"><a href="#❌-缺點" class="headerlink" title="❌ 缺點"></a>❌ 缺點</h4><ul>
<li><strong>Bundle 肥大</strong>：所有工具都會被打包，即使未使用</li>
<li><strong>依賴不明確</strong>：難以追蹤組件真正使用的依賴</li>
<li><strong>測試困難</strong>：全域依賴較難進行單元測試</li>
<li><strong>型別推斷弱</strong>：TypeScript 支援有限</li>
</ul>
<h4 id="🎯-適用場景"><a href="#🎯-適用場景" class="headerlink" title="🎯 適用場景"></a>🎯 適用場景</h4><ul>
<li><strong>即將 EOS 的專案</strong>：不適合大規模重構</li>
<li><strong>快速原型開發</strong>：需要快速驗證功能</li>
<li><strong>小型專案</strong>：團隊規模小，複雜度低</li>
</ul>
<hr>
<h3 id="2-服務注入模式-Service-Injection"><a href="#2-服務注入模式-Service-Injection" class="headerlink" title="2. 服務注入模式 (Service Injection)"></a>2. 服務注入模式 (Service Injection)</h3><h4 id="💡-概念-1"><a href="#💡-概念-1" class="headerlink" title="💡 概念"></a>💡 概念</h4><p>將業務邏輯封裝成獨立的服務類別，按需匯入使用，專注於純業務邏輯處理。</p>
<h4 id="🔧-實作方式-1"><a href="#🔧-實作方式-1" class="headerlink" title="🔧 實作方式"></a>🔧 實作方式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// services/ExcelService.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExcelService</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">exportExcel</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            data = [],</span><br><span class="line">            headers = [],</span><br><span class="line">            filename = <span class="string">&#x27;export&#x27;</span>,</span><br><span class="line">            sheetName = <span class="string">&#x27;Sheet1&#x27;</span>,</span><br><span class="line">            style = &#123;&#125;,</span><br><span class="line">            includeTimestamp = <span class="literal">true</span></span><br><span class="line">        &#125; = options;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> worksheet = <span class="variable language_">this</span>.<span class="title function_">_createWorksheet</span>(data, headers);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">_applyStyle</span>(worksheet, style);</span><br><span class="line">            <span class="keyword">const</span> buffer = <span class="variable language_">this</span>.<span class="title function_">_generateFile</span>(worksheet, sheetName);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">_downloadFile</span>(buffer, filename, includeTimestamp);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="attr">success</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Excel 匯出失敗:&#x27;</span>, error);</span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="attr">success</span>: <span class="literal">false</span>, error &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 私有方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">_createWorksheet</span>(<span class="params">data, headers</span>) &#123; <span class="comment">/* 實作邏輯 */</span> &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">_applyStyle</span>(<span class="params">worksheet, style</span>) &#123; <span class="comment">/* 實作邏輯 */</span> &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">_generateFile</span>(<span class="params">worksheet, sheetName</span>) &#123; <span class="comment">/* 實作邏輯 */</span> &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">_downloadFile</span>(<span class="params">buffer, filename, includeTimestamp</span>) &#123; <span class="comment">/* 實作邏輯 */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ExcelService</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在組件中使用</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ExcelService</span> <span class="keyword">from</span> <span class="string">&#x27;@/services/ExcelService.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">exportData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title class_">ExcelService</span>.<span class="title function_">exportExcel</span>(&#123;</span><br><span class="line">        <span class="attr">data</span>: tableData.<span class="property">value</span>,</span><br><span class="line">        <span class="attr">headers</span>: columnHeaders,</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;設備清單&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="✅-優點-1"><a href="#✅-優點-1" class="headerlink" title="✅ 優點"></a>✅ 優點</h4><ul>
<li><strong>易於測試</strong>：純業務邏輯，易於單元測試</li>
<li><strong>重用性高</strong>：可在任何環境使用，不限於 Vue</li>
<li><strong>型別安全</strong>：完整的 TypeScript 支援</li>
<li><strong>按需載入</strong>：只載入真正需要的功能</li>
<li><strong>依賴明確</strong>：清楚知道組件使用哪些服務</li>
</ul>
<h4 id="❌-缺點-1"><a href="#❌-缺點-1" class="headerlink" title="❌ 缺點"></a>❌ 缺點</h4><ul>
<li><strong>學習成本</strong>：需要理解服務模式的概念</li>
<li><strong>初期投入</strong>：需要設計服務介面和架構</li>
<li><strong>依賴注入</strong>：需要手動管理依賴關係</li>
</ul>
<h4 id="🎯-適用場景-1"><a href="#🎯-適用場景-1" class="headerlink" title="🎯 適用場景"></a>🎯 適用場景</h4><ul>
<li><strong>純業務邏輯</strong>：如資料處理、檔案匯出、API 呼叫</li>
<li><strong>需要測試</strong>：重要的業務功能需要完整測試</li>
<li><strong>跨平台使用</strong>：邏輯可能在不同環境中重複使用</li>
</ul>
<hr>
<h3 id="3-Composables-模式-Vue-3-Composition-API"><a href="#3-Composables-模式-Vue-3-Composition-API" class="headerlink" title="3. Composables 模式 (Vue 3 Composition API)"></a>3. Composables 模式 (Vue 3 Composition API)</h3><h4 id="💡-概念-2"><a href="#💡-概念-2" class="headerlink" title="💡 概念"></a>💡 概念</h4><p>使用 Vue 3 的 Composition API 建立可重複使用的響應式邏輯，專注於狀態管理和 Vue 特定功能。</p>
<h4 id="🔧-實作方式-2"><a href="#🔧-實作方式-2" class="headerlink" title="🔧 實作方式"></a>🔧 實作方式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// composables/useCounter.js</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>) <span class="comment">// 模組級別共享狀態</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useCounter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> doubleCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">        count.<span class="property">value</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">reset</span>(<span class="params"></span>) &#123;</span><br><span class="line">        count.<span class="property">value</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; </span><br><span class="line">        <span class="attr">count</span>: <span class="title function_">readonly</span>(count), </span><br><span class="line">        doubleCount, </span><br><span class="line">        increment, </span><br><span class="line">        reset </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// composables/useApi.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useApi</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> loading = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> error = <span class="title function_">ref</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="title function_">ref</span>(<span class="literal">null</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">url</span>) &#123;</span><br><span class="line">        loading.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">        error.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br><span class="line">            data.<span class="property">value</span> = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            error.<span class="property">value</span> = e.<span class="property">message</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            loading.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; data, loading, error, fetchData &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在組件中使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; useCounter &#125; <span class="keyword">from</span> <span class="string">&#x27;@/composables/useCounter&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useApi &#125; <span class="keyword">from</span> <span class="string">&#x27;@/composables/useApi&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; count, increment &#125; = <span class="title function_">useCounter</span>();</span><br><span class="line">        <span class="keyword">const</span> &#123; data, loading, fetchData &#125; = <span class="title function_">useApi</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123; count, increment, data, loading, fetchData &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="✅-優點-2"><a href="#✅-優點-2" class="headerlink" title="✅ 優點"></a>✅ 優點</h4><ul>
<li><strong>響應式狀態</strong>：自動追蹤狀態變化，無需手動更新</li>
<li><strong>生命週期整合</strong>：可以使用 Vue 的生命週期鉤子</li>
<li><strong>邏輯複用</strong>：在多個組件間共享相同邏輯</li>
<li><strong>型別推斷</strong>：優秀的 TypeScript 支援</li>
<li><strong>組合能力</strong>：可以輕鬆組合多個 Composables</li>
</ul>
<h4 id="❌-缺點-2"><a href="#❌-缺點-2" class="headerlink" title="❌ 缺點"></a>❌ 缺點</h4><ul>
<li><strong>學習曲線</strong>：需要理解 Composition API 概念</li>
<li><strong>Vue 限定</strong>：只能在 Vue 環境中使用</li>
<li><strong>測試複雜</strong>：需要 mock Vue 實例和響應式系統</li>
<li><strong>狀態管理</strong>：複雜狀態管理不如專門的 Store</li>
</ul>
<h4 id="🎯-適用場景-2"><a href="#🎯-適用場景-2" class="headerlink" title="🎯 適用場景"></a>🎯 適用場景</h4><ul>
<li><strong>響應式狀態管理</strong>：需要追蹤狀態變化的邏輯</li>
<li><strong>Vue 特定功能</strong>：使用 Vue 生命週期、響應式 API</li>
<li><strong>組件間邏輯共享</strong>：多個組件需要相同的響應式邏輯</li>
</ul>
<hr>
<h2 id="🛒-狀態管理比較：Store-vs-Composables"><a href="#🛒-狀態管理比較：Store-vs-Composables" class="headerlink" title="🛒 狀態管理比較：Store vs Composables"></a>🛒 狀態管理比較：Store vs Composables</h2><h3 id="Store-Pinia-Vuex-模式"><a href="#Store-Pinia-Vuex-模式" class="headerlink" title="Store (Pinia&#x2F;Vuex) 模式"></a>Store (Pinia&#x2F;Vuex) 模式</h3><h4 id="🔧-實作方式-3"><a href="#🔧-實作方式-3" class="headerlink" title="🔧 實作方式"></a>🔧 實作方式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stores/user.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> currentUser = <span class="title function_">ref</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">const</span> token = <span class="title function_">ref</span>(<span class="variable language_">sessionStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;TOKEN&#x27;</span>));</span><br><span class="line">    <span class="keyword">const</span> permissions = <span class="title function_">ref</span>([]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">credentials</span>) &#123;</span><br><span class="line">        <span class="comment">// 登入邏輯</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> api.<span class="title function_">login</span>(credentials);</span><br><span class="line">        currentUser.<span class="property">value</span> = response.<span class="property">user</span>;</span><br><span class="line">        token.<span class="property">value</span> = response.<span class="property">token</span>;</span><br><span class="line">        <span class="variable language_">sessionStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;TOKEN&#x27;</span>, response.<span class="property">token</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">        currentUser.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">        token.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">        permissions.<span class="property">value</span> = [];</span><br><span class="line">        <span class="variable language_">sessionStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;TOKEN&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; currentUser, token, permissions, login, logout &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="特點"><a href="#特點" class="headerlink" title="特點"></a>特點</h4><ul>
<li><strong>全域狀態管理</strong>：應用程式級別的狀態</li>
<li><strong>DevTools 支援</strong>：完整的開發者工具整合</li>
<li><strong>持久化</strong>：易於整合狀態持久化</li>
<li><strong>結構化</strong>：強制統一的狀態管理結構</li>
</ul>
<h3 id="Composables-狀態共享"><a href="#Composables-狀態共享" class="headerlink" title="Composables 狀態共享"></a>Composables 狀態共享</h3><h4 id="🔧-實作方式-4"><a href="#🔧-實作方式-4" class="headerlink" title="🔧 實作方式"></a>🔧 實作方式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// composables/useGlobalNotifications.js</span></span><br><span class="line"><span class="keyword">const</span> notifications = <span class="title function_">ref</span>([]); <span class="comment">// 模組級別 = 全域共享</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useGlobalNotifications</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> unreadCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> </span><br><span class="line">        notifications.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">n</span> =&gt;</span> !n.<span class="property">read</span>).<span class="property">length</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">addNotification</span>(<span class="params">message</span>) &#123;</span><br><span class="line">        notifications.<span class="property">value</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">            message,</span><br><span class="line">            <span class="attr">read</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">timestamp</span>: <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">markAsRead</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> notification = notifications.<span class="property">value</span>.<span class="title function_">find</span>(<span class="function"><span class="params">n</span> =&gt;</span> n.<span class="property">id</span> === id);</span><br><span class="line">        <span class="keyword">if</span> (notification) notification.<span class="property">read</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">notifications</span>: <span class="title function_">readonly</span>(notifications),</span><br><span class="line">        unreadCount,</span><br><span class="line">        addNotification,</span><br><span class="line">        markAsRead</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="特點-1"><a href="#特點-1" class="headerlink" title="特點"></a>特點</h4><ul>
<li><strong>靈活性高</strong>：可以選擇全域或區域共享</li>
<li><strong>輕量級</strong>：不需要額外的狀態管理函式庫</li>
<li><strong>組合能力</strong>：可以輕鬆組合多個狀態邏輯</li>
</ul>
<hr>
<h2 id="📊-選擇指南對照表"><a href="#📊-選擇指南對照表" class="headerlink" title="📊 選擇指南對照表"></a>📊 選擇指南對照表</h2><table>
<thead>
<tr>
<th>功能類型</th>
<th>全域屬性模式</th>
<th>服務模式</th>
<th>Composables 模式</th>
<th>Store 模式</th>
</tr>
</thead>
<tbody><tr>
<td><strong>純業務邏輯</strong></td>
<td>⭐⭐⭐</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐</td>
<td>⭐⭐</td>
</tr>
<tr>
<td><strong>工具函式</strong></td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
<td>⭐⭐</td>
<td>⭐</td>
</tr>
<tr>
<td><strong>響應式狀態</strong></td>
<td>⭐⭐</td>
<td>⭐</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><strong>全域狀態</strong></td>
<td>⭐⭐⭐</td>
<td>⭐</td>
<td>⭐⭐⭐</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
<tr>
<td><strong>測試能力</strong></td>
<td>⭐⭐</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><strong>學習成本</strong></td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐</td>
<td>⭐⭐</td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><strong>開發速度</strong></td>
<td>⭐⭐⭐⭐⭐</td>
<td>⭐⭐⭐</td>
<td>⭐⭐⭐</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<h2 id="🎯-實際應用案例：Excel-匯出功能"><a href="#🎯-實際應用案例：Excel-匯出功能" class="headerlink" title="🎯 實際應用案例：Excel 匯出功能"></a>🎯 實際應用案例：Excel 匯出功能</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><p>Excel 匯出功能具有以下特性：</p>
<ul>
<li><strong>純業務邏輯</strong>：不涉及響應式狀態</li>
<li><strong>工具性質</strong>：提供資料處理和檔案產生功能</li>
<li><strong>可重複使用</strong>：多個頁面都可能需要匯出功能</li>
</ul>
<h3 id="推薦方案：Service-模式"><a href="#推薦方案：Service-模式" class="headerlink" title="推薦方案：Service 模式"></a>推薦方案：Service 模式</h3><h4 id="理由"><a href="#理由" class="headerlink" title="理由"></a>理由</h4><ol>
<li><strong>純業務邏輯</strong>：Excel 處理不需要響應式狀態</li>
<li><strong>易於測試</strong>：可以獨立測試匯出邏輯</li>
<li><strong>跨平台重用</strong>：未來可能在其他專案中使用</li>
<li><strong>依賴明確</strong>：清楚知道需要哪些 XLSX 功能</li>
</ol>
<h4 id="實作策略"><a href="#實作策略" class="headerlink" title="實作策略"></a>實作策略</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// services/ExcelService.js - 純業務邏輯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExcelService</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">exportExcel</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="comment">// 核心匯出邏輯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// utils.js - 提供便捷介面</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">exportExcel</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">ExcelService</span>.<span class="title function_">exportExcel</span>(&#123;</span><br><span class="line">        ...options,</span><br><span class="line">        <span class="attr">formatUtils</span>: format  <span class="comment">// 注入專案特定依賴</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 組件中使用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">export_data_excel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = utils.<span class="title function_">exportExcel</span>(&#123;</span><br><span class="line">        <span class="attr">data</span>: tableData.<span class="property">value</span>,</span><br><span class="line">        <span class="attr">headers</span>: columnHeaders,</span><br><span class="line">        <span class="attr">filename</span>: <span class="title function_">t</span>(<span class="string">&#x27;EXPORT_FILENAME&#x27;</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🔄-Vue-3-推出-Composables-的背景"><a href="#🔄-Vue-3-推出-Composables-的背景" class="headerlink" title="🔄 Vue 3 推出 Composables 的背景"></a>🔄 Vue 3 推出 Composables 的背景</h2><h3 id="解決的問題"><a href="#解決的問題" class="headerlink" title="解決的問題"></a>解決的問題</h3><h4 id="1-Vue-2-Mixins-的痛點"><a href="#1-Vue-2-Mixins-的痛點" class="headerlink" title="1. Vue 2 Mixins 的痛點"></a>1. Vue 2 Mixins 的痛點</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vue 2 - 問題範例</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">mixins</span>: [counterMixin, apiMixin], <span class="comment">// 命名衝突、來源不明</span></span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// 不知道 count 來自哪個 mixin</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 3 - 解決方案</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; count &#125; = <span class="title function_">useCounter</span>();  <span class="comment">// 明確來源</span></span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = <span class="title function_">useApi</span>();       <span class="comment">// 無命名衝突</span></span><br><span class="line">        <span class="keyword">return</span> &#123; count, data &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-邏輯復用困難"><a href="#2-邏輯復用困難" class="headerlink" title="2. 邏輯復用困難"></a>2. 邏輯復用困難</h4><p>Vue 2 中跨組件共享邏輯很困難，Composables 提供了優雅的解決方案。</p>
<h4 id="3-TypeScript-支援不足"><a href="#3-TypeScript-支援不足" class="headerlink" title="3. TypeScript 支援不足"></a>3. TypeScript 支援不足</h4><p>Composables 提供完整的型別推斷和型別安全。</p>
<h3 id="設計哲學"><a href="#設計哲學" class="headerlink" title="設計哲學"></a>設計哲學</h3><p>Composables <strong>不是要取代 Service</strong>，而是補充 Vue 生態系統中<strong>狀態管理和邏輯復用</strong>的能力。</p>
<hr>
<h2 id="🏛️-架構演進建議"><a href="#🏛️-架構演進建議" class="headerlink" title="🏛️ 架構演進建議"></a>🏛️ 架構演進建議</h2><h3 id="對於-EOS-專案"><a href="#對於-EOS-專案" class="headerlink" title="對於 EOS 專案"></a>對於 EOS 專案</h3><ol>
<li><strong>保持現有架構</strong>：不進行大規模重構</li>
<li><strong>新功能使用 Service</strong>：如 Excel 匯出等純業務邏輯</li>
<li><strong>逐步優化</strong>：針對高使用率功能進行局部優化</li>
</ol>
<h3 id="對於新專案"><a href="#對於新專案" class="headerlink" title="對於新專案"></a>對於新專案</h3><ol>
<li><p><strong>混合使用策略</strong>：</p>
<ul>
<li><strong>工具函式</strong>：Service 模式</li>
<li><strong>響應式邏輯</strong>：Composables 模式</li>
<li><strong>全域狀態</strong>：Store 模式</li>
<li><strong>API 呼叫</strong>：Service + Composables 組合</li>
</ul>
</li>
<li><p><strong>分層架構</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Components (組件層)</span><br><span class="line">     ↓</span><br><span class="line">Composables (邏輯復用層)</span><br><span class="line">     ↓</span><br><span class="line">Services (業務邏輯層)</span><br><span class="line">     ↓</span><br><span class="line">Utils (工具函式層)</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="📝-最佳實踐總結"><a href="#📝-最佳實踐總結" class="headerlink" title="📝 最佳實踐總結"></a>📝 最佳實踐總結</h2><h3 id="1-選擇原則"><a href="#1-選擇原則" class="headerlink" title="1. 選擇原則"></a>1. 選擇原則</h3><ul>
<li><strong>狀態性質</strong>：有狀態選 Composables&#x2F;Store，無狀態選 Service</li>
<li><strong>專案階段</strong>：新專案靈活選擇，既有專案漸進式改進</li>
<li><strong>團隊能力</strong>：考慮團隊對新技術的接受度和學習成本</li>
</ul>
<h3 id="2-混合使用策略"><a href="#2-混合使用策略" class="headerlink" title="2. 混合使用策略"></a>2. 混合使用策略</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 典型組件架構</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 全域狀態</span></span><br><span class="line">        <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 響應式邏輯</span></span><br><span class="line">        <span class="keyword">const</span> &#123; filters, updateFilter &#125; = <span class="title function_">useTableFilters</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 業務服務</span></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">exportData</span> = (<span class="params"></span>) =&gt; <span class="title class_">ExcelService</span>.<span class="title function_">exportExcel</span>(&#123;...&#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 工具函式</span></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">formatDate</span> = (<span class="params">date</span>) =&gt; utils.<span class="title function_">format</span>(date, <span class="string">&#x27;yyyy-MM-dd&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">user</span>: userStore.<span class="property">currentUser</span>,</span><br><span class="line">            filters,</span><br><span class="line">            updateFilter,</span><br><span class="line">            exportData,</span><br><span class="line">            formatDate</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-重構策略"><a href="#3-重構策略" class="headerlink" title="3. 重構策略"></a>3. 重構策略</h3><ul>
<li><strong>階段式遷移</strong>：優先重構高使用率、高維護成本的功能</li>
<li><strong>向後相容</strong>：保持既有 API 不變，內部實作漸進式改進</li>
<li><strong>測試驅動</strong>：重要功能先寫測試，再進行重構</li>
</ul>
<hr>
<h2 id="🔗-參考資源"><a href="#🔗-參考資源" class="headerlink" title="🔗 參考資源"></a>🔗 參考資源</h2><ul>
<li><a target="_blank" rel="noopener" href="https://vuejs.org/api/composition-api-setup.html">Vue 3 Composition API 官方文件</a></li>
<li><a target="_blank" rel="noopener" href="https://pinia.vuejs.org/">Pinia 狀態管理</a></li>
<li><a target="_blank" rel="noopener" href="https://vuejs.org/guide/typescript/overview.html">TypeScript 與 Vue 3</a></li>
<li><a target="_blank" rel="noopener" href="https://vuejs.org/guide/reusability/composables.html">Vue 3 設計模式最佳實踐</a></li>
</ul>
<h2 id="💡-實戰決策流程圖"><a href="#💡-實戰決策流程圖" class="headerlink" title="💡 實戰決策流程圖"></a>💡 實戰決策流程圖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[新功能需求] --&gt; B&#123;是否需要狀態管理?&#125;</span><br><span class="line">    B --&gt;|是| C&#123;全域還是局部狀態?&#125;</span><br><span class="line">    B --&gt;|否| D&#123;是否為純業務邏輯?&#125;</span><br><span class="line">    </span><br><span class="line">    C --&gt;|全域| E[Store 模式]</span><br><span class="line">    C --&gt;|局部| F[Composables 模式]</span><br><span class="line">    </span><br><span class="line">    D --&gt;|是| G[Service 模式]</span><br><span class="line">    D --&gt;|否| H&#123;是否為工具函式?&#125;</span><br><span class="line">    </span><br><span class="line">    H --&gt;|是| I&#123;專案規模?&#125;</span><br><span class="line">    H --&gt;|否| J[考慮重新分析需求]</span><br><span class="line">    </span><br><span class="line">    I --&gt;|大型/新專案| G</span><br><span class="line">    I --&gt;|小型/EOS專案| K[全域屬性模式]</span><br><span class="line">    </span><br><span class="line">    E --&gt; L[實作方案]</span><br><span class="line">    F --&gt; L</span><br><span class="line">    G --&gt; L</span><br><span class="line">    K --&gt; L</span><br></pre></td></tr></table></figure>

<h2 id="🎯-核心洞察總結"><a href="#🎯-核心洞察總結" class="headerlink" title="🎯 核心洞察總結"></a>🎯 核心洞察總結</h2><h3 id="1-架構選擇的關鍵因素"><a href="#1-架構選擇的關鍵因素" class="headerlink" title="1. 架構選擇的關鍵因素"></a>1. <strong>架構選擇的關鍵因素</strong></h3><ul>
<li><strong>專案生命週期</strong>：新專案靈活選擇，既有專案考慮維護成本</li>
<li><strong>團隊技能</strong>：考慮團隊對新技術的接受度和學習曲線</li>
<li><strong>功能特性</strong>：依據狀態性質、業務複雜度選擇合適模式</li>
</ul>
<h3 id="2-混合策略的威力"><a href="#2-混合策略的威力" class="headerlink" title="2. 混合策略的威力"></a>2. <strong>混合策略的威力</strong></h3><p>不同架構模式各有優勢，智慧的組合使用能發揮最大效益：</p>
<ul>
<li><strong>工具函式</strong>：Service 模式提供最佳的測試性和重用性</li>
<li><strong>響應式邏輯</strong>：Composables 模式發揮 Vue 3 的優勢</li>
<li><strong>全域狀態</strong>：Store 模式提供結構化的狀態管理</li>
<li><strong>既有系統</strong>：全域屬性模式確保穩定性</li>
</ul>
<h3 id="3-效能與開發體驗的平衡"><a href="#3-效能與開發體驗的平衡" class="headerlink" title="3. 效能與開發體驗的平衡"></a>3. <strong>效能與開發體驗的平衡</strong></h3><ul>
<li><strong>開發速度 vs 長期維護</strong>：短期開發效率與長期維護成本的權衡</li>
<li><strong>Bundle 大小 vs 開發便利性</strong>：按需載入與全域注入的取捨</li>
<li><strong>型別安全 vs 學習成本</strong>：TypeScript 支援與團隊學習投入</li>
</ul>
<h2 id="📞-技術支援與參考資源"><a href="#📞-技術支援與參考資源" class="headerlink" title="📞 技術支援與參考資源"></a>📞 技術支援與參考資源</h2><h3 id="官方文件"><a href="#官方文件" class="headerlink" title="官方文件"></a>官方文件</h3><ul>
<li><a target="_blank" rel="noopener" href="https://vuejs.org/api/composition-api-setup.html">Vue 3 Composition API 官方文件</a></li>
<li><a target="_blank" rel="noopener" href="https://pinia.vuejs.org/">Pinia 狀態管理</a></li>
<li><a target="_blank" rel="noopener" href="https://vuejs.org/guide/typescript/overview.html">TypeScript 與 Vue 3</a></li>
<li><a target="_blank" rel="noopener" href="https://vuejs.org/guide/reusability/composables.html">Vue 3 設計模式最佳實踐</a></li>
</ul>
<h3 id="實踐案例"><a href="#實踐案例" class="headerlink" title="實踐案例"></a>實踐案例</h3><ul>
<li>Vue.js 官方範例專案</li>
<li>Composition API RFC 討論</li>
<li>Vue 3 遷移指南</li>
</ul>
<h3 id="相關工具"><a href="#相關工具" class="headerlink" title="相關工具"></a>相關工具</h3><ul>
<li>Vue DevTools 3.0+</li>
<li>TypeScript</li>
<li>ESLint Vue Plugin</li>
<li>Vite 建構工具</li>
</ul>
<blockquote>
<p><strong>作者</strong>：前端架構團隊<br><strong>更新日期</strong>：2025年6月29日<br><strong>版本</strong>：v1.1<br><strong>適用範圍</strong>：Vue 3 + Composition API 專案</p>
</blockquote>
<hr>
<p><em>本文件為前端架構決策提供系統性的分析和建議，幫助團隊選擇最適合的技術方案。</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cookieseventeen.github.io/2025/06/29/vue-frontend-architecture-patterns-guide/" data-id="cmg51yfqj000lanmz8g9b4ugm" data-title="Vue.js 前端架構模式比較與選擇指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Best-Practices/" rel="tag">Best Practices</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Composables/" rel="tag">Composables</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Composition-API/" rel="tag">Composition API</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Design-Patterns/" rel="tag">Design Patterns</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Frontend-Architecture/" rel="tag">Frontend Architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Global-Properties/" rel="tag">Global Properties</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pinia/" rel="tag">Pinia</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Service-Pattern/" rel="tag">Service Pattern</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/State-Management/" rel="tag">State Management</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue-js/" rel="tag">Vue.js</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-mapbox-data-visualization-guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/06/29/mapbox-data-visualization-guide/" class="article-date">
  <time class="dt-published" datetime="2025-06-29T02:00:00.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech-Daily/">Tech Daily</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/06/29/mapbox-data-visualization-guide/">Mapbox 地圖資料視覺化技術分析與應用指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="📋-核心懶人包"><a href="#📋-核心懶人包" class="headerlink" title="📋 核心懶人包"></a>📋 核心懶人包</h2><ol>
<li><strong>智能圖層控制</strong>：選擇性隱藏地圖元素，建立專注的視覺環境</li>
<li><strong>Canvas 圖案生成</strong>：動態產生填充圖案，不依賴外部資源</li>
<li><strong>GeoJSON 資料整合</strong>：載入世界陸地邊界，展示地理資料應用</li>
<li><strong>叢集視覺化</strong>：將大量點資料智能分組，提升視覺清晰度</li>
<li><strong>互動體驗設計</strong>：整合地理編碼 API，提供豐富的使用者體驗</li>
</ol>
<h2 id="🗺️-專案概述"><a href="#🗺️-專案概述" class="headerlink" title="🗺️ 專案概述"></a>🗺️ 專案概述</h2><p>本專案展示了 Mapbox GL JS 在地理資料視覺化方面的強大功能：</p>
<ul>
<li>🎯 <strong>圖層控制技術</strong>：精確管理地圖顯示內容</li>
<li>🎨 <strong>自訂視覺圖案</strong>：使用 Canvas API 動態生成填充圖案</li>
<li>📊 <strong>資料叢集化</strong>：將大量點資料進行智能分組顯示</li>
<li>🌍 <strong>地理資料整合</strong>：載入並展示世界陸地邊界資料</li>
<li>⚡ <strong>互動體驗</strong>：豐富的點擊、懸停與縮放功能</li>
</ul>
<h2 id="🏗️-核心技術架構"><a href="#🏗️-核心技術架構" class="headerlink" title="🏗️ 核心技術架構"></a>🏗️ 核心技術架構</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[Mapbox GL JS 地圖] --&gt; B[圖層控制]</span><br><span class="line">    A --&gt; C[Canvas 圖案生成]</span><br><span class="line">    A --&gt; D[GeoJSON 資料載入]</span><br><span class="line">    A --&gt; E[叢集處理]</span><br><span class="line">    </span><br><span class="line">    B --&gt; B1[隱藏內建圖層]</span><br><span class="line">    C --&gt; C1[動態點狀圖案]</span><br><span class="line">    D --&gt; D1[世界陸地邊界]</span><br><span class="line">    D --&gt; D2[容錯處理機制]</span><br><span class="line">    E --&gt; E1[地震資料叢集]</span><br><span class="line">    E --&gt; E2[視覺化呈現]</span><br></pre></td></tr></table></figure>

<h2 id="🎛️-地圖圖層控制技術"><a href="#🎛️-地圖圖層控制技術" class="headerlink" title="🎛️ 地圖圖層控制技術"></a>🎛️ 地圖圖層控制技術</h2><h3 id="技術原理"><a href="#技術原理" class="headerlink" title="技術原理"></a>技術原理</h3><p>Mapbox 底圖包含許多預設圖層，在特定應用場景中可能造成視覺干擾。通過圖層控制技術，我們可以建立更專注的視覺環境。</p>
<h3 id="實作方式"><a href="#實作方式" class="headerlink" title="實作方式"></a>實作方式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定義需要隱藏的圖層清單</span></span><br><span class="line"><span class="keyword">const</span> layersToHide = [</span><br><span class="line">  <span class="string">&#x27;country-label&#x27;</span>,      <span class="comment">// 國家標籤</span></span><br><span class="line">  <span class="string">&#x27;state-label&#x27;</span>,        <span class="comment">// 州/省標籤</span></span><br><span class="line">  <span class="string">&#x27;settlement-label&#x27;</span>,   <span class="comment">// 城市標籤</span></span><br><span class="line">  <span class="string">&#x27;road-primary&#x27;</span>,       <span class="comment">// 主要道路</span></span><br><span class="line">  <span class="string">&#x27;building&#x27;</span>,           <span class="comment">// 建築物</span></span><br><span class="line">  <span class="string">&#x27;water&#x27;</span>,              <span class="comment">// 水體</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 批次隱藏圖層</span></span><br><span class="line">layersToHide.<span class="title function_">forEach</span>(<span class="function"><span class="params">layerId</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (map.<span class="title function_">getLayer</span>(layerId)) &#123;</span><br><span class="line">    map.<span class="title function_">setLayoutProperty</span>(layerId, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;none&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="技術優勢"><a href="#技術優勢" class="headerlink" title="技術優勢"></a>技術優勢</h3><ul>
<li>✅ <strong>效能優化</strong>：減少不必要的渲染負擔</li>
<li>✅ <strong>視覺聚焦</strong>：突出重要的資料內容</li>
<li>✅ <strong>彈性控制</strong>：可根據需求動態調整顯示內容</li>
</ul>
<h2 id="🎨-Canvas-動態圖案生成"><a href="#🎨-Canvas-動態圖案生成" class="headerlink" title="🎨 Canvas 動態圖案生成"></a>🎨 Canvas 動態圖案生成</h2><h3 id="為什麼使用-Canvas？"><a href="#為什麼使用-Canvas？" class="headerlink" title="為什麼使用 Canvas？"></a>為什麼使用 Canvas？</h3><p>傳統填充圖案需要外部圖片檔案，而 Canvas 技術讓我們能夠：</p>
<ol>
<li><strong>即時生成</strong>：不依賴外部資源</li>
<li><strong>完全客製化</strong>：精確控制每個像素</li>
<li><strong>動態變化</strong>：可以加入隨機元素增加視覺豐富性</li>
</ol>
<h3 id="核心實作"><a href="#核心實作" class="headerlink" title="核心實作"></a>核心實作</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建立 Canvas 畫布</span></span><br><span class="line"><span class="keyword">const</span> size = <span class="number">64</span>;</span><br><span class="line"><span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">canvas.<span class="property">width</span> = size;</span><br><span class="line">canvas.<span class="property">height</span> = size;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 設定點狀圖案參數</span></span><br><span class="line"><span class="keyword">const</span> dotSize = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> spacing = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用巢狀迴圈繪製點陣圖案</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x = <span class="number">2</span>; x &lt; size - <span class="number">2</span>; x += spacing) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> y = <span class="number">2</span>; y &lt; size - <span class="number">2</span>; y += spacing) &#123;</span><br><span class="line">    <span class="comment">// 隨機化視覺效果</span></span><br><span class="line">    <span class="keyword">const</span> randomSize = dotSize + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">1.5</span>;</span><br><span class="line">    <span class="keyword">const</span> grayValue = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">80</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">60</span>);</span><br><span class="line">    <span class="keyword">const</span> alpha = <span class="number">0.4</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">0.4</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 繪製單個點</span></span><br><span class="line">    ctx.<span class="property">fillStyle</span> = <span class="string">`rgba(<span class="subst">$&#123;grayValue&#125;</span>, <span class="subst">$&#123;grayValue&#125;</span>, <span class="subst">$&#123;grayValue&#125;</span>, <span class="subst">$&#123;alpha&#125;</span>)`</span>;</span><br><span class="line">    ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">    ctx.<span class="title function_">arc</span>(x, y, randomSize/<span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">    ctx.<span class="title function_">fill</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 將 Canvas 內容註冊為地圖圖案</span></span><br><span class="line"><span class="keyword">const</span> imageData = ctx.<span class="title function_">getImageData</span>(<span class="number">0</span>, <span class="number">0</span>, size, size);</span><br><span class="line">map.<span class="title function_">addImage</span>(<span class="string">&#x27;custom-dots-pattern&#x27;</span>, imageData);</span><br></pre></td></tr></table></figure>

<h2 id="🌍-GeoJSON-資料載入與應用"><a href="#🌍-GeoJSON-資料載入與應用" class="headerlink" title="🌍 GeoJSON 資料載入與應用"></a>🌍 GeoJSON 資料載入與應用</h2><h3 id="什麼是-GeoJSON？"><a href="#什麼是-GeoJSON？" class="headerlink" title="什麼是 GeoJSON？"></a>什麼是 GeoJSON？</h3><p>GeoJSON 是一種基於 JSON 的地理資料交換格式，支援點、線、多邊形等地理要素。</p>
<h3 id="完整實作流程"><a href="#完整實作流程" class="headerlink" title="完整實作流程"></a>完整實作流程</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 步驟 1: 從遠端載入 GeoJSON 資料</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 步驟 2: 將資料註冊為地圖資料來源</span></span><br><span class="line">    map.<span class="title function_">addSource</span>(<span class="string">&#x27;world-land&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;geojson&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: data</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 步驟 3: 建立視覺圖層並套用自訂圖案</span></span><br><span class="line">    map.<span class="title function_">addLayer</span>(&#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">&#x27;land-dots&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;fill&#x27;</span>,</span><br><span class="line">      <span class="attr">source</span>: <span class="string">&#x27;world-land&#x27;</span>,</span><br><span class="line">      <span class="attr">paint</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;fill-pattern&#x27;</span>: <span class="string">&#x27;custom-dots-pattern&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;fill-opacity&#x27;</span>: <span class="number">0.4</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 步驟 4: 容錯處理 - 建立備用的簡化陸地區域</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;無法載入陸地資料，使用替代方案&#x27;</span>);</span><br><span class="line">    <span class="comment">// 手動定義簡化區域...</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="📊-叢集資料視覺化技術"><a href="#📊-叢集資料視覺化技術" class="headerlink" title="📊 叢集資料視覺化技術"></a>📊 叢集資料視覺化技術</h2><h3 id="什麼是資料叢集？"><a href="#什麼是資料叢集？" class="headerlink" title="什麼是資料叢集？"></a>什麼是資料叢集？</h3><p>當地圖上有大量密集的點資料時，叢集技術能夠：</p>
<ul>
<li>將鄰近的點合併顯示</li>
<li>根據縮放層級動態調整叢集</li>
<li>提供清晰的數量資訊</li>
</ul>
<h3 id="完整叢集實作範例"><a href="#完整叢集實作範例" class="headerlink" title="完整叢集實作範例"></a>完整叢集實作範例</h3><p>基於 <a target="_blank" rel="noopener" href="https://docs.mapbox.com/mapbox-gl-js/example/cluster/">Mapbox 官方範例</a>，以下是完整的叢集實作程式碼：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 設定 Mapbox 存取權杖</span></span><br><span class="line">mapboxgl.<span class="property">accessToken</span> = <span class="string">&#x27;YOUR_MAPBOX_ACCESS_TOKEN&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化地圖</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> mapboxgl.<span class="title class_">Map</span>(&#123;</span><br><span class="line">  <span class="attr">container</span>: <span class="string">&#x27;map&#x27;</span>,</span><br><span class="line">  <span class="attr">style</span>: <span class="string">&#x27;mapbox://styles/mapbox/standard&#x27;</span>,</span><br><span class="line">  <span class="attr">config</span>: &#123;</span><br><span class="line">    <span class="attr">basemap</span>: &#123;</span><br><span class="line">      <span class="attr">theme</span>: <span class="string">&#x27;monochrome&#x27;</span>,</span><br><span class="line">      <span class="attr">lightPreset</span>: <span class="string">&#x27;night&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">center</span>: [-<span class="number">103.5917</span>, <span class="number">40.6699</span>],</span><br><span class="line">  <span class="attr">zoom</span>: <span class="number">3</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">on</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1. 新增地震資料來源並啟用叢集功能</span></span><br><span class="line">  map.<span class="title function_">addSource</span>(<span class="string">&#x27;earthquakes&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;geojson&#x27;</span>,</span><br><span class="line">    <span class="comment">// 使用 USGS 地震資料 (2015/12/22 - 2016/1/21)</span></span><br><span class="line">    <span class="attr">data</span>: <span class="string">&#x27;https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson&#x27;</span>,</span><br><span class="line">    <span class="attr">cluster</span>: <span class="literal">true</span>,           <span class="comment">// 啟用叢集</span></span><br><span class="line">    <span class="attr">clusterMaxZoom</span>: <span class="number">14</span>,      <span class="comment">// 叢集的最大縮放層級</span></span><br><span class="line">    <span class="attr">clusterRadius</span>: <span class="number">50</span>        <span class="comment">// 叢集半徑（像素）</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 叢集圓圈圖層</span></span><br><span class="line">  map.<span class="title function_">addLayer</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;clusters&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;circle&#x27;</span>,</span><br><span class="line">    <span class="attr">source</span>: <span class="string">&#x27;earthquakes&#x27;</span>,</span><br><span class="line">    <span class="attr">filter</span>: [<span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],  <span class="comment">// 只顯示叢集點</span></span><br><span class="line">    <span class="attr">paint</span>: &#123;</span><br><span class="line">      <span class="comment">// 使用 step 表達式根據點數量決定顏色</span></span><br><span class="line">      <span class="string">&#x27;circle-color&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;step&#x27;</span>,</span><br><span class="line">        [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;#51bbd6&#x27;</span>,    <span class="comment">// &lt; 100 個點：藍色</span></span><br><span class="line">        <span class="number">100</span>,</span><br><span class="line">        <span class="string">&#x27;#f1f075&#x27;</span>,    <span class="comment">// 100-750 個點：黃色  </span></span><br><span class="line">        <span class="number">750</span>,</span><br><span class="line">        <span class="string">&#x27;#f28cb1&#x27;</span>     <span class="comment">// &gt;= 750 個點：粉色</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 根據點數量決定圓圈大小</span></span><br><span class="line">      <span class="string">&#x27;circle-radius&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;step&#x27;</span>,</span><br><span class="line">        [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span><br><span class="line">        <span class="number">20</span>,           <span class="comment">// &lt; 100 個點：半徑 20px</span></span><br><span class="line">        <span class="number">100</span>,</span><br><span class="line">        <span class="number">30</span>,           <span class="comment">// 100-750 個點：半徑 30px</span></span><br><span class="line">        <span class="number">750</span>,</span><br><span class="line">        <span class="number">40</span>            <span class="comment">// &gt;= 750 個點：半徑 40px</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&#x27;circle-emissive-strength&#x27;</span>: <span class="number">1</span>  <span class="comment">// 發光效果</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 叢集數字標籤圖層</span></span><br><span class="line">  map.<span class="title function_">addLayer</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;cluster-count&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;symbol&#x27;</span>,</span><br><span class="line">    <span class="attr">source</span>: <span class="string">&#x27;earthquakes&#x27;</span>,</span><br><span class="line">    <span class="attr">filter</span>: [<span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span><br><span class="line">    <span class="attr">layout</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;text-field&#x27;</span>: [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;point_count_abbreviated&#x27;</span>],  <span class="comment">// 顯示縮寫數字</span></span><br><span class="line">      <span class="string">&#x27;text-font&#x27;</span>: [<span class="string">&#x27;DIN Offc Pro Medium&#x27;</span>, <span class="string">&#x27;Arial Unicode MS Bold&#x27;</span>],</span><br><span class="line">      <span class="string">&#x27;text-size&#x27;</span>: <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. 個別點（未叢集）圖層</span></span><br><span class="line">  map.<span class="title function_">addLayer</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;unclustered-point&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;circle&#x27;</span>,</span><br><span class="line">    <span class="attr">source</span>: <span class="string">&#x27;earthquakes&#x27;</span>,</span><br><span class="line">    <span class="attr">filter</span>: [<span class="string">&#x27;!&#x27;</span>, [<span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>]],  <span class="comment">// 只顯示非叢集點</span></span><br><span class="line">    <span class="attr">paint</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;circle-color&#x27;</span>: <span class="string">&#x27;#11b4da&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;circle-radius&#x27;</span>: <span class="number">4</span>,</span><br><span class="line">      <span class="string">&#x27;circle-stroke-width&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">&#x27;circle-stroke-color&#x27;</span>: <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;circle-emissive-strength&#x27;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5. 叢集點擊事件 - 自動縮放展開</span></span><br><span class="line">  map.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;clusters&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> features = map.<span class="title function_">queryRenderedFeatures</span>(e.<span class="property">point</span>, &#123;</span><br><span class="line">      <span class="attr">layers</span>: [<span class="string">&#x27;clusters&#x27;</span>]</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> clusterId = features[<span class="number">0</span>].<span class="property">properties</span>.<span class="property">cluster_id</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 取得適當的縮放層級</span></span><br><span class="line">    map.<span class="title function_">getSource</span>(<span class="string">&#x27;earthquakes&#x27;</span>).<span class="title function_">getClusterExpansionZoom</span>(</span><br><span class="line">      clusterId,</span><br><span class="line">      <span class="function">(<span class="params">err, zoom</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 平滑縮放到叢集位置</span></span><br><span class="line">        map.<span class="title function_">easeTo</span>(&#123;</span><br><span class="line">          <span class="attr">center</span>: features[<span class="number">0</span>].<span class="property">geometry</span>.<span class="property">coordinates</span>,</span><br><span class="line">          <span class="attr">zoom</span>: zoom</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 6. 個別點點擊事件 - 顯示詳細資訊</span></span><br><span class="line">  map.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;unclustered-point&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> coordinates = e.<span class="property">features</span>[<span class="number">0</span>].<span class="property">geometry</span>.<span class="property">coordinates</span>.<span class="title function_">slice</span>();</span><br><span class="line">    <span class="keyword">const</span> mag = e.<span class="property">features</span>[<span class="number">0</span>].<span class="property">properties</span>.<span class="property">mag</span>;</span><br><span class="line">    <span class="keyword">const</span> tsunami = e.<span class="property">features</span>[<span class="number">0</span>].<span class="property">properties</span>.<span class="property">tsunami</span> === <span class="number">1</span> ? <span class="string">&#x27;yes&#x27;</span> : <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 處理地圖投影邊界問題</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="string">&#x27;mercator&#x27;</span>, <span class="string">&#x27;equirectangular&#x27;</span>].<span class="title function_">includes</span>(map.<span class="title function_">getProjection</span>().<span class="property">name</span>)) &#123;</span><br><span class="line">      <span class="keyword">while</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(e.<span class="property">lngLat</span>.<span class="property">lng</span> - coordinates[<span class="number">0</span>]) &gt; <span class="number">180</span>) &#123;</span><br><span class="line">        coordinates[<span class="number">0</span>] += e.<span class="property">lngLat</span>.<span class="property">lng</span> &gt; coordinates[<span class="number">0</span>] ? <span class="number">360</span> : -<span class="number">360</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 顯示彈出視窗</span></span><br><span class="line">    <span class="keyword">new</span> mapboxgl.<span class="title class_">Popup</span>()</span><br><span class="line">      .<span class="title function_">setLngLat</span>(coordinates)</span><br><span class="line">      .<span class="title function_">setHTML</span>(</span><br><span class="line">        <span class="string">`magnitude: <span class="subst">$&#123;mag&#125;</span>&lt;br&gt;Was there a tsunami?: <span class="subst">$&#123;tsunami&#125;</span>`</span></span><br><span class="line">      )</span><br><span class="line">      .<span class="title function_">addTo</span>(map);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 7. 滑鼠游標效果</span></span><br><span class="line">  map.<span class="title function_">on</span>(<span class="string">&#x27;mouseenter&#x27;</span>, <span class="string">&#x27;clusters&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    map.<span class="title function_">getCanvas</span>().<span class="property">style</span>.<span class="property">cursor</span> = <span class="string">&#x27;pointer&#x27;</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  map.<span class="title function_">on</span>(<span class="string">&#x27;mouseleave&#x27;</span>, <span class="string">&#x27;clusters&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    map.<span class="title function_">getCanvas</span>().<span class="property">style</span>.<span class="property">cursor</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="技術架構分析"><a href="#技術架構分析" class="headerlink" title="技術架構分析"></a>技術架構分析</h3><table>
<thead>
<tr>
<th>圖層</th>
<th>用途</th>
<th>關鍵屬性</th>
</tr>
</thead>
<tbody><tr>
<td><code>clusters</code></td>
<td>叢集圓圈</td>
<td><code>filter: [&#39;has&#39;, &#39;point_count&#39;]</code></td>
</tr>
<tr>
<td><code>cluster-count</code></td>
<td>叢集數字</td>
<td><code>text-field: point_count_abbreviated</code></td>
</tr>
<tr>
<td><code>unclustered-point</code></td>
<td>個別點</td>
<td><code>filter: [&#39;!&#39;, [&#39;has&#39;, &#39;point_count&#39;]]</code></td>
</tr>
</tbody></table>
<h2 id="⚡-互動體驗設計"><a href="#⚡-互動體驗設計" class="headerlink" title="⚡ 互動體驗設計"></a>⚡ 互動體驗設計</h2><h3 id="地理編碼整合"><a href="#地理編碼整合" class="headerlink" title="地理編碼整合"></a>地理編碼整合</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 點擊個別點時顯示地址資訊</span></span><br><span class="line">map.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;unclustered-point&#x27;</span>, <span class="title function_">async</span> (e) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [lng, lat] = e.<span class="property">features</span>[<span class="number">0</span>].<span class="property">geometry</span>.<span class="property">coordinates</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 呼叫 Mapbox Geocoding API 進行反向地理編碼</span></span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(</span><br><span class="line">    <span class="string">`https://api.mapbox.com/geocoding/v5/mapbox.places/<span class="subst">$&#123;lng&#125;</span>,<span class="subst">$&#123;lat&#125;</span>.json?access_token=<span class="subst">$&#123;mapboxgl.accessToken&#125;</span>`</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">  <span class="keyword">const</span> placeName = data.<span class="property">features</span>[<span class="number">0</span>]?.<span class="property">place_name</span> || <span class="string">&#x27;地址查無&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 顯示彈出視窗</span></span><br><span class="line">  <span class="keyword">new</span> mapboxgl.<span class="title class_">Popup</span>()</span><br><span class="line">    .<span class="title function_">setLngLat</span>([lng, lat])</span><br><span class="line">    .<span class="title function_">setHTML</span>(<span class="string">`&lt;strong&gt;<span class="subst">$&#123;placeName&#125;</span>&lt;/strong&gt;`</span>)</span><br><span class="line">    .<span class="title function_">addTo</span>(map);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="叢集互動功能"><a href="#叢集互動功能" class="headerlink" title="叢集互動功能"></a>叢集互動功能</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 點擊叢集時自動縮放</span></span><br><span class="line">map.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;clusters&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> features = map.<span class="title function_">queryRenderedFeatures</span>(e.<span class="property">point</span>, &#123;</span><br><span class="line">    <span class="attr">layers</span>: [<span class="string">&#x27;clusters&#x27;</span>]</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> clusterId = features[<span class="number">0</span>].<span class="property">properties</span>.<span class="property">cluster_id</span>;</span><br><span class="line">  </span><br><span class="line">  map.<span class="title function_">getSource</span>(<span class="string">&#x27;earthquakes&#x27;</span>).<span class="title function_">getClusterExpansionZoom</span>(</span><br><span class="line">    clusterId,</span><br><span class="line">    <span class="function">(<span class="params">err, zoom</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 平滑縮放到目標位置</span></span><br><span class="line">      map.<span class="title function_">easeTo</span>(&#123;</span><br><span class="line">        <span class="attr">center</span>: features[<span class="number">0</span>].<span class="property">geometry</span>.<span class="property">coordinates</span>,</span><br><span class="line">        <span class="attr">zoom</span>: zoom</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="🎯-實用技巧總結"><a href="#🎯-實用技巧總結" class="headerlink" title="🎯 實用技巧總結"></a>🎯 實用技巧總結</h2><h3 id="1-分層渲染策略"><a href="#1-分層渲染策略" class="headerlink" title="1. 分層渲染策略"></a>1. 分層渲染策略</h3><p>正確的圖層順序（由下到上）：</p>
<ol>
<li>底層填充圖案</li>
<li>叢集圓圈</li>
<li>光暈效果</li>
<li>核心點</li>
<li>文字標籤（最上層）</li>
</ol>
<h3 id="2-效能最佳化"><a href="#2-效能最佳化" class="headerlink" title="2. 效能最佳化"></a>2. 效能最佳化</h3><ul>
<li><strong>圖層最小化</strong>：只顯示必要的圖層</li>
<li><strong>適當的叢集設定</strong>：平衡視覺效果與效能</li>
<li><strong>事件處理最佳化</strong>：避免過度頻繁的 API 呼叫</li>
</ul>
<h3 id="3-錯誤處理模式"><a href="#3-錯誤處理模式" class="headerlink" title="3. 錯誤處理模式"></a>3. 錯誤處理模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 優雅的降級處理</span></span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;主要資料載入失敗，使用備用方案&#x27;</span>);</span><br><span class="line">  <span class="comment">// 提供簡化但可用的替代方案</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="🚀-進階應用方向"><a href="#🚀-進階應用方向" class="headerlink" title="🚀 進階應用方向"></a>🚀 進階應用方向</h2><h3 id="台灣地圖整合"><a href="#台灣地圖整合" class="headerlink" title="台灣地圖整合"></a>台灣地圖整合</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 載入台灣 GeoJSON 資料</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;./taiwan.geojson&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    map.<span class="title function_">addSource</span>(<span class="string">&#x27;taiwan&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;geojson&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: data</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 套用台灣特色的視覺樣式</span></span><br><span class="line">    map.<span class="title function_">addLayer</span>(&#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">&#x27;taiwan-regions&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;fill&#x27;</span>,</span><br><span class="line">      <span class="attr">source</span>: <span class="string">&#x27;taiwan&#x27;</span>,</span><br><span class="line">      <span class="attr">paint</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;fill-color&#x27;</span>: <span class="string">&#x27;#ff6b6b&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;fill-opacity&#x27;</span>: <span class="number">0.3</span>,</span><br><span class="line">        <span class="string">&#x27;fill-outline-color&#x27;</span>: <span class="string">&#x27;#ee5a52&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="時間軸動畫"><a href="#時間軸動畫" class="headerlink" title="時間軸動畫"></a>時間軸動畫</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加時間維度的資料視覺化</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animateData</span>(<span class="params">timeRange</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> filteredData = originalData.<span class="property">features</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">feature</span> =&gt;</span> </span><br><span class="line">    feature.<span class="property">properties</span>.<span class="property">timestamp</span> &gt;= timeRange.<span class="property">start</span> &amp;&amp;</span><br><span class="line">    feature.<span class="property">properties</span>.<span class="property">timestamp</span> &lt;= timeRange.<span class="property">end</span></span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">  map.<span class="title function_">getSource</span>(<span class="string">&#x27;earthquakes&#x27;</span>).<span class="title function_">setData</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;FeatureCollection&#x27;</span>,</span><br><span class="line">    <span class="attr">features</span>: filteredData</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="💡-技術延伸應用"><a href="#💡-技術延伸應用" class="headerlink" title="💡 技術延伸應用"></a>💡 技術延伸應用</h2><p>這些技術可以應用到：</p>
<ul>
<li><strong>商業智能</strong>：銷售數據的地理分佈分析</li>
<li><strong>物聯網</strong>：感測器資料的即時地圖展示</li>
<li><strong>社會媒體</strong>：用戶簽到數據的視覺化</li>
<li><strong>災害管理</strong>：緊急事件的地理資訊系統</li>
</ul>
<h2 id="🎓-學習建議"><a href="#🎓-學習建議" class="headerlink" title="🎓 學習建議"></a>🎓 學習建議</h2><ol>
<li><strong>深入研究 Mapbox GL JS 官方文件</strong></li>
<li><strong>實驗不同的資料來源和格式</strong></li>
<li><strong>嘗試整合其他 Web API</strong></li>
<li><strong>優化效能和使用者體驗</strong></li>
</ol>
<h2 id="📄-完整-HTML-範例"><a href="#📄-完整-HTML-範例" class="headerlink" title="📄 完整 HTML 範例"></a>📄 完整 HTML 範例</h2><p>以下是可以直接執行的完整 HTML 檔案：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Create and style clusters<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;initial-scale=1,maximum-scale=1,user-scalable=no&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">body</span> &#123; <span class="attribute">margin</span>: <span class="number">0</span>; <span class="attribute">padding</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#map</span> &#123; <span class="attribute">position</span>: absolute; <span class="attribute">top</span>: <span class="number">0</span>; <span class="attribute">bottom</span>: <span class="number">0</span>; <span class="attribute">width</span>: <span class="number">100%</span>; &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;map&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// TO MAKE THE MAP APPEAR YOU MUST</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ADD YOUR ACCESS TOKEN FROM</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// https://account.mapbox.com</span></span></span><br><span class="line"><span class="language-javascript">    mapboxgl.<span class="property">accessToken</span> = <span class="string">&#x27;YOUR_MAPBOX_ACCESS_TOKEN&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> map = <span class="keyword">new</span> mapboxgl.<span class="title class_">Map</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">container</span>: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// Choose from Mapbox&#x27;s core styles, or make your own style with Mapbox Studio</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">style</span>: <span class="string">&#x27;mapbox://styles/mapbox/standard&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">config</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">basemap</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">theme</span>: <span class="string">&#x27;monochrome&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">lightPreset</span>: <span class="string">&#x27;night&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">center</span>: [-<span class="number">103.5917</span>, <span class="number">40.6699</span>],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">zoom</span>: <span class="number">3</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    map.<span class="title function_">on</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// Add a new source from our GeoJSON data and</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// set the &#x27;cluster&#x27; option to true. GL-JS will</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// add the point_count property to your source data.</span></span></span><br><span class="line"><span class="language-javascript">      map.<span class="title function_">addSource</span>(<span class="string">&#x27;earthquakes&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">type</span>: <span class="string">&#x27;geojson&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Point to GeoJSON data. This example visualizes all M1.0+ earthquakes</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// from 12/22/15 to 1/21/16 as logged by USGS&#x27; Earthquake hazards program.</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: <span class="string">&#x27;https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">cluster</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">clusterMaxZoom</span>: <span class="number">14</span>, <span class="comment">// Max zoom to cluster points on</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">clusterRadius</span>: <span class="number">50</span> <span class="comment">// Radius of each cluster when clustering points (defaults to 50)</span></span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      map.<span class="title function_">addLayer</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">id</span>: <span class="string">&#x27;clusters&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">type</span>: <span class="string">&#x27;circle&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">source</span>: <span class="string">&#x27;earthquakes&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">filter</span>: [<span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">paint</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// Use step expressions (https://docs.mapbox.com/style-spec/reference/expressions/#step)</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// with three steps to implement three types of circles:</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">//   * Blue, 20px circles when point count is less than 100</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">//   * Yellow, 30px circles when point count is between 100 and 750</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">//   * Pink, 40px circles when point count is greater than or equal to 750</span></span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;circle-color&#x27;</span>: [</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;step&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;#51bbd6&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="number">100</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;#f1f075&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="number">750</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;#f28cb1&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          ],</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;circle-radius&#x27;</span>: [</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;step&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="number">100</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="number">750</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="number">40</span></span></span><br><span class="line"><span class="language-javascript">          ],</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;circle-emissive-strength&#x27;</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      map.<span class="title function_">addLayer</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">id</span>: <span class="string">&#x27;cluster-count&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">type</span>: <span class="string">&#x27;symbol&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">source</span>: <span class="string">&#x27;earthquakes&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">filter</span>: [<span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">layout</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;text-field&#x27;</span>: [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;point_count_abbreviated&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;text-font&#x27;</span>: [<span class="string">&#x27;DIN Offc Pro Medium&#x27;</span>, <span class="string">&#x27;Arial Unicode MS Bold&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;text-size&#x27;</span>: <span class="number">12</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      map.<span class="title function_">addLayer</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">id</span>: <span class="string">&#x27;unclustered-point&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">type</span>: <span class="string">&#x27;circle&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">source</span>: <span class="string">&#x27;earthquakes&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">filter</span>: [<span class="string">&#x27;!&#x27;</span>, [<span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>]],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">paint</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;circle-color&#x27;</span>: <span class="string">&#x27;#11b4da&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;circle-radius&#x27;</span>: <span class="number">4</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;circle-stroke-width&#x27;</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;circle-stroke-color&#x27;</span>: <span class="string">&#x27;#fff&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;circle-emissive-strength&#x27;</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// inspect a cluster on click</span></span></span><br><span class="line"><span class="language-javascript">      map.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;clusters&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> features = map.<span class="title function_">queryRenderedFeatures</span>(e.<span class="property">point</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">layers</span>: [<span class="string">&#x27;clusters&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> clusterId = features[<span class="number">0</span>].<span class="property">properties</span>.<span class="property">cluster_id</span>;</span></span><br><span class="line"><span class="language-javascript">        map.<span class="title function_">getSource</span>(<span class="string">&#x27;earthquakes&#x27;</span>).<span class="title function_">getClusterExpansionZoom</span>(</span></span><br><span class="line"><span class="language-javascript">          clusterId,</span></span><br><span class="line"><span class="language-javascript">          <span class="function">(<span class="params">err, zoom</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (err) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            map.<span class="title function_">easeTo</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">center</span>: features[<span class="number">0</span>].<span class="property">geometry</span>.<span class="property">coordinates</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">zoom</span>: zoom</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        );</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// When a click event occurs on a feature in</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// the unclustered-point layer, open a popup at</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// the location of the feature, with</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// description HTML from its properties.</span></span></span><br><span class="line"><span class="language-javascript">      map.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;unclustered-point&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> coordinates = e.<span class="property">features</span>[<span class="number">0</span>].<span class="property">geometry</span>.<span class="property">coordinates</span>.<span class="title function_">slice</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> mag = e.<span class="property">features</span>[<span class="number">0</span>].<span class="property">properties</span>.<span class="property">mag</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> tsunami = e.<span class="property">features</span>[<span class="number">0</span>].<span class="property">properties</span>.<span class="property">tsunami</span> === <span class="number">1</span> ? <span class="string">&#x27;yes&#x27;</span> : <span class="string">&#x27;no&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Ensure that if the map is zoomed out such that</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// multiple copies of the feature are visible, the</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// popup appears over the copy being pointed to.</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> ([<span class="string">&#x27;mercator&#x27;</span>, <span class="string">&#x27;equirectangular&#x27;</span>].<span class="title function_">includes</span>(map.<span class="title function_">getProjection</span>().<span class="property">name</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">while</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(e.<span class="property">lngLat</span>.<span class="property">lng</span> - coordinates[<span class="number">0</span>]) &gt; <span class="number">180</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            coordinates[<span class="number">0</span>] += e.<span class="property">lngLat</span>.<span class="property">lng</span> &gt; coordinates[<span class="number">0</span>] ? <span class="number">360</span> : -<span class="number">360</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">new</span> mapboxgl.<span class="title class_">Popup</span>()</span></span><br><span class="line"><span class="language-javascript">          .<span class="title function_">setLngLat</span>(coordinates)</span></span><br><span class="line"><span class="language-javascript">          .<span class="title function_">setHTML</span>(</span></span><br><span class="line"><span class="language-javascript">            <span class="string">`magnitude: <span class="subst">$&#123;mag&#125;</span>&lt;br&gt;Was there a tsunami?: <span class="subst">$&#123;tsunami&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">          )</span></span><br><span class="line"><span class="language-javascript">          .<span class="title function_">addTo</span>(map);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      map.<span class="title function_">on</span>(<span class="string">&#x27;mouseenter&#x27;</span>, <span class="string">&#x27;clusters&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        map.<span class="title function_">getCanvas</span>().<span class="property">style</span>.<span class="property">cursor</span> = <span class="string">&#x27;pointer&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      map.<span class="title function_">on</span>(<span class="string">&#x27;mouseleave&#x27;</span>, <span class="string">&#x27;clusters&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        map.<span class="title function_">getCanvas</span>().<span class="property">style</span>.<span class="property">cursor</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="🚀-快速開始步驟"><a href="#🚀-快速開始步驟" class="headerlink" title="🚀 快速開始步驟"></a>🚀 快速開始步驟</h3><ol>
<li><p><strong>取得 Access Token</strong>：</p>
<ul>
<li>前往 <a target="_blank" rel="noopener" href="https://account.mapbox.com/">Mapbox Account</a></li>
<li>複製您的 access token</li>
<li>替換程式碼中的 <code>YOUR_MAPBOX_ACCESS_TOKEN</code></li>
</ul>
</li>
<li><p><strong>本地測試</strong>：</p>
<ul>
<li>儲存為 <code>.html</code> 檔案</li>
<li>在瀏覽器中開啟</li>
<li>享受互動式叢集地圖！</li>
</ul>
</li>
<li><p><strong>客製化調整</strong>：</p>
<ul>
<li>修改 <code>clusterRadius</code> 調整叢集半徑</li>
<li>更換 <code>data</code> URL 使用自己的 GeoJSON 資料</li>
<li>調整顏色和大小的 step 表達式</li>
</ul>
</li>
</ol>
<hr>
<h2 id="📞-技術支援與參考資源"><a href="#📞-技術支援與參考資源" class="headerlink" title="📞 技術支援與參考資源"></a>📞 技術支援與參考資源</h2><h3 id="官方文件"><a href="#官方文件" class="headerlink" title="官方文件"></a>官方文件</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.mapbox.com/mapbox-gl-js/">Mapbox GL JS 官方文件</a></li>
<li><a target="_blank" rel="noopener" href="https://geojson.org/">GeoJSON 規格說明</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.mapbox.com/mapbox-gl-js/example/cluster/">Mapbox 叢集範例</a></li>
</ul>
<h3 id="資料來源"><a href="#資料來源" class="headerlink" title="資料來源"></a>資料來源</h3><ul>
<li><a target="_blank" rel="noopener" href="https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson">USGS 地震資料</a></li>
<li><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson">世界陸地邊界 GeoJSON</a></li>
</ul>
<h3 id="相關專案"><a href="#相關專案" class="headerlink" title="相關專案"></a>相關專案</h3><ul>
<li>本文技術範例基於 Mapbox 官方叢集教學</li>
</ul>
<blockquote>
<p><strong>作者</strong>：技術團隊<br><strong>更新日期</strong>：2025年6月29日<br><strong>版本</strong>：v1.1<br><strong>程式碼來源</strong>：<a target="_blank" rel="noopener" href="https://docs.mapbox.com/mapbox-gl-js/example/cluster/">Mapbox Create and Style Clusters</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cookieseventeen.github.io/2025/06/29/mapbox-data-visualization-guide/" data-id="cmg51yfqj000ganmzcnxa92up" data-title="Mapbox 地圖資料視覺化技術分析與應用指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Canvas/" rel="tag">Canvas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Clustering/" rel="tag">Clustering</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Data-Visualization/" rel="tag">Data Visualization</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GeoJSON/" rel="tag">GeoJSON</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Interactive-Maps/" rel="tag">Interactive Maps</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mapbox/" rel="tag">Mapbox</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mapbox-GL-JS/" rel="tag">Mapbox GL JS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/USGS-Data/" rel="tag">USGS Data</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web-Mapping/" rel="tag">Web Mapping</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一頁 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分類</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Tech-Daily/">Tech Daily</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ARM/" rel="tag">ARM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular-15/" rel="tag">Angular 15+</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular-19/" rel="tag">Angular 19</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular-19/" rel="tag">Angular 19+</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular-Configuration/" rel="tag">Angular Configuration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular-SSR/" rel="tag">Angular SSR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular-Universal/" rel="tag">Angular Universal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Animation-Loop/" rel="tag">Animation Loop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Best-Practices/" rel="tag">Best Practices</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Buildx/" rel="tag">Buildx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI-CD/" rel="tag">CI&#x2F;CD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Canvas/" rel="tag">Canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Clean-Architecture/" rel="tag">Clean Architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Clustering/" rel="tag">Clustering</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Code-Quality/" rel="tag">Code Quality</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Composables/" rel="tag">Composables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Composition-API/" rel="tag">Composition API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Creative-Coding/" rel="tag">Creative Coding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Visualization/" rel="tag">Data Visualization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debugging/" rel="tag">Debugging</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dependency-Injection/" rel="tag">Dependency Injection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Design-Patterns/" rel="tag">Design Patterns</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Developer-Experience/" rel="tag">Developer Experience</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Device-Pixel-Ratio/" rel="tag">Device Pixel Ratio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ESLint-9-x/" rel="tag">ESLint 9.x</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Enterprise-Architecture/" rel="tag">Enterprise Architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Error-Handling/" rel="tag">Error Handling</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Feature-Modules/" rel="tag">Feature Modules</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flat-Config/" rel="tag">Flat Config</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Frontend-Architecture/" rel="tag">Frontend Architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Frontend-Initialization/" rel="tag">Frontend Initialization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Frontend-Tooling/" rel="tag">Frontend Tooling</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GeoJSON/" rel="tag">GeoJSON</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Global-Properties/" rel="tag">Global Properties</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML5-Canvas/" rel="tag">HTML5 Canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP-Interceptors/" rel="tag">HTTP Interceptors</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HttpClient/" rel="tag">HttpClient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hydration/" rel="tag">Hydration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Interactive-Maps/" rel="tag">Interactive Maps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Internationalization/" rel="tag">Internationalization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linting-Rules/" rel="tag">Linting Rules</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mapbox/" rel="tag">Mapbox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mapbox-GL-JS/" rel="tag">Mapbox GL JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Migration-Guide/" rel="tag">Migration Guide</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Multi-language/" rel="tag">Multi-language</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Multi-platform/" rel="tag">Multi-platform</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Naming-Convention/" rel="tag">Naming Convention</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NullInjectorError/" rel="tag">NullInjectorError</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Offline-Deployment/" rel="tag">Offline Deployment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance-Optimization/" rel="tag">Performance Optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pinia/" rel="tag">Pinia</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prerender/" rel="tag">Prerender</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PrimeNG/" rel="tag">PrimeNG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Procedural-Animation/" rel="tag">Procedural Animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Production-Deployment/" rel="tag">Production Deployment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Production-Issues/" rel="tag">Production Issues</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Project-Architecture/" rel="tag">Project Architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Project-Setup/" rel="tag">Project Setup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RenderMode/" rel="tag">RenderMode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Route-Guards/" rel="tag">Route Guards</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/" rel="tag">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSR/" rel="tag">SSR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSR-Configuration/" rel="tag">SSR Configuration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Server-Side-Rendering/" rel="tag">Server-Side Rendering</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Service-Pattern/" rel="tag">Service Pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Signals/" rel="tag">Signals</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Simplex-Noise/" rel="tag">Simplex Noise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Standalone-Components/" rel="tag">Standalone Components</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/State-Management/" rel="tag">State Management</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tailwind-CSS/" rel="tag">Tailwind CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Transloco/" rel="tag">Transloco</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Troubleshooting/" rel="tag">Troubleshooting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/USGS-Data/" rel="tag">USGS Data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Visualization/" rel="tag">Visualization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-js/" rel="tag">Vue.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web-Mapping/" rel="tag">Web Mapping</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/i18n/" rel="tag">i18n</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/i18n-Debug/" rel="tag">i18n Debug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jsverse-transloco/" rel="tag">jsverse&#x2F;transloco</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/provideHttpClient/" rel="tag">provideHttpClient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/withInterceptorsFromDI/" rel="tag">withInterceptorsFromDI</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤雲</h3>
    <div class="widget tagcloud">
      <a href="/tags/ARM/" style="font-size: 10px;">ARM</a> <a href="/tags/Angular/" style="font-size: 10px;">Angular</a> <a href="/tags/Angular-15/" style="font-size: 10px;">Angular 15+</a> <a href="/tags/Angular-19/" style="font-size: 16.67px;">Angular 19</a> <a href="/tags/Angular-19/" style="font-size: 10px;">Angular 19+</a> <a href="/tags/Angular-Configuration/" style="font-size: 10px;">Angular Configuration</a> <a href="/tags/Angular-SSR/" style="font-size: 10px;">Angular SSR</a> <a href="/tags/Angular-Universal/" style="font-size: 20px;">Angular Universal</a> <a href="/tags/Animation-Loop/" style="font-size: 10px;">Animation Loop</a> <a href="/tags/Best-Practices/" style="font-size: 10px;">Best Practices</a> <a href="/tags/Buildx/" style="font-size: 10px;">Buildx</a> <a href="/tags/CI-CD/" style="font-size: 10px;">CI/CD</a> <a href="/tags/Canvas/" style="font-size: 10px;">Canvas</a> <a href="/tags/Clean-Architecture/" style="font-size: 10px;">Clean Architecture</a> <a href="/tags/Clustering/" style="font-size: 10px;">Clustering</a> <a href="/tags/Code-Quality/" style="font-size: 10px;">Code Quality</a> <a href="/tags/Composables/" style="font-size: 10px;">Composables</a> <a href="/tags/Composition-API/" style="font-size: 10px;">Composition API</a> <a href="/tags/Creative-Coding/" style="font-size: 10px;">Creative Coding</a> <a href="/tags/Data-Visualization/" style="font-size: 10px;">Data Visualization</a> <a href="/tags/Debugging/" style="font-size: 10px;">Debugging</a> <a href="/tags/Dependency-Injection/" style="font-size: 10px;">Dependency Injection</a> <a href="/tags/Design-Patterns/" style="font-size: 10px;">Design Patterns</a> <a href="/tags/Developer-Experience/" style="font-size: 10px;">Developer Experience</a> <a href="/tags/Device-Pixel-Ratio/" style="font-size: 10px;">Device Pixel Ratio</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/ESLint-9-x/" style="font-size: 10px;">ESLint 9.x</a> <a href="/tags/Enterprise-Architecture/" style="font-size: 10px;">Enterprise Architecture</a> <a href="/tags/Error-Handling/" style="font-size: 13.33px;">Error Handling</a> <a href="/tags/Feature-Modules/" style="font-size: 10px;">Feature Modules</a> <a href="/tags/Flat-Config/" style="font-size: 10px;">Flat Config</a> <a href="/tags/Frontend-Architecture/" style="font-size: 10px;">Frontend Architecture</a> <a href="/tags/Frontend-Initialization/" style="font-size: 10px;">Frontend Initialization</a> <a href="/tags/Frontend-Tooling/" style="font-size: 10px;">Frontend Tooling</a> <a href="/tags/GeoJSON/" style="font-size: 10px;">GeoJSON</a> <a href="/tags/Global-Properties/" style="font-size: 10px;">Global Properties</a> <a href="/tags/HTML5-Canvas/" style="font-size: 10px;">HTML5 Canvas</a> <a href="/tags/HTTP-Interceptors/" style="font-size: 10px;">HTTP Interceptors</a> <a href="/tags/HttpClient/" style="font-size: 10px;">HttpClient</a> <a href="/tags/Hydration/" style="font-size: 13.33px;">Hydration</a> <a href="/tags/Interactive-Maps/" style="font-size: 10px;">Interactive Maps</a> <a href="/tags/Internationalization/" style="font-size: 10px;">Internationalization</a> <a href="/tags/JavaScript/" style="font-size: 13.33px;">JavaScript</a> <a href="/tags/Linting-Rules/" style="font-size: 10px;">Linting Rules</a> <a href="/tags/Mapbox/" style="font-size: 10px;">Mapbox</a> <a href="/tags/Mapbox-GL-JS/" style="font-size: 10px;">Mapbox GL JS</a> <a href="/tags/Migration-Guide/" style="font-size: 10px;">Migration Guide</a> <a href="/tags/Multi-language/" style="font-size: 10px;">Multi-language</a> <a href="/tags/Multi-platform/" style="font-size: 10px;">Multi-platform</a> <a href="/tags/Naming-Convention/" style="font-size: 10px;">Naming Convention</a> <a href="/tags/NullInjectorError/" style="font-size: 10px;">NullInjectorError</a> <a href="/tags/Offline-Deployment/" style="font-size: 10px;">Offline Deployment</a> <a href="/tags/Performance-Optimization/" style="font-size: 16.67px;">Performance Optimization</a> <a href="/tags/Pinia/" style="font-size: 10px;">Pinia</a> <a href="/tags/Prerender/" style="font-size: 13.33px;">Prerender</a> <a href="/tags/PrimeNG/" style="font-size: 10px;">PrimeNG</a> <a href="/tags/Procedural-Animation/" style="font-size: 10px;">Procedural Animation</a> <a href="/tags/Production-Deployment/" style="font-size: 10px;">Production Deployment</a> <a href="/tags/Production-Issues/" style="font-size: 10px;">Production Issues</a> <a href="/tags/Project-Architecture/" style="font-size: 10px;">Project Architecture</a> <a href="/tags/Project-Setup/" style="font-size: 10px;">Project Setup</a> <a href="/tags/RenderMode/" style="font-size: 13.33px;">RenderMode</a> <a href="/tags/Route-Guards/" style="font-size: 13.33px;">Route Guards</a> <a href="/tags/SEO/" style="font-size: 13.33px;">SEO</a> <a href="/tags/SSR/" style="font-size: 16.67px;">SSR</a> <a href="/tags/SSR-Configuration/" style="font-size: 13.33px;">SSR Configuration</a> <a href="/tags/Server-Side-Rendering/" style="font-size: 16.67px;">Server-Side Rendering</a> <a href="/tags/Service-Pattern/" style="font-size: 10px;">Service Pattern</a> <a href="/tags/Signals/" style="font-size: 10px;">Signals</a> <a href="/tags/Simplex-Noise/" style="font-size: 10px;">Simplex Noise</a> <a href="/tags/Standalone-Components/" style="font-size: 13.33px;">Standalone Components</a> <a href="/tags/State-Management/" style="font-size: 10px;">State Management</a> <a href="/tags/Tailwind-CSS/" style="font-size: 10px;">Tailwind CSS</a> <a href="/tags/Transloco/" style="font-size: 16.67px;">Transloco</a> <a href="/tags/Troubleshooting/" style="font-size: 10px;">Troubleshooting</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/USGS-Data/" style="font-size: 10px;">USGS Data</a> <a href="/tags/Visualization/" style="font-size: 10px;">Visualization</a> <a href="/tags/Vue-js/" style="font-size: 10px;">Vue.js</a> <a href="/tags/Web-Mapping/" style="font-size: 10px;">Web Mapping</a> <a href="/tags/i18n/" style="font-size: 10px;">i18n</a> <a href="/tags/i18n-Debug/" style="font-size: 10px;">i18n Debug</a> <a href="/tags/jsverse-transloco/" style="font-size: 10px;">jsverse/transloco</a> <a href="/tags/provideHttpClient/" style="font-size: 10px;">provideHttpClient</a> <a href="/tags/withInterceptorsFromDI/" style="font-size: 10px;">withInterceptorsFromDI</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">彙整</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/09/">九月 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">六月 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/09/29/canvas-simplex-noise-wave-animation-guide/">Canvas + Simplex Noise 動態擬真波浪實作指南</a>
          </li>
        
          <li>
            <a href="/2025/06/29/angular-enterprise-project-initialization-guide/">Angular 19 企業級前端專案初始化完整指南</a>
          </li>
        
          <li>
            <a href="/2025/06/29/angular-ssr-transloco-troubleshooting-guide/">Angular SSR + Transloco 故障排除與除錯完整指南</a>
          </li>
        
          <li>
            <a href="/2025/06/29/angular-ssr-transloco-setup-complete-guide/">Angular SSR + Transloco 國際化配置實戰指南</a>
          </li>
        
          <li>
            <a href="/2025/06/29/angular-httpclient-modern-configuration-guide/">Angular HttpClient 現代化配置與 withInterceptorsFromDI 實戰指南</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Ben Hsieh<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>